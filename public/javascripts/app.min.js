var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,r,n,o){t.html5Mode(!0),o.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),r.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,r,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return 1e3*(1+e/100*.04621)/1e3}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,r,n){function o(r){t({method:"GET",url:"/"+r}).then(function(t){e[r]=t.data})}e.user={},e.user.recipetemplate="/views/notloggedin.html",o("grains"),o("hops"),o("yeasts"),e.recipe={efficiency:65,attenuation:70,volume:5,grains:{added:[]},hops:{added:[],ibu:function(){return n.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},og:function(){return n.efficiencyPPG(n.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},fg:function(){return n.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},abv:function(){return n.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},srm:function(){return n.srm(e.recipe.grains.added,e.recipe.volume)},dp:function(){return n.dp(e.recipe.grains.added,n.totalWeight(e.recipe.grains.added))},notes:"",recipeyeast:e.yeast},e.saveRecipe=function(){var r={username:e.user.username,name:e.recipe.name,grains:{added:e.recipe.grains.added},efficiency:e.recipe.efficiency,volume:e.recipe.volume,attenuation:e.recipe.attenuation,hops:{added:e.recipe.hops.added},notes:e.notes};t({method:"post",url:"/private/recipes",data:r}).then(function(e){console.log(e.data)})},e.getSavedRecipes=function(){t({method:"post",url:"/private/recipes/saved"}).then(function(e){console.log(e.data)})},e.addIngredient=function(t,r){e.recipe[t].added.push(e[r]),e[r]={}},e.deleteItem=function(t,r){e.recipe[r].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=r.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("dbsgCalc",["$scope",function(e){console.log("clicked"),console.log(e.dbfg+e.name)}]),app.controller("loginControl",["$rootScope","$scope","$http","$location",function(e,t,r,n){t.userLogin=function(){r({method:"post",data:t.user,url:"/loginauth"}).then(function(e){e.data.token&&(sessionStorage.setItem("userToken",e.data.token),t.user={},n.url("/"))},function(e){t.error=e.data,t.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,r){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,r.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$rootScope","$scope","jwtHelper",function(e,t,r){t.user={},t.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(t.user=r.decodeToken(sessionStorage.getItem("userToken")),t.user.login="Logout "+t.user.username,t.user.loginUrl="/"):(t.user={},t.user.login="Login/Register",t.user.loginUrl="/login")}),t.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var r=0;return e.forEach(function(e,n){r+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),r},this.efficiencyPPG=function(e,t){if(0===e)return 0;var r=Math.round(e*(t/100)*1e3)/1e3+1;return r>1.5&&(r=1.5),r.toString().length>5&&(r=r.toString().slice(0,5)),r},this.ibu=function(e,t,r,n){if(e.length>0&&t.length>0){var o=0,i=0,a=1.65*Math.pow(125e-6,n-1);return e.forEach(function(e){if(i=e.weight*(e.Alpha_Acid/100)*7490/r,"boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,n=a*t;o+=n*i}else if("whirlpool"==e.hopType){var n=.1;o+=n*i}}),Math.round(100*o)/100}return 0},this.fg=function(e,t,r){if(e.length>0){var n=Math.round(1e3*(t-1)*(r/100))/1e3;return n=t-n,n.toString().length>5&&(n=n.toString().slice(0,5)),n}return 0},this.srm=function(e,t){if(e.length>0){var r=0,n=e.forEach(function(e,t){r+=e.lovi*e.weight});return n=r/t,n=Math.round(1.4922*Math.pow(n,.6859)*100)/100,n>50&&(n=50),n}return 0},this.abv=function(e,t,r){return e.length>0?Math.round(76.08*(t-r)/(1.775-t)*(r/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var r=0;return e.forEach(function(e,t){r+=e.dp*e.weight}),Math.round(r/t)}return 0}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJlY2lwZXNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwiand0SW50ZXJjZXB0b3JQcm92aWRlciIsImh0bWw1TW9kZSIsInRva2VuR2V0dGVyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJzY29wZSIsIm90aGVyVmFsIiwibGluayIsImVsZW0iLCJhdHRyIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiaXNNYXRjaCIsIm1vZGVsVmFsIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwic2VydmljZSIsInRoaXMiLCJjYWxjUHBnIiwiZGJmZyIsIiRzY29wZSIsIiRodHRwIiwiand0SGVscGVyIiwicmVjaXBlRnVuYyIsIml0ZW0iLCJtZXRob2QiLCJ1cmwiLCJ0aGVuIiwicmVzIiwiZGF0YSIsInVzZXIiLCJyZWNpcGV0ZW1wbGF0ZSIsInJlY2lwZSIsImVmZmljaWVuY3kiLCJhdHRlbnVhdGlvbiIsInZvbHVtZSIsImdyYWlucyIsImFkZGVkIiwiaG9wcyIsImlidSIsIm9nIiwiZWZmaWNpZW5jeVBQRyIsInRvdGFsUFBHIiwiZmciLCJhYnYiLCJzcm0iLCJkcCIsInRvdGFsV2VpZ2h0Iiwibm90ZXMiLCJyZWNpcGV5ZWFzdCIsInllYXN0Iiwic2F2ZVJlY2lwZSIsInVzZXJuYW1lIiwibmFtZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRTYXZlZFJlY2lwZXMiLCJhZGRJbmdyZWRpZW50IiwiaW5ncmVkaWVudCIsInR5cGUiLCJkZWxldGVJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJ1c2VyVG9rZW4iLCJkZWNvZGVUb2tlbiIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJ1c2VyTG9naW4iLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwibG9naW4iLCJsb2dpblVybCIsImxvZ091dCIsInJlbW92ZUl0ZW0iLCJpbmdyZWRpZW50cyIsInRvdGFsIiwiZm9yRWFjaCIsIndlaWdodCIsInBhcnNlSW50IiwiZ3JhaW4iLCJNYXRoIiwicm91bmQiLCJQUEciLCJlZmZQUEciLCJ0b1N0cmluZyIsImxlbmd0aCIsInNsaWNlIiwiYWF1IiwiYmlnRmFjdCIsInBvdyIsImhvcCIsIkFscGhhX0FjaWQiLCJob3BUeXBlIiwiYm9pbFRGYWN0IiwiaG9wVGltZSIsInV0aWwiLCJ5ZWFzdEZvb2QiLCJ0b3RhbENvbG9yIiwibWN1IiwibG92aSIsInRvdGFsZHAiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsaUJBQUEsYUFBQSxVQUFBLGVBQ0FGLEtBQUFHLFFBQUEsaUJBQ0Esb0JBQ0EscUJBQ0EsZ0JBQ0EseUJBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUgsRUFBQUksV0FBQSxHQUVBRCxFQUFBRSxZQUFBLFdBQ0EsTUFBQUMsZ0JBQUFDLFFBQUEsY0FFQUwsRUFBQU0sYUFBQUMsS0FBQSxrQkFFQVIsRUFBQVMsTUFBQSxXQUNBQyxlQUFBLFNBQ0FDLGNBQUEsVUFFQWIsRUFBQWMsS0FBQSxLQUNBQyxZQUFBLHNCQUNBQyxXQUFBLGVBQ0FGLEtBQUEsY0FDQUMsWUFBQSx1QkFDQUMsV0FBQSxhQUNBRixLQUFBLFVBQ0FDLFlBQUEsb0JBQ0FDLFdBQUEsaUJBQ0FGLEtBQUEsYUFDQUMsWUFBQSx1QkFDQUMsV0FBQSxvQkFDQUMsVUFBQSxLQUNBRixZQUFBLHNCQUNBQyxXQUFBLGtCQUdBcEIsSUFBQXNCLFVBQUEsVUFBQSxXQUNBLE9BQ0FD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QixHQUFBLFNBQUFWLEVBQUFXLEdBQ0EsR0FBQVgsRUFBQW9ELE9BQUEsRUFBQSxDQUNBLEdBQUFlLEdBQUEsQ0FJQSxPQUhBbkUsR0FBQTJDLFFBQUEsU0FBQUcsRUFBQXJCLEdBQ0EwQyxHQUFBckIsRUFBQXBDLEdBQUFvQyxFQUFBRixTQUVBRyxLQUFBQyxNQUFBbUIsRUFBQXhELEdBRUEsTUFBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ3JlY2lwZUNyZWF0b3InLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICdhbmd1bGFyLWp3dCddKTtcbiAgYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRsb2NhdGlvblByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRtZFRoZW1pbmdQcm92aWRlcicsXG4gICAgICAgICAgICAgICckaHR0cFByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJ2p3dEludGVyY2VwdG9yUHJvdmlkZXInLFxuICAgICAgICAgICAgICBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlciwgJGh0dHBQcm92aWRlciwgand0SW50ZXJjZXB0b3JQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgand0SW50ZXJjZXB0b3JQcm92aWRlci50b2tlbkdldHRlciA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfVxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2p3dEludGVyY2VwdG9yJyk7XG5cbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgLnByaW1hcnlQYWxldHRlKCdhbWJlcicpXG4gICAgICAuYWNjZW50UGFsZXR0ZSgneWVsbG93Jyk7XG5cbiAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pLndoZW4oJy9kYnNnX2NhbGMnLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kYnNnY2FsYy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdkYnNnQ2FsYydcbiAgICB9KS53aGVuKCcvbG9naW4nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkNvbnRyb2wnXG4gICAgfSkud2hlbignL3JlZ2lzdGVyJywge1xuICAgICAgdGVtcGxhdGVVcmw6Jy92aWV3cy9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckNvbnRyb2wnXG4gICAgfSkub3RoZXJ3aXNlKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pO1xuICB9XSk7XG4gIGFwcC5kaXJlY3RpdmUoJ2lzTWF0Y2gnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICBzY29wZToge1xuICAgICAgICBvdGhlclZhbDogXCI9aXNNYXRjaFwiXG4gICAgICB9LFxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcbiAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5pc01hdGNoID0gZnVuY3Rpb24obW9kZWxWYWwpIHtcbiAgICAgICAgICByZXR1cm4gbW9kZWxWYWwgPT09IHNjb3BlLm90aGVyVmFsO1xuICAgICAgICB9O1xuICAgICAgICBzY29wZS4kd2F0Y2goJ290aGVyVmFsJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgYXBwLnNlcnZpY2UoJ1BwZ0NhbGMnLCBmdW5jdGlvbiAoKXtcbiAgICB0aGlzLmNhbGNQcGcgPSBmdW5jdGlvbihkYmZnKSB7XG4gICAgICByZXR1cm4gKDEwMDAgKiAoMSArIChkYmZnIC8gMTAwKSAqIDAuMDQ2MjEpKSAvIDEwMDBcbiAgICB9XG4gIH0pO1xuICAvL2NvbnRyb2xsZXIgZm9yIHRoZSByZWNpcGUgYnVpbGRlclxuICBhcHAuY29udHJvbGxlcigncmVjaXBlTWFrZScsIFsnJHNjb3BlJywgJyRodHRwJywgJ2p3dEhlbHBlcicsICdyZWNpcGVGdW5jJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgand0SGVscGVyLCByZWNpcGVGdW5jKXtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJztcbiAgICAvL2dldCBhbGwgaXRlbXMgbGlzdGVkIGluIHRoZSBzZWxlY3QgbWVudVxuICAgIGdldEl0ZW0oJ2dyYWlucycpO1xuICAgIGdldEl0ZW0oJ2hvcHMnKTtcbiAgICBnZXRJdGVtKCd5ZWFzdHMnKTtcbiAgICAvL1RoZSBvYmplY3QgdXNlZCBmb3IgcmVjaXBlIGNyZWF0aW9uIGFzIHdlbGwgYXMgY2FsY3VsYXRpb25zXG4gICAgJHNjb3BlLnJlY2lwZSA9e1xuICAgICAgZWZmaWNpZW5jeTogNjUsXG4gICAgICBhdHRlbnVhdGlvbjogNzAsXG4gICAgICB2b2x1bWU6IDUsXG4gICAgICBncmFpbnM6IHtcbiAgICAgICAgYWRkZWQ6IFtdXG4gICAgICB9LFxuICAgICAgaG9wczoge1xuICAgICAgICBhZGRlZDogW10sXG4gICAgICAgIGlidTogZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5pYnUoJHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkLCAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgJHNjb3BlLnJlY2lwZS52b2x1bWUsICRzY29wZS5yZWNpcGUub2coKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvZzogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCAkc2NvcGUucmVjaXBlLnZvbHVtZSksICRzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSlcbiAgICAgIH0sXG4gICAgICBmZzogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZmcoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsICRzY29wZS5yZWNpcGUub2coKSwgJHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbilcbiAgICAgIH0sXG4gICAgICBhYnY6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiByZWNpcGVGdW5jLmFidigkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgJHNjb3BlLnJlY2lwZS5vZygpLCAkc2NvcGUucmVjaXBlLmZnKCkpO1xuICAgICAgICB9LFxuICAgICAgc3JtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5zcm0oJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsICRzY29wZS5yZWNpcGUudm9sdW1lKTtcbiAgICAgICAgfSxcbiAgICAgIGRwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5kcCgkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodCgkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCkpO1xuICAgICAgICB9LFxuICAgICAgbm90ZXM6ICcnLFxuICAgICAgcmVjaXBleWVhc3Q6ICRzY29wZS55ZWFzdFxuICAgIH07XG4gICAgLy8gJHNjb3BlLnJlY2lwZSA9IHt9O1xuICAgIC8vICRzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSA9IDY1O1xuICAgIC8vICRzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24gPSA3MDtcbiAgICAvLyAkc2NvcGUucmVjaXBlLnZvbHVtZSA9IDU7XG4gICAgLy8gJHNjb3BlLnJlY2lwZS5ncmFpbnMgPSB7fTtcbiAgICAvLyAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCA9IFtdO1xuICAgIC8vICRzY29wZS5yZWNpcGUuaG9wcyA9IHt9O1xuICAgIC8vICRzY29wZS5yZWNpcGUuaG9wcy5hZGRlZCA9IFtdO1xuICAgIC8vICRzY29wZS5yZWNpcGUuaG9wcy5pYnUgPSBmdW5jdGlvbigpe1xuICAgIC8vICAgcmV0dXJuIHJlY2lwZUZ1bmMuaWJ1KCRzY29wZS5yZWNpcGUuaG9wcy5hZGRlZCwgJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsICRzY29wZS5yZWNpcGUudm9sdW1lKVxuICAgIC8vIH07XG4gICAgLy8gJHNjb3BlLnJlY2lwZS5vZyA9IGZ1bmN0aW9uKCl7XG4gICAgLy8gICByZXR1cm4gcmVjaXBlRnVuYy5lZmZpY2llbmN5UFBHKHJlY2lwZUZ1bmMudG90YWxQUEcoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsICRzY29wZS5yZWNpcGUudm9sdW1lKSwgJHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5KVxuICAgIC8vIH07XG4gICAgLy8gJHNjb3BlLnJlY2lwZS5mZyA9IGZ1bmN0aW9uKCl7XG4gICAgLy8gICByZXR1cm4gcmVjaXBlRnVuYy5mZygkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgJHNjb3BlLnJlY2lwZS5vZygpLCAkc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uKVxuICAgIC8vIH07XG4gICAgLy8gLy9hYnYgY2FsYyBiYXNlZCBvbiBlc3RpbWF0ZWQgT0cgYW5kIEZHXG4gICAgLy8gJHNjb3BlLnJlY2lwZS5hYnYgPSBmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuYWJ2KCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCAkc2NvcGUucmVjaXBlLm9nKCksICRzY29wZS5yZWNpcGUuZmcoKSk7XG4gICAgLy8gICB9O1xuICAgIC8vICRzY29wZS5yZWNpcGUuc3JtID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgIHJldHVybiByZWNpcGVGdW5jLnNybSgkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgJHNjb3BlLnJlY2lwZS52b2x1bWUpO1xuICAgIC8vICAgfTtcbiAgICAvLyAgIC8vZXN0aW1hdGUgZW56eW1hdGljIGFjdGl2aXR5IGJhc2VkIG9uIGdyYWlucyBhZGRlZFxuICAgIC8vICAgJHNjb3BlLnJlY2lwZS5kcCA9IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICByZXR1cm4gcmVjaXBlRnVuYy5kcCgkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodCgkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCkpO1xuICAgIC8vICAgfTtcbiAgICAvLyAgICRzY29wZS5yZWNpcGUubm90ZXMgPSAnJztcbiAgICAvLyAgICRzY29wZS5yZWNpcGV5ZWFzdCA9ICRzY29wZS55ZWFzdDtcblxuICAgICRzY29wZS5zYXZlUmVjaXBlID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciByZWNpcGUgPSB7XG4gICAgICAgIHVzZXJuYW1lOiAkc2NvcGUudXNlci51c2VybmFtZSxcbiAgICAgICAgbmFtZTogJHNjb3BlLnJlY2lwZS5uYW1lLFxuICAgICAgICBncmFpbnM6IHtcbiAgICAgICAgICBhZGRlZDogJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWRcbiAgICAgICAgfSxcbiAgICAgICAgZWZmaWNpZW5jeTogJHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5LFxuICAgICAgICB2b2x1bWU6ICRzY29wZS5yZWNpcGUudm9sdW1lLFxuICAgICAgICBhdHRlbnVhdGlvbjogJHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbixcbiAgICAgICAgaG9wczoge1xuICAgICAgICAgIGFkZGVkOiAkc2NvcGUucmVjaXBlLmhvcHMuYWRkZWRcbiAgICAgICAgfSxcbiAgICAgICAgbm90ZXM6ICRzY29wZS5ub3Rlc1xuICAgICAgfTtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMnLFxuICAgICAgICBkYXRhOiByZWNpcGVcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICB9XG4gICAgJHNjb3BlLmdldFNhdmVkUmVjaXBlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgdXJsOiAnL3ByaXZhdGUvcmVjaXBlcy9zYXZlZCdcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICB9O1xuICAgIC8vZ2VuZXJpYyBmdW5jdGlvbiB0byBhZGQgYW4gaXRlbSB0byB0aGUgYXJyYXkgZm9yIHRob3NlIGluZ3JlZGllbnRzXG4gICAgJHNjb3BlLmFkZEluZ3JlZGllbnQgPSBmdW5jdGlvbihpbmdyZWRpZW50LCB0eXBlKXtcbiAgICAgICRzY29wZS5yZWNpcGVbaW5ncmVkaWVudF0uYWRkZWQucHVzaCgkc2NvcGVbdHlwZV0pO1xuICAgICAgJHNjb3BlW3R5cGVdID0ge307XG4gICAgfVxuICAgIC8vcmVtb3ZlIGJ1dHRvbiBmdW5jdGlvbiAtIHJlbW92ZXMgb25lIGl0ZW0gZnJvbSB0aGUgYXJyYXlcbiAgICAkc2NvcGUuZGVsZXRlSXRlbSA9IGZ1bmN0aW9uKGluZGV4LCB0eXBlKSB7XG4gICAgICAkc2NvcGUucmVjaXBlW3R5cGVdLmFkZGVkLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIC8vZ2VuZXJpYyBmdW5jdGlvbiB0byBjYWxsIHRoZSBzZXJ2ZXIgZm9yIGEgc3BlY2lmaWMgaW5ncmVkaWVudFxuICAgIGZ1bmN0aW9uIGdldEl0ZW0oaXRlbSl7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHVybDogJy8nICsgaXRlbVxuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgJHNjb3BlW2l0ZW1dID0gcmVzLmRhdGE7XG4gICAgICB9KVxuICAgIH07XG4gICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH0sIGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKSB7XG4gICAgICAgICAgdmFyIHVzZXJUb2tlbiA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyVG9rZW47XG4gICAgICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ByaXZhdGUvdmlld3Mvc2F2ZWRyZWNpcGVzLmh0bWwnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfV0pO1xuXG5cbiAgLy9leHRyYSBmb3IgYSBjYWxjdWxhdG9yIGNvbnRyb2xsZXJcbiAgYXBwLmNvbnRyb2xsZXIoJ2Ric2dDYWxjJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuICAgIGNvbnNvbGUubG9nKCdjbGlja2VkJyk7XG4gICAgY29uc29sZS5sb2coJHNjb3BlLmRiZmcgKyAkc2NvcGUubmFtZSk7XG4gICAgLy8gJHNjb3BlLmFkZGdyYWluID0gZnVuY3Rpb24oKXtcbiAgICAvLyAgIGlmKCEkc2NvcGUuZ3JhaW5zKSB7XG4gICAgLy8gICAgICRzY29wZS5ncmFpbnMgPSBbXTtcbiAgICAvLyAgIH1cbiAgICAvLyAgICRzY29wZS5ncmFpbnMucHVzaCgkc2NvcGUuZ3JhaW4pO1xuICAgIC8vICAgJHNjb3BlLmdyYWluID0ge307XG4gICAgLy8gfVxuICB9XSk7XG5cblxuICAvL2NvbnRyb2xsZXIgZm9yIGxvZ2luIHNjcmVlbiAtIHNlbmRzIHVzZXIvcGFzcyBhbmQgc3RvcmVzIGp3dFxuICBhcHAuY29udHJvbGxlcignbG9naW5Db250cm9sJywgWyckcm9vdFNjb3BlJywgJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS51c2VyTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgICB1cmw6ICcvbG9naW5hdXRoJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBpZihyZXMuZGF0YS50b2tlbil7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlclRva2VuJywgcmVzLmRhdGEudG9rZW4pO1xuICAgICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xuICAgICAgICB9O1xuICAgICAgfSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gcmVzLmRhdGE7XG4gICAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gJyc7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuXG4gIC8vY29udHJvbGxlciBmb3IgcmVnaXN0ZXIgcGFnZSAtIHNlbmRzIG5ldyB1c2VyIGluZm8gYW5kIHJldHVybnMgdGhhdCBkYXRhXG4gIGFwcC5jb250cm9sbGVyKCdyZWdpc3RlckNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5yZWdpc3RlclVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9yZWdpc3RlcidcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSByZXMuZGF0YTtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnL2xvZ2luJyk7XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG4gIGFwcC5jb250cm9sbGVyKCdoZWFkZXJDb250cm9sJywgWyckcm9vdFNjb3BlJywgJyRzY29wZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsIGp3dEhlbHBlcil7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcblxuICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpe1xuICAgICAgICAkc2NvcGUudXNlciA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ291dCAnICsgJHNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy8nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW4gPSAnTG9naW4vUmVnaXN0ZXInO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvbG9naW4nXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9XG4gIH1dKTtcbiIsImFwcC5zZXJ2aWNlKCdyZWNpcGVGdW5jJywgZnVuY3Rpb24oKXtcbiAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIHdlaWdodCBvZiBhbGwgZ3JhaW5zIGFkZGVkXG4gIHRoaXMudG90YWxXZWlnaHQgPSBmdW5jdGlvbihpbmdyZWRpZW50cyl7XG4gICAgdmFyIHRvdGFsID0gMDtcbiAgICBpbmdyZWRpZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGluZ3JlZGllbnQpe1xuICAgICAgaWYoaW5ncmVkaWVudC53ZWlnaHQgPiAwKXtcbiAgICAgICAgdG90YWwgKz0gcGFyc2VJbnQoaW5ncmVkaWVudC53ZWlnaHQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH07XG4gIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSBtYXggc3VnYXIgZXh0cmFjdGlvbiBwb3NzaWJsZSBmcm9tIHRoZSBncmFpbnNcbiAgdGhpcy50b3RhbFBQRyA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICB2YXIgdG90YWwgPSAwO1xuICAgIGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCl7XG4gICAgICB0b3RhbCArPSAoTWF0aC5yb3VuZCgoZ3JhaW4uUFBHIC0gMSkgKiAxMDAwICogZ3JhaW4ud2VpZ2h0IC8gdm9sdW1lKSkgLyAxMDAwO1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbiAgfTtcbiAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIGVzdGltYXRlZCBzdWdhciBleHRyYWN0aW9uIGJhc2VkIG9uIHVzZXIncyBlZmYuIGlucHV0XG4gIHRoaXMuZWZmaWNpZW5jeVBQRyA9IGZ1bmN0aW9uKHRvdGFsUFBHLCBlZmZpY2llbmN5KSB7XG4gICAgaWYodG90YWxQUEcgPT09IDApe1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVmZlBQRyA9IE1hdGgucm91bmQodG90YWxQUEcgKiAoZWZmaWNpZW5jeSAvIDEwMCkgKiAxMDAwKSAvIDEwMDAgKyAxO1xuICAgICAgICBpZihlZmZQUEcgPiAxLjUpIHtcbiAgICAgICAgICBlZmZQUEcgPSAxLjU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZWZmUFBHLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgIGVmZlBQRyA9IGVmZlBQRy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZWZmUFBHO1xuICAgICAgfVxuICB9O1xuICAvL2NhbGN1bGF0ZXMgaWJ1J3MgZm9yIHVzZXIncyBpbnB1dCBob3BzXG4gIHRoaXMuaWJ1ID0gZnVuY3Rpb24oaG9wcywgZ3JhaW5zLCB2b2x1bWUsIG9nKSB7XG4gICAgaWYoaG9wcy5sZW5ndGggPiAwICYmIGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgaWJ1ID0gMDtcbiAgICAgIHZhciBhYXUgPSAwO1xuICAgICAgdmFyIGJpZ0ZhY3QgPSAxLjY1ICogTWF0aC5wb3coMC4wMDAxMjUsIChvZyAtIDEpKTtcbiAgICAgIGhvcHMuZm9yRWFjaChmdW5jdGlvbihob3ApIHtcbiAgICAgICAgYWF1ID0gaG9wLndlaWdodCAqIChob3AuQWxwaGFfQWNpZCAvIDEwMCkgKiA3NDkwIC8gdm9sdW1lO1xuICAgICAgICBpZihob3AuaG9wVHlwZSA9PSAnYm9pbCcpIHtcbiAgICAgICAgICB2YXIgYm9pbFRGYWN0ID0gKCgxIC0gTWF0aC5wb3coMi43MTgyODE4Mjg0NTkwNDUyMzUzNiwgKC0uMDQgKiBob3AuaG9wVGltZSkpKSAvIDMuOCk7XG4gICAgICAgICAgdmFyIHV0aWwgPSBiaWdGYWN0ICogYm9pbFRGYWN0O1xuICAgICAgICAgIGlidSArPSB1dGlsICogYWF1O1xuICAgICAgICB9IGVsc2UgaWYoaG9wLmhvcFR5cGUgPT0gJ3doaXJscG9vbCcpIHtcbiAgICAgICAgICB2YXIgdXRpbCA9IC4xMDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKGlidSAqIDEwMCkgLyAxMDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9O1xuICAvL3RoaXMgY2FsY3VsYXRlcyB0aGUgZmluYWwgZ3Jhdml0eSBiYXNlZCBvbiBhdHRlbnVhdGlvblxuICB0aGlzLmZnID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgYXR0ZW51YXRpb24pe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgeWVhc3RGb29kID0gTWF0aC5yb3VuZCgoKG9nIC0gMSkgKiAxMDAwKSAqIChhdHRlbnVhdGlvbiAvIDEwMCkpIC8gMTAwMDtcbiAgICAgIHllYXN0Rm9vZCA9IG9nIC0geWVhc3RGb29kO1xuICAgICAgaWYoeWVhc3RGb29kLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICB5ZWFzdEZvb2QgPSB5ZWFzdEZvb2QudG9TdHJpbmcoKS5zbGljZSgwLCA1KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB5ZWFzdEZvb2Q7XG4gICAgfSBlbHNlIHtcbiAgICByZXR1cm4gMFxuICAgIH1cbiAgfTtcbiAgICAgIC8vZXN0aW1hdGUgY29sb3IgYmFzZWQgb24gZ3JhaW5zIGFkZGVkXG4gIHRoaXMuc3JtID0gZnVuY3Rpb24oZ3JhaW5zLCB2b2x1bWUpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgdG90YWxDb2xvciA9IDA7XG4gICAgICB2YXIgbWN1ID0gZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgIHRvdGFsQ29sb3IgKz0gKGdyYWluLmxvdmkgKiBncmFpbi53ZWlnaHQpO1xuICAgICAgfSk7XG4gICAgICBtY3UgPSB0b3RhbENvbG9yIC8gdm9sdW1lO1xuICAgICAgbWN1ID0gTWF0aC5yb3VuZCgoMS40OTIyICogKE1hdGgucG93KG1jdSwgMC42ODU5KSkpICogMTAwKSAvIDEwMDtcbiAgICAgIGlmKG1jdSA+IDUwKXtcbiAgICAgICAgbWN1ID0gNTA7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1jdTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgIH07XG4gIHRoaXMuYWJ2ID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgZmcpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZCgoNzYuMDggKiAob2ctZmcpIC8gKDEuNzc1IC0gb2cpKSAqIChmZyAvIDAuNzk0KSAqIDEwMCkgLyAxMDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwXG4gICAgfVxuICB9O1xuICB0aGlzLmRwID0gZnVuY3Rpb24oZ3JhaW5zLCB0b3RhbFdlaWdodCl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0b3RhbGRwID0gMDtcbiAgICAgIGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICB0b3RhbGRwICs9IGdyYWluLmRwICogZ3JhaW4ud2VpZ2h0O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZCh0b3RhbGRwIC8gdG90YWxXZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9