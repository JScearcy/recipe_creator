var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,r,n){t.html5Mode(!0),n.tokenGetter=function(){return sessionStorage.getItem("userToken")},r.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,r){r.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){r.$validate()})}}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,r){e.user={},e.user.recipetemplate="/views/notloggedin.html",r.getItem(t,e,"grains"),r.getItem(t,e,"hops"),r.getItem(t,e,"yeasts"),e.recipe=new r.recipe(e,r),e.saveRecipe=function(){return r.saveRecipe(t,e,r)},e.addIngredient=function(t,i,n){switch(i){case"grains":var o=new r.newGrain(t);break;case"hops":var o=new r.newHop(t);break;default:var o={}}e.recipe[i].added.push(o),e[n]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.getSavedRecipes=function(){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,r){e.recipes[r]=i.calculateStats(t,i)})})}}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,r){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,r){if(e.length>0&&t.length>0){var n=0,o=0,a=1.65*Math.pow(125e-6,r-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,r=a*t;n+=r*o}else if("whirlpool"==e.hopType){var r=.1;n+=r*o}}),Math.round(100*n)/100}return 0},this.fg=function(e,t,i){if(t>0){var r=Math.round(1e3*(t-1)*(i/100))/1e3;return r=t-r,r.toString().length>5&&(r=r.toString().slice(0,5)),r}return 0},this.srm=function(e,t){if(e.length>0){var i=0,r=e.forEach(function(e,t){i+=e.lovi*e.weight});return r=i/t,r=Math.round(1.4922*Math.pow(r,.6859)*100)/100,r>50&&(r=50),r}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=75,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){var r={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:r}).then(function(e){t.recipe=new i.recipe(t,i)})}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return 1e3*(1+e/100*.04621)/1e3}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJlY2lwZXNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwiand0SW50ZXJjZXB0b3JQcm92aWRlciIsImh0bWw1TW9kZSIsInRva2VuR2V0dGVyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJzY29wZSIsIm90aGVyVmFsIiwibGluayIsImVsZW0iLCJhdHRyIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiaXNNYXRjaCIsIm1vZGVsVmFsIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJyZWNpcGVGdW5jIiwidXNlciIsInJlY2lwZXRlbXBsYXRlIiwicmVjaXBlIiwic2F2ZVJlY2lwZSIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsIm1vZGVsIiwiYWRkZWRJbmdyZWRpZW50IiwibmV3R3JhaW4iLCJuZXdIb3AiLCJhZGRlZCIsImRlbGV0ZUl0ZW0iLCJpbmRleCIsInNwbGljZSIsInVzZXJUb2tlbiIsImRlY29kZVRva2VuIiwiJGxvY2F0aW9uIiwidXNlckxvZ2luIiwibWV0aG9kIiwiZGF0YSIsInVybCIsInRoZW4iLCJyZXMiLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsImdldFNhdmVkUmVjaXBlcyIsInJlY2lwZXMiLCJmb3JFYWNoIiwiY2FsY3VsYXRlU3RhdHMiLCJzZXJ2aWNlIiwidGhpcyIsInRvdGFsV2VpZ2h0IiwiaW5ncmVkaWVudHMiLCJ0b3RhbCIsIndlaWdodCIsInBhcnNlSW50IiwidG90YWxQUEciLCJncmFpbnMiLCJ2b2x1bWUiLCJncmFpbiIsIk1hdGgiLCJyb3VuZCIsIlBQRyIsImVmZmljaWVuY3lQUEciLCJlZmZpY2llbmN5IiwiZWZmUFBHIiwidG9TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImlidSIsImhvcHMiLCJvZyIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJob3AiLCJBbHBoYV9BY2lkIiwiaG9wVHlwZSIsImJvaWxURmFjdCIsImhvcFRpbWUiLCJ1dGlsIiwiZmciLCJhdHRlbnVhdGlvbiIsInllYXN0Rm9vZCIsInNybSIsInRvdGFsQ29sb3IiLCJtY3UiLCJsb3ZpIiwiYWJ2IiwiZHAiLCJ0b3RhbGRwIiwiZ3JhaW5PYmoiLCJjaGFyYW5kQXBwcyIsImZsYXZvciIsImlkIiwibmFtZSIsImhvcE9iaiIsIkJldGFfQWNpZCIsIk5hbWUiLCJOb3RlcyIsIk9yaWdpbiIsIlR5cGUiLCJub3RlcyIsInJlY2lwZXllYXN0IiwieWVhc3QiLCJodHRwIiwiaXRlbSIsImNhbGNQcGciLCJkYmZnIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGlCQUFBLGFBQUEsVUFBQSxlQUNBRixLQUFBRyxRQUFBLGlCQUNBLG9CQUNBLHFCQUNBLGdCQUNBLHlCQUNBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FILEVBQUFJLFdBQUEsR0FFQUQsRUFBQUUsWUFBQSxXQUNBLE1BQUFDLGdCQUFBQyxRQUFBLGNBRUFMLEVBQUFNLGFBQUFDLEtBQUEsa0JBRUFSLEVBQUFTLE1BQUEsV0FDQUMsZUFBQSxTQUNBQyxjQUFBLFVBRUFiLEVBQUFjLEtBQUEsS0FDQUMsWUFBQSxzQkFDQUMsV0FBQSxlQUNBRixLQUFBLGNBQ0FDLFlBQUEsdUJBQ0FDLFdB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LFVBQUEsV0FDQUMsS0FBQXlELFFBQUEsU0FBQUMsR0FDQSxNQUFBLE1BQUEsRUFBQUEsRUFBQSxJQUFBLFFBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdyZWNpcGVDcmVhdG9yJywgWyduZ01hdGVyaWFsJywgJ25nUm91dGUnLCAnYW5ndWxhci1qd3QnXSk7XG4gIGFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsXG4gICAgICAgICAgICAgICckbG9jYXRpb25Qcm92aWRlcicsXG4gICAgICAgICAgICAgICckbWRUaGVtaW5nUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGh0dHBQcm92aWRlcicsXG4gICAgICAgICAgICAgICdqd3RJbnRlcmNlcHRvclByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIsICRodHRwUHJvdmlkZXIsIGp3dEludGVyY2VwdG9yUHJvdmlkZXIpe1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgIGp3dEludGVyY2VwdG9yUHJvdmlkZXIudG9rZW5HZXR0ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH1cbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdqd3RJbnRlcmNlcHRvcicpO1xuXG4gICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnYW1iZXInKVxuICAgICAgLmFjY2VudFBhbGV0dGUoJ3llbGxvdycpO1xuXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KS53aGVuKCcvZGJzZ19jYWxjJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvZGJzZ2NhbGMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnZGJzZ0NhbGMnXG4gICAgfSkud2hlbignL2xvZ2luJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sJ1xuICAgIH0pLndoZW4oJy9yZWdpc3RlcicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOicvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVnaXN0ZXJDb250cm9sJ1xuICAgIH0pLm90aGVyd2lzZSgnLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KTtcbiAgfV0pO1xuICBhcHAuZGlyZWN0aXZlKCdpc01hdGNoJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgc2NvcGU6IHtcbiAgICAgICAgb3RoZXJWYWw6IFwiPWlzTWF0Y2hcIlxuICAgICAgfSxcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtLCBhdHRyLCBuZ01vZGVsKSB7XG4gICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuaXNNYXRjaCA9IGZ1bmN0aW9uKG1vZGVsVmFsKSB7XG4gICAgICAgICAgcmV0dXJuIG1vZGVsVmFsID09PSBzY29wZS5vdGhlclZhbDtcbiAgICAgICAgfTtcbiAgICAgICAgc2NvcGUuJHdhdGNoKCdvdGhlclZhbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG4gIC8vY29udHJvbGxlciBmb3IgdGhlIHJlY2lwZSBidWlsZGVyXG4gIGFwcC5jb250cm9sbGVyKCdyZWNpcGVNYWtlJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnand0SGVscGVyJywgJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBqd3RIZWxwZXIsIHJlY2lwZUZ1bmMpe1xuICAgICRzY29wZS51c2VyID0ge307XG4gICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnO1xuXG4gICAgLy9nZXQgYWxsIGl0ZW1zIGxpc3RlZCBpbiB0aGUgc2VsZWN0IG1lbnVcbiAgICByZWNpcGVGdW5jLmdldEl0ZW0oJGh0dHAsICRzY29wZSwgJ2dyYWlucycpO1xuICAgIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAnaG9wcycpO1xuICAgIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAneWVhc3RzJyk7XG5cbiAgICAvL1RoZSBvYmplY3QgdXNlZCBmb3IgcmVjaXBlIGNyZWF0aW9uIGFzIHdlbGwgYXMgY2FsY3VsYXRpb25zXG4gICAgJHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZSgkc2NvcGUsIHJlY2lwZUZ1bmMpO1xuXG4gICAgLy9TYXZlIGZ1bmN0aW9uIGZvciBidXR0b24gbmctY2xpY2tcbiAgICAkc2NvcGUuc2F2ZVJlY2lwZSA9IGZ1bmN0aW9uKCl7IHJldHVybiByZWNpcGVGdW5jLnNhdmVSZWNpcGUoJGh0dHAsICRzY29wZSwgcmVjaXBlRnVuYyl9O1xuXG4gICAgLy9nZW5lcmljIGZ1bmN0aW9uIHRvIGFkZCBhbiBpdGVtIHRvIHRoZSBhcnJheSBmb3IgdGhvc2UgaW5ncmVkaWVudHNcbiAgICAkc2NvcGUuYWRkSW5ncmVkaWVudCA9IGZ1bmN0aW9uKGluZ3JlZGllbnQsIHR5cGUsIG1vZGVsKXtcbiAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ2dyYWlucyc6XG4gICAgICAgICAgdmFyIGFkZGVkSW5ncmVkaWVudCA9IG5ldyByZWNpcGVGdW5jLm5ld0dyYWluKGluZ3JlZGllbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdob3BzJzpcbiAgICAgICAgICB2YXIgYWRkZWRJbmdyZWRpZW50ID0gbmV3IHJlY2lwZUZ1bmMubmV3SG9wKGluZ3JlZGllbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHZhciBhZGRlZEluZ3JlZGllbnQgPSB7fTtcbiAgICAgIH07XG4gICAgICAkc2NvcGUucmVjaXBlW3R5cGVdLmFkZGVkLnB1c2goYWRkZWRJbmdyZWRpZW50KTtcbiAgICAgICRzY29wZVttb2RlbF0gPSB7fTtcbiAgICB9XG4gICAgLy9yZW1vdmUgYnV0dG9uIGZ1bmN0aW9uIC0gcmVtb3ZlcyBvbmUgaXRlbSBmcm9tIHRoZSBhcnJheVxuICAgICRzY29wZS5kZWxldGVJdGVtID0gZnVuY3Rpb24oaW5kZXgsIHR5cGUpIHtcbiAgICAgICRzY29wZS5yZWNpcGVbdHlwZV0uYWRkZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG5cbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpIHtcbiAgICAgICAgICB2YXIgdXNlclRva2VuID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXJUb2tlbjtcbiAgICAgICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvcHJpdmF0ZS92aWV3cy9zYXZlZHJlY2lwZXMuaHRtbCdcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XSk7XG4gIC8vY29udHJvbGxlciBmb3IgbG9naW4gc2NyZWVuIC0gc2VuZHMgdXNlci9wYXNzIGFuZCBzdG9yZXMgand0XG4gIGFwcC5jb250cm9sbGVyKCdsb2dpbkNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS51c2VyTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgICB1cmw6ICcvbG9naW5hdXRoJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBpZihyZXMuZGF0YS50b2tlbil7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlclRva2VuJywgcmVzLmRhdGEudG9rZW4pO1xuICAgICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xuICAgICAgICB9O1xuICAgICAgfSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gcmVzLmRhdGE7XG4gICAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gJyc7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuXG4gIC8vY29udHJvbGxlciBmb3IgcmVnaXN0ZXIgcGFnZSAtIHNlbmRzIG5ldyB1c2VyIGluZm8gYW5kIHJldHVybnMgdGhhdCBkYXRhXG4gIGFwcC5jb250cm9sbGVyKCdyZWdpc3RlckNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5yZWdpc3RlclVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9yZWdpc3RlcidcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSByZXMuZGF0YTtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnL2xvZ2luJyk7XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG4gIGFwcC5jb250cm9sbGVyKCdoZWFkZXJDb250cm9sJywgWyckc2NvcGUnLCAnand0SGVscGVyJywgZnVuY3Rpb24oJHNjb3BlLCBqd3RIZWxwZXIpe1xuICAgICRzY29wZS51c2VyID0ge307XG5cbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKXtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBqd3RIZWxwZXIuZGVjb2RlVG9rZW4oc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dvdXQgJyArICRzY29wZS51c2VyLnVzZXJuYW1lO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ2luL1JlZ2lzdGVyJztcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW5VcmwgPSAnL2xvZ2luJ1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLmxvZ091dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlclRva2VuJyk7XG4gICAgfTtcbiAgfV0pO1xuXG4gIGFwcC5jb250cm9sbGVyKCdzYXZlZFJlY2lwZXMnLCBbJyRzY29wZScsICckaHR0cCcsJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCByZWNpcGVGdW5jKXtcbiAgICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL3NhdmVkJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAgICRzY29wZS5yZWNpcGVzID0gcmVzLmRhdGE7XG4gICAgICAgICAgJHNjb3BlLnJlY2lwZXMuZm9yRWFjaChmdW5jdGlvbihyZWNpcGUsIGluZGV4KXtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVzW2luZGV4XSA9IHJlY2lwZUZ1bmMuY2FsY3VsYXRlU3RhdHMocmVjaXBlLCByZWNpcGVGdW5jKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIH07XG4gIH1dKTtcbiIsImFwcC5zZXJ2aWNlKCdyZWNpcGVGdW5jJywgZnVuY3Rpb24oKXtcbiAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIHdlaWdodCBvZiBhbGwgZ3JhaW5zIGFkZGVkXG4gIHRoaXMudG90YWxXZWlnaHQgPSBmdW5jdGlvbihpbmdyZWRpZW50cyl7XG4gICAgdmFyIHRvdGFsID0gMDtcbiAgICBpbmdyZWRpZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGluZ3JlZGllbnQpe1xuICAgICAgaWYoaW5ncmVkaWVudC53ZWlnaHQgPiAwKXtcbiAgICAgICAgdG90YWwgKz0gcGFyc2VJbnQoaW5ncmVkaWVudC53ZWlnaHQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH07XG4gIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSBtYXggc3VnYXIgZXh0cmFjdGlvbiBwb3NzaWJsZSBmcm9tIHRoZSBncmFpbnNcbiAgdGhpcy50b3RhbFBQRyA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICB2YXIgdG90YWwgPSAwO1xuICAgIGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCl7XG4gICAgICB0b3RhbCArPSAoTWF0aC5yb3VuZCgoZ3JhaW4uUFBHIC0gMSkgKiAxMDAwICogZ3JhaW4ud2VpZ2h0IC8gdm9sdW1lKSkgLyAxMDAwO1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbiAgfTtcbiAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIGVzdGltYXRlZCBzdWdhciBleHRyYWN0aW9uIGJhc2VkIG9uIHVzZXIncyBlZmYuIGlucHV0XG4gIHRoaXMuZWZmaWNpZW5jeVBQRyA9IGZ1bmN0aW9uKHRvdGFsUFBHLCBlZmZpY2llbmN5KSB7XG4gICAgaWYodG90YWxQUEcgPT09IDApe1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVmZlBQRyA9IE1hdGgucm91bmQodG90YWxQUEcgKiAoZWZmaWNpZW5jeSAvIDEwMCkgKiAxMDAwKSAvIDEwMDAgKyAxO1xuICAgICAgICBpZihlZmZQUEcgPiAxLjUpIHtcbiAgICAgICAgICBlZmZQUEcgPSAxLjU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZWZmUFBHLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgIGVmZlBQRyA9IGVmZlBQRy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZWZmUFBHO1xuICAgICAgfVxuICB9O1xuICAvL2NhbGN1bGF0ZXMgaWJ1J3MgZm9yIHVzZXIncyBpbnB1dCBob3BzXG4gIHRoaXMuaWJ1ID0gZnVuY3Rpb24oaG9wcywgZ3JhaW5zLCB2b2x1bWUsIG9nKSB7XG4gICAgaWYoaG9wcy5sZW5ndGggPiAwICYmIGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgaWJ1ID0gMDtcbiAgICAgIHZhciBhYXUgPSAwO1xuICAgICAgdmFyIGJpZ0ZhY3QgPSAxLjY1ICogTWF0aC5wb3coMC4wMDAxMjUsIChvZyAtIDEpKTtcbiAgICAgIGhvcHMuZm9yRWFjaChmdW5jdGlvbihob3ApIHtcbiAgICAgICAgYWF1ID0gaG9wLndlaWdodCAqIChob3AuQWxwaGFfQWNpZCAvIDEwMCkgKiA3NDkwIC8gdm9sdW1lO1xuICAgICAgICBpZihob3AuaG9wVHlwZSA9PSAnYm9pbCcpIHtcbiAgICAgICAgICB2YXIgYm9pbFRGYWN0ID0gKCgxIC0gTWF0aC5wb3coMi43MTgyODE4Mjg0NTkwNDUyMzUzNiwgKC0uMDQgKiBob3AuaG9wVGltZSkpKSAvIDMuOCk7XG4gICAgICAgICAgdmFyIHV0aWwgPSBiaWdGYWN0ICogYm9pbFRGYWN0O1xuICAgICAgICAgIGlidSArPSB1dGlsICogYWF1O1xuICAgICAgICB9IGVsc2UgaWYoaG9wLmhvcFR5cGUgPT0gJ3doaXJscG9vbCcpIHtcbiAgICAgICAgICB2YXIgdXRpbCA9IC4xMDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKGlidSAqIDEwMCkgLyAxMDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9O1xuICAvL3RoaXMgY2FsY3VsYXRlcyB0aGUgZmluYWwgZ3Jhdml0eSBiYXNlZCBvbiBhdHRlbnVhdGlvblxuICB0aGlzLmZnID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgYXR0ZW51YXRpb24pe1xuICAgIGlmKG9nID4gMCkge1xuICAgICAgdmFyIHllYXN0Rm9vZCA9IE1hdGgucm91bmQoKChvZyAtIDEpICogMTAwMCkgKiAoYXR0ZW51YXRpb24gLyAxMDApKSAvIDEwMDA7XG4gICAgICB5ZWFzdEZvb2QgPSBvZyAtIHllYXN0Rm9vZDtcbiAgICAgIGlmKHllYXN0Rm9vZC50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgeWVhc3RGb29kID0geWVhc3RGb29kLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geWVhc3RGb29kO1xuICAgIH0gZWxzZSB7XG4gICAgcmV0dXJuIDBcbiAgICB9XG4gIH07XG4gICAgICAvL2VzdGltYXRlIGNvbG9yIGJhc2VkIG9uIGdyYWlucyBhZGRlZFxuICB0aGlzLnNybSA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsQ29sb3IgPSAwO1xuICAgICAgdmFyIG1jdSA9IGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICB0b3RhbENvbG9yICs9IChncmFpbi5sb3ZpICogZ3JhaW4ud2VpZ2h0KTtcbiAgICAgIH0pO1xuICAgICAgbWN1ID0gdG90YWxDb2xvciAvIHZvbHVtZTtcbiAgICAgIG1jdSA9IE1hdGgucm91bmQoKDEuNDkyMiAqIChNYXRoLnBvdyhtY3UsIDAuNjg1OSkpKSAqIDEwMCkgLyAxMDA7XG4gICAgICBpZihtY3UgPiA1MCl7XG4gICAgICAgIG1jdSA9IDUwO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtY3U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9O1xuICB0aGlzLmFidiA9IGZ1bmN0aW9uKGdyYWlucywgb2csIGZnKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoKDc2LjA4ICogKG9nLWZnKSAvICgxLjc3NSAtIG9nKSkgKiAoZmcgLyAwLjc5NCkgKiAxMDApIC8gMTAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMFxuICAgIH1cbiAgfTtcbiAgdGhpcy5kcCA9IGZ1bmN0aW9uKGdyYWlucywgdG90YWxXZWlnaHQpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgdG90YWxkcCA9IDA7XG4gICAgICBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgdG90YWxkcCArPSBncmFpbi5kcCAqIGdyYWluLndlaWdodDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQodG90YWxkcCAvIHRvdGFsV2VpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG4gIHRoaXMubmV3R3JhaW4gPSBmdW5jdGlvbihncmFpbk9iaikge1xuICAgIHRoaXMuUFBHID0gZ3JhaW5PYmouUFBHO1xuICAgIHRoaXMuY2hhcmFuZEFwcHMgPSBncmFpbk9iai5jaGFyYW5kQXBwcztcbiAgICB0aGlzLmRwID0gZ3JhaW5PYmouZHA7XG4gICAgdGhpcy5mbGF2b3IgPSBncmFpbk9iai5mbGF2b3I7XG4gICAgdGhpcy5pZCA9IGdyYWluT2JqLmlkO1xuICAgIHRoaXMubG92aSA9IGdyYWluT2JqLmxvdmk7XG4gICAgdGhpcy5uYW1lID0gZ3JhaW5PYmoubmFtZTtcbiAgICB0aGlzLndlaWdodD0gZ3JhaW5PYmoud2VpZ2h0O1xuICB9O1xuICB0aGlzLm5ld0hvcCA9IGZ1bmN0aW9uKGhvcE9iaikge1xuICAgIHRoaXMuQWxwaGFfQWNpZCA9IGhvcE9iai5BbHBoYV9BY2lkO1xuICAgIHRoaXMuQmV0YV9BY2lkID0gaG9wT2JqLkJldGFfQWNpZDtcbiAgICB0aGlzLk5hbWUgPSBob3BPYmouTmFtZTtcbiAgICB0aGlzLk5vdGVzID0gaG9wT2JqLk5vdGVzO1xuICAgIHRoaXMuT3JpZ2luID0gaG9wT2JqLk9yaWdpbjtcbiAgICB0aGlzLlR5cGUgPSBob3BPYmouVHlwZTtcbiAgICB0aGlzLmhvcFRpbWUgPSBob3BPYmouaG9wVGltZTtcbiAgICB0aGlzLmhvcFR5cGUgPSBob3BPYmouaG9wVHlwZTtcbiAgICB0aGlzLndlaWdodCA9IGhvcE9iai53ZWlnaHQ7XG4gIH07XG4gIHRoaXMucmVjaXBlID0gZnVuY3Rpb24oc2NvcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICB0aGlzLmVmZmljaWVuY3kgPSA2NTtcbiAgICB0aGlzLmF0dGVudWF0aW9uID0gNzU7XG4gICAgdGhpcy52b2x1bWUgPSA1O1xuICAgIHRoaXMuZ3JhaW5zID0ge1xuICAgICAgYWRkZWQ6IFtdXG4gICAgfTtcbiAgICB0aGlzLmhvcHMgPSB7XG4gICAgICBhZGRlZDogW10sXG4gICAgICBpYnU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmlidShzY29wZS5yZWNpcGUuaG9wcy5hZGRlZCwgc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSwgc2NvcGUucmVjaXBlLm9nKCkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5vZyA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gcmVjaXBlRnVuYy5lZmZpY2llbmN5UFBHKHJlY2lwZUZ1bmMudG90YWxQUEcoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSksIHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5KVxuICAgIH07XG4gICAgdGhpcy5mZyA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gcmVjaXBlRnVuYy5mZyhzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUub2coKSwgc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uKVxuICAgIH07XG4gICAgdGhpcy5hYnYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuYWJ2KHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS5vZygpLCBzY29wZS5yZWNpcGUuZmcoKSk7XG4gICAgICB9O1xuICAgIHRoaXMuc3JtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLnNybShzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUudm9sdW1lKTtcbiAgICAgIH07XG4gICAgdGhpcy5kcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5kcChzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGVGdW5jLnRvdGFsV2VpZ2h0KHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQpKTtcbiAgICAgIH07XG4gICAgdGhpcy5ub3RlcyA9ICcnO1xuICAgIHRoaXMucmVjaXBleWVhc3QgPSAgc2NvcGUueWVhc3Q7XG4gIH07XG5cbiAgdGhpcy5jYWxjdWxhdGVTdGF0cyA9IGZ1bmN0aW9uKHJlY2lwZSwgcmVjaXBlRnVuYykge1xuICAgIHJlY2lwZS5vZyA9IHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUpLCByZWNpcGUuZWZmaWNpZW5jeSk7XG4gICAgcmVjaXBlLmZnID0gcmVjaXBlRnVuYy5mZyhyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUub2csIHJlY2lwZS5hdHRlbnVhdGlvbik7XG4gICAgcmVjaXBlLmFidiA9IHJlY2lwZUZ1bmMuYWJ2KHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS5vZywgcmVjaXBlLmZnKTtcbiAgICByZWNpcGUuc3JtID0gcmVjaXBlRnVuYy5zcm0ocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLnZvbHVtZSk7XG4gICAgcmVjaXBlLmRwID0gcmVjaXBlRnVuYy5kcChyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGVGdW5jLnRvdGFsV2VpZ2h0KHJlY2lwZS5ncmFpbnMuYWRkZWQpKTtcbiAgICByZWNpcGUuaG9wcy5pYnUgPSByZWNpcGVGdW5jLmlidShyZWNpcGUuaG9wcy5hZGRlZCwgcmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLnZvbHVtZSwgcmVjaXBlLm9nKTtcbiAgICByZXR1cm4gcmVjaXBlO1xuICB9O1xuICB0aGlzLmdldEl0ZW0gPSBmdW5jdGlvbihodHRwLCBzY29wZSwgaXRlbSkge1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHVybDogJy8nICsgaXRlbVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICBzY29wZVtpdGVtXSA9IHJlcy5kYXRhO1xuICAgIH0pO1xuICB9O1xuICB0aGlzLnNhdmVSZWNpcGUgPSBmdW5jdGlvbihodHRwLCBzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHZhciByZWNpcGUgPSB7XG4gICAgICB1c2VybmFtZTogc2NvcGUudXNlci51c2VybmFtZSxcbiAgICAgIG5hbWU6IHNjb3BlLnJlY2lwZS5uYW1lLFxuICAgICAgZ3JhaW5zOiB7XG4gICAgICAgIGFkZGVkOiBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkXG4gICAgICB9LFxuICAgICAgZWZmaWNpZW5jeTogc2NvcGUucmVjaXBlLmVmZmljaWVuY3ksXG4gICAgICB2b2x1bWU6IHNjb3BlLnJlY2lwZS52b2x1bWUsXG4gICAgICBhdHRlbnVhdGlvbjogc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uLFxuICAgICAgaG9wczoge1xuICAgICAgICBhZGRlZDogc2NvcGUucmVjaXBlLmhvcHMuYWRkZWRcbiAgICAgIH0sXG4gICAgICBub3Rlczogc2NvcGUubm90ZXMsXG4gICAgICB5ZWFzdDogc2NvcGUueWVhc3RcbiAgICB9O1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzJyxcbiAgICAgIGRhdGE6IHJlY2lwZVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgIHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZShzY29wZSwgcmVjaXBlRnVuYyk7XG4gICAgfSlcbiAgfVxufSk7XG5cbmFwcC5zZXJ2aWNlKCdQcGdDYWxjJywgZnVuY3Rpb24gKCl7XG4gIHRoaXMuY2FsY1BwZyA9IGZ1bmN0aW9uKGRiZmcpIHtcbiAgICByZXR1cm4gKDEwMDAgKiAoMSArIChkYmZnIC8gMTAwKSAqIDAuMDQ2MjEpKSAvIDEwMDBcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=