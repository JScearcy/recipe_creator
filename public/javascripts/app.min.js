var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,r,n,o){t.html5Mode(!0),o.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),r.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,r,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return 1e3*(1+e/100*.04621)/1e3}}),app.controller("recipeMake",["$scope","$http","jwtHelper",function(e,t,r){function n(r){t({method:"GET",url:"/"+r}).then(function(t){e[r]=t.data})}e.user={},e.user.recipetemplate="/views/notloggedin.html",n("grains"),n("hops"),n("yeasts"),e.recipe={name:"",grains:{totalWeight:function(){var t=0;return e.recipe.grains.added.forEach(function(e,r){e.grainWt>0&&(t+=parseInt(e.grainWt))}),t},totalPPG:function(){var t=0;return e.recipe.grains.added.forEach(function(r,n){t+=Math.round(1e3*(r.PPG-1)*r.grainWt/e.recipe.volume)/1e3}),t},efficiencyPPG:function(){var t=Math.round(e.recipe.grains.totalPPG()*(e.recipe.efficiency/100)*1e3)/1e3+1;return t>1.5&&(t=1.5),t.toString().length>5&&(t=t.toString().slice(0,5)),t},added:[]},efficiency:65,attenuation:70,volume:5,hops:{added:[],ibu:function(){if(e.recipe.hops.added.length>0&&e.recipe.grains.added.length>0){var t=0,r=0,n=1.65*Math.pow(125e-6,e.recipe.og()-1);return e.recipe.hops.added.forEach(function(o){if(r=o.hopWt*(o.Alpha_Acid/100)*7490/e.recipe.volume,"boil"==o.hopType){var i=(1-Math.pow(2.718281828459045,-.04*o.hopTime))/3.8,a=n*i;t+=a*r}else if("whirlpool"==o.hopType){var a=.1;t+=a*r}}),Math.round(100*t)/100}return 0}},og:function(){return e.recipe.grains.added.length>0?e.recipe.grains.efficiencyPPG():0},fg:function(){if(e.recipe.grains.added.length>0){var t=Math.round(1e3*(e.recipe.grains.efficiencyPPG()-1)*(e.recipe.attenuation/100))/1e3;return t=e.recipe.og()-t,t.toString().length>5&&(t=t.toString().slice(0,5)),t}return 0},abv:function(){if(e.recipe.grains.added.length>0){var t=e.recipe.og(),r=e.recipe.fg();return Math.round(76.08*(t-r)/(1.775-t)*(r/.794)*100)/100}return 0},srm:function(){if(e.recipe.grains.added.length>0){var t=0,r=e.recipe.grains.added.forEach(function(e,r){t+=e.lovi*e.grainWt});return r=t/e.recipe.volume,r=Math.round(1.4922*Math.pow(r,.6859)*100)/100,r>50&&(r=50),r}return 0},dp:function(){if(e.recipe.grains.added.length>0){var t=0;return e.recipe.grains.added.forEach(function(e,r){t+=e.dp*e.grainWt}),Math.round(t/e.recipe.grains.totalWeight())}return 0},notes:"",yeast:e.yeast},e.saveRecipe=function(){var r={username:e.user.username,name:e.recipe.name,grains:{added:e.recipe.grains.added},efficiency:e.recipe.efficiency,volume:e.recipe.volume,attenuation:e.recipe.attenuation,hops:{added:e.recipe.hops.added},notes:e.notes};t({method:"post",url:"/private/recipes",data:r}).then(function(e){console.log(e.data)})},e.getSavedRecipes=function(){t({method:"post",url:"/private/recipes/saved"}).then(function(e){console.log(e.data)})},e.addIngredient=function(t,r){e.recipe[t].added.push(e[r]),e[r]={}},e.deleteItem=function(t,r){e.recipe[r].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=r.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("dbsgCalc",["$scope",function(e){console.log("clicked"),console.log(e.dbfg+e.name)}]),app.controller("loginControl",["$rootScope","$scope","$http","$location",function(e,t,r,n){t.userLogin=function(){r({method:"post",data:t.user,url:"/loginauth"}).then(function(e){e.data.token&&(sessionStorage.setItem("userToken",e.data.token),t.user={},n.url("/"))},function(e){t.error=e.data,t.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,r){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,e.user.err||r.url("/login")})}}]),app.controller("headerControl",["$rootScope","$scope","jwtHelper",function(e,t,r){t.user={},t.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(t.user=r.decodeToken(sessionStorage.getItem("userToken")),t.user.login="Logout "+t.user.username,t.user.loginUrl="/"):(t.user={},t.user.login="Login/Register",t.user.loginUrl="/login")}),t.logOut=function(){sessionStorage.removeItem("userToken")}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJqd3RJbnRlcmNlcHRvclByb3ZpZGVyIiwiaHRtbDVNb2RlIiwidG9rZW5HZXR0ZXIiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwidGhlbWUiLCJwcmltYXJ5UGFsZXR0ZSIsImFjY2VudFBhbGV0dGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib3RoZXJ3aXNlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJWYWwiLCJsaW5rIiwiZWxlbSIsImF0dHIiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJpc01hdGNoIiwibW9kZWxWYWwiLCIkd2F0Y2giLCIkdmFsaWRhdGUiLCJzZXJ2aWNlIiwidGhpcyIsImNhbGNQcGciLCJkYmZnIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJpdGVtIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlcyIsImRhdGEiLCJ1c2VyIiwicmVjaXBldGVtcGxhdGUiLCJyZWNpcGUiLCJuYW1lIiwiZ3JhaW5zIiwidG90YWxXZWlnaHQiLCJ0b3RhbCIsImFkZGVkIiwiZm9yRWFjaCIsImdyYWluIiwiaW5kZXgiLCJncmFpbld0IiwicGFyc2VJbnQiLCJ0b3RhbFBQRyIsIk1hdGgiLCJyb3VuZCIsIlBQRyIsInZvbHVtZSIsImVmZmljaWVuY3lQUEciLCJlZmZQUEciLCJlZmZpY2llbmN5IiwidG9TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImF0dGVudWF0aW9uIiwiaG9wcyIsImlidSIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJvZyIsImhvcCIsImhvcFd0IiwiQWxwaGFfQWNpZCIsImhvcFR5cGUiLCJib2lsVEZhY3QiLCJob3BUaW1lIiwidXRpbCIsImZnIiwieWVhc3RGb29kIiwiYWJ2Iiwic3JtIiwidG90YWxDb2xvciIsIm1jdSIsImxvdmkiLCJkcCIsInRvdGFsZHAiLCJub3RlcyIsInllYXN0Iiwic2F2ZVJlY2lwZSIsInVzZXJuYW1lIiwiY29uc29sZSIsImxvZyIsImdldFNhdmVkUmVjaXBlcyIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsImRlbGV0ZUl0ZW0iLCJzcGxpY2UiLCJ1c2VyVG9rZW4iLCJkZWNvZGVUb2tlbiIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJ1c2VyTG9naW4iLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwiZXJyIiwibG9naW4iLCJsb2dpblVybCIsImxvZ091dCIsInJlbW92ZUl0ZW0iXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsaUJBQUEsYUFBQSxVQUFBLGVBQ0FGLEtBQUFHLFFBQUEsaUJBQ0Esb0JBQ0EscUJBQ0EsZ0JBQ0EseUJBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUgsRUFBQUksV0FBQSxHQUVBRCxFQUFBRSxZQUFBLFdBQ0EsTUFBQUMsZ0JBQUFDLFFBQUEsY0FFQUwsRUFBQU0sYUFBQUMsS0FBQSxrQkFFQVIsRUFBQVMsTUFBQSxXQUNBQyxlQUFBLFNBQ0FDLGNBQUEsVUFFQWIsRUFBQWMsS0FBQSxLQUNBQyxZQUFBLHNCQUNBQyxXQUFBLGVBQ0FGLEtBQUEsY0FDQUMsWUFBQSx1QkFDQUMsV0FBQSxhQUNBRixLQUFBLFVBQ0FDLFlBQUEsb0JBQ0FDLFdBQUEsaUJBQ0FGLEtBQUEsYUFDQUMsWUFBQSx1QkFDQUMsV0FBQSxvQkFDQUMsVUFBQSxLQUNBRixZQUFBLHNCQUNBQyxXQUFBLGtCQUdBcEIsSUFBQXNCLFVBQUEsVUFBQSxXQUNBLE9BQ0FDLFFBQUEsVUFDQUMsT0FDQUMsU0FBQSxZQUVBQyxLQUFBLFNBQUFGLEVBQUFH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QUNBQSxFQUFBQyxLQUFBaUUsUUFDQXJHLGVBQUFzRyxRQUFBLFlBQUFuRSxFQUFBQyxLQUFBaUUsT0FDQXpFLEVBQUFTLFFBQ0E4RCxFQUFBbEUsSUFBQSxPQUVBLFNBQUFFLEdBQ0FQLEVBQUEyRSxNQUFBcEUsRUFBQUMsS0FDQVIsRUFBQVMsS0FBQW1FLFNBQUEsU0FPQW5ILElBQUFvQixXQUFBLG1CQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFtQixFQUFBQyxFQUFBc0UsR0FDQXZFLEVBQUE2RSxhQUFBLFdBQ0E1RSxHQUNBRyxPQUFBLE9BQ0FJLEtBQUFSLEVBQUFTLEtBQ0FKLElBQUEsY0FDQUMsS0FBQSxTQUFBQyxHQUNBUCxFQUFBUyxLQUFBRixFQUFBQyxLQUNBUixFQUFBUyxLQUFBcUUsS0FDQVAsRUFBQWxFLElBQUEsZ0JBS0E1QyxJQUFBb0IsV0FBQSxpQkFBQSxhQUFBLFNBQUEsWUFBQSxTQUFBeUYsRUFBQXRFLEVBQUFFLEdBQ0FGLEVBQUFTLFFBRUFULEVBQUFOLE9BQUEsV0FDQSxNQUFBdEIsZ0JBQUFDLFFBQUEsY0FDQSxXQUNBRCxlQUFBQyxRQUFBLGNBQ0EyQixFQUFBUyxLQUFBUCxFQUFBbUUsWUFBQWpHLGVBQUFDLFFBQUEsY0FDQTJCLEVBQUFTLEtBQUFzRSxNQUFBLFVBQUEvRSxFQUFBUyxLQUFBa0QsU0FDQTNELEVBQUFTLEtBQUF1RSxTQUFBLE1BRUFoRixFQUFBUyxRQUNBVCxFQUFBUyxLQUFBc0UsTUFBQSxpQkFDQS9FLEVBQUFTLEtBQUF1RSxTQUFBLFlBSUFoRixFQUFBaUYsT0FBQSxXQUNBN0csZUFBQThHLFdBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdyZWNpcGVDcmVhdG9yJywgWyduZ01hdGVyaWFsJywgJ25nUm91dGUnLCAnYW5ndWxhci1qd3QnXSk7XG4gIGFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsXG4gICAgICAgICAgICAgICckbG9jYXRpb25Qcm92aWRlcicsXG4gICAgICAgICAgICAgICckbWRUaGVtaW5nUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGh0dHBQcm92aWRlcicsXG4gICAgICAgICAgICAgICdqd3RJbnRlcmNlcHRvclByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIsICRodHRwUHJvdmlkZXIsIGp3dEludGVyY2VwdG9yUHJvdmlkZXIpe1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgIGp3dEludGVyY2VwdG9yUHJvdmlkZXIudG9rZW5HZXR0ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH1cbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdqd3RJbnRlcmNlcHRvcicpO1xuXG4gICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnYW1iZXInKVxuICAgICAgLmFjY2VudFBhbGV0dGUoJ3llbGxvdycpO1xuXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KS53aGVuKCcvZGJzZ19jYWxjJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvZGJzZ2NhbGMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnZGJzZ0NhbGMnXG4gICAgfSkud2hlbignL2xvZ2luJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sJ1xuICAgIH0pLndoZW4oJy9yZWdpc3RlcicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOicvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVnaXN0ZXJDb250cm9sJ1xuICAgIH0pLm90aGVyd2lzZSgnLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KTtcbiAgfV0pO1xuICBhcHAuZGlyZWN0aXZlKCdpc01hdGNoJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgc2NvcGU6IHtcbiAgICAgICAgb3RoZXJWYWw6IFwiPWlzTWF0Y2hcIlxuICAgICAgfSxcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtLCBhdHRyLCBuZ01vZGVsKSB7XG4gICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuaXNNYXRjaCA9IGZ1bmN0aW9uKG1vZGVsVmFsKSB7XG4gICAgICAgICAgcmV0dXJuIG1vZGVsVmFsID09PSBzY29wZS5vdGhlclZhbDtcbiAgICAgICAgfTtcbiAgICAgICAgc2NvcGUuJHdhdGNoKCdvdGhlclZhbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG4gIGFwcC5zZXJ2aWNlKCdQcGdDYWxjJywgZnVuY3Rpb24gKCl7XG4gICAgdGhpcy5jYWxjUHBnID0gZnVuY3Rpb24oZGJmZykge1xuICAgICAgcmV0dXJuICgxMDAwICogKDEgKyAoZGJmZyAvIDEwMCkgKiAwLjA0NjIxKSkgLyAxMDAwXG4gICAgfVxuICB9KTtcbiAgLy9jb250cm9sbGVyIGZvciB0aGUgcmVjaXBlIGJ1aWxkZXJcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlY2lwZU1ha2UnLCBbJyRzY29wZScsICckaHR0cCcsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBqd3RIZWxwZXIpe1xuICAgICRzY29wZS51c2VyID0ge307XG4gICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnO1xuICAgIC8vZ2V0IGFsbCBpdGVtcyBsaXN0ZWQgaW4gdGhlIHNlbGVjdCBtZW51XG4gICAgZ2V0SXRlbSgnZ3JhaW5zJyk7XG4gICAgZ2V0SXRlbSgnaG9wcycpO1xuICAgIGdldEl0ZW0oJ3llYXN0cycpO1xuICAgIC8vVGhlIG9iamVjdCB1c2VkIGZvciByZWNpcGUgY3JlYXRpb24gYXMgd2VsbCBhcyBjYWxjdWxhdGlvbnNcbiAgICAkc2NvcGUucmVjaXBlID0ge1xuICAgICAgbmFtZTogJycsXG4gICAgICBncmFpbnM6IHtcbiAgICAgICAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIHdlaWdodCBvZiBhbGwgZ3JhaW5zIGFkZGVkXG4gICAgICAgIHRvdGFsV2VpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgICAgICRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgICAgICBpZihncmFpbi5ncmFpbld0ID4gMCl7XG4gICAgICAgICAgICAgIHRvdGFsICs9IHBhcnNlSW50KGdyYWluLmdyYWluV3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgcmV0dXJuIHRvdGFsO1xuICAgICAgICB9LFxuICAgICAgICAvL3RoaXMgY2FsY3VsYXRlcyB0aGUgbWF4IHN1Z2FyIGV4dHJhY3Rpb24gcG9zc2libGUgZnJvbSB0aGUgZ3JhaW5zXG4gICAgICAgIHRvdGFsUFBHOiBmdW5jdGlvbigpe1xuICAgICAgICAgIHZhciB0b3RhbCA9IDA7XG4gICAgICAgICAgJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpe1xuICAgICAgICAgICAgdG90YWwgKz0gKE1hdGgucm91bmQoKGdyYWluLlBQRyAtIDEpICogMTAwMCAqIGdyYWluLmdyYWluV3QgLyAkc2NvcGUucmVjaXBlLnZvbHVtZSkpIC8gMTAwMDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIHJldHVybiB0b3RhbDtcbiAgICAgICAgfSxcbiAgICAgICAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIGVzdGltYXRlZCBzdWdhciBleHRyYWN0aW9uIGJhc2VkIG9uIHVzZXIncyBlZmYuIGlucHV0XG4gICAgICAgIGVmZmljaWVuY3lQUEc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdmFyIGVmZlBQRyA9IE1hdGgucm91bmQoJHNjb3BlLnJlY2lwZS5ncmFpbnMudG90YWxQUEcoKSAqICgkc2NvcGUucmVjaXBlLmVmZmljaWVuY3kgLyAxMDApICogMTAwMCkgLyAxMDAwICsgMTtcbiAgICAgICAgICBpZihlZmZQUEcgPiAxLjUpIHtcbiAgICAgICAgICAgIGVmZlBQRyA9IDEuNTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoZWZmUFBHLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgZWZmUFBHID0gZWZmUFBHLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gZWZmUFBHO1xuICAgICAgICB9LFxuICAgICAgICAvL2xpc3Qgb2YgYWxsIGdyYWlucyBhZGRlZFxuICAgICAgICBhZGRlZDogW11cbiAgICAgIH0sXG4gICAgICAvL2RlZmF1bHQgaW5wdXRzIGZvciBlZmZpY2llbmN5LCBhdHRlbnVhdGlvbiwgYW5kIHZvbHVtZVxuICAgICAgZWZmaWNpZW5jeTogNjUsXG4gICAgICBhdHRlbnVhdGlvbjogNzAsXG4gICAgICB2b2x1bWU6IDUsXG4gICAgICBob3BzOiB7XG4gICAgICAgIC8vbGlzdCBvZiBhbGwgaG9wcyBhZGRlZFxuICAgICAgICBhZGRlZDogW10sXG4gICAgICAgIC8vY2FsY3VsYXRlcyBpYnUncyBmb3IgdXNlcidzIGlucHV0IGhvcHNcbiAgICAgICAgaWJ1OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZigkc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQubGVuZ3RoID4gMCAmJiAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgaWJ1ID0gMDtcbiAgICAgICAgICAgIHZhciBhYXUgPSAwO1xuICAgICAgICAgICAgdmFyIGJpZ0ZhY3QgPSAxLjY1ICogTWF0aC5wb3coMC4wMDAxMjUsICgkc2NvcGUucmVjaXBlLm9nKCkgLSAxKSk7XG4gICAgICAgICAgICAkc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQuZm9yRWFjaChmdW5jdGlvbihob3ApIHtcbiAgICAgICAgICAgICAgYWF1ID0gaG9wLmhvcFd0ICogKGhvcC5BbHBoYV9BY2lkIC8gMTAwKSAqIDc0OTAgLyAkc2NvcGUucmVjaXBlLnZvbHVtZTtcbiAgICAgICAgICAgICAgaWYoaG9wLmhvcFR5cGUgPT0gJ2JvaWwnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvaWxURmFjdCA9ICgoMSAtIE1hdGgucG93KDIuNzE4MjgxODI4NDU5MDQ1MjM1MzYsICgtLjA0ICogaG9wLmhvcFRpbWUpKSkgLyAzLjgpO1xuICAgICAgICAgICAgICAgIHZhciB1dGlsID0gYmlnRmFjdCAqIGJvaWxURmFjdDtcbiAgICAgICAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmKGhvcC5ob3BUeXBlID09ICd3aGlybHBvb2wnKSB7XG4gICAgICAgICAgICAgICAgdmFyIHV0aWwgPSAuMTA7XG4gICAgICAgICAgICAgICAgaWJ1ICs9IHV0aWwgKiBhYXVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChpYnUgKiAxMDApIC8gMTAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vdGhpcyBpcyB0aGUgZnVuY3Rpb24gdG8gc3RvcmUgdGhlIE9HIG9uIHRoZSBwYWdlXG4gICAgICBvZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4gJHNjb3BlLnJlY2lwZS5ncmFpbnMuZWZmaWNpZW5jeVBQRygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIGZpbmFsIGdyYXZpdHkgYmFzZWQgb24gYXR0ZW51YXRpb25cbiAgICAgIGZnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciB5ZWFzdEZvb2QgPSBNYXRoLnJvdW5kKCgoJHNjb3BlLnJlY2lwZS5ncmFpbnMuZWZmaWNpZW5jeVBQRygpIC0gMSkgKiAxMDAwKSAqICgkc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uIC8gMTAwKSkgLyAxMDAwO1xuICAgICAgICAgIHllYXN0Rm9vZCA9ICRzY29wZS5yZWNpcGUub2coKSAtIHllYXN0Rm9vZDtcbiAgICAgICAgICBpZih5ZWFzdEZvb2QudG9TdHJpbmcoKS5sZW5ndGggPiA1KSB7XG4gICAgICAgICAgICB5ZWFzdEZvb2QgPSB5ZWFzdEZvb2QudG9TdHJpbmcoKS5zbGljZSgwLCA1KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHllYXN0Rm9vZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vYWJ2IGNhbGMgYmFzZWQgb24gZXN0aW1hdGVkIE9HIGFuZCBGR1xuICAgICAgYWJ2OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciBvZyA9ICRzY29wZS5yZWNpcGUub2coKSxcbiAgICAgICAgICAgICAgZmcgPSAkc2NvcGUucmVjaXBlLmZnKCk7XG4gICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKDc2LjA4ICogKG9nLWZnKSAvICgxLjc3NSAtIG9nKSkgKiAoZmcgLyAwLjc5NCkgKiAxMDApIC8gMTAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL2VzdGltYXRlIGNvbG9yIGJhc2VkIG9uIGdyYWlucyBhZGRlZFxuICAgICAgc3JtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciB0b3RhbENvbG9yID0gMDtcbiAgICAgICAgICB2YXIgbWN1ID0gJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgICAgIHRvdGFsQ29sb3IgKz0gKGdyYWluLmxvdmkgKiBncmFpbi5ncmFpbld0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBtY3UgPSB0b3RhbENvbG9yIC8gJHNjb3BlLnJlY2lwZS52b2x1bWU7XG4gICAgICAgICAgbWN1ID0gTWF0aC5yb3VuZCgoMS40OTIyICogKE1hdGgucG93KG1jdSwgMC42ODU5KSkpICogMTAwKSAvIDEwMDtcbiAgICAgICAgICBpZihtY3UgPiA1MCl7XG4gICAgICAgICAgICBtY3UgPSA1MDtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiBtY3U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL2VzdGltYXRlIGVuenltYXRpYyBhY3Rpdml0eSBiYXNlZCBvbiBncmFpbnMgYWRkZWRcbiAgICAgIGRwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciB0b3RhbGRwID0gMDtcbiAgICAgICAgICAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZC5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICAgICAgdG90YWxkcCArPSBncmFpbi5kcCAqIGdyYWluLmdyYWluV3Q7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodG90YWxkcCAvICRzY29wZS5yZWNpcGUuZ3JhaW5zLnRvdGFsV2VpZ2h0KCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbm90ZXM6ICcnLFxuICAgICAgeWVhc3Q6ICRzY29wZS55ZWFzdFxuICAgIH07XG5cbiAgICAkc2NvcGUuc2F2ZVJlY2lwZSA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgcmVjaXBlID0ge1xuICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXIudXNlcm5hbWUsXG4gICAgICAgIG5hbWU6ICRzY29wZS5yZWNpcGUubmFtZSxcbiAgICAgICAgZ3JhaW5zOiB7XG4gICAgICAgICAgYWRkZWQ6ICRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkXG4gICAgICAgIH0sXG4gICAgICAgIGVmZmljaWVuY3k6ICRzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSxcbiAgICAgICAgdm9sdW1lOiAkc2NvcGUucmVjaXBlLnZvbHVtZSxcbiAgICAgICAgYXR0ZW51YXRpb246ICRzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24sXG4gICAgICAgIGhvcHM6IHtcbiAgICAgICAgICBhZGRlZDogJHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkXG4gICAgICAgIH0sXG4gICAgICAgIG5vdGVzOiAkc2NvcGUubm90ZXNcbiAgICAgIH07XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzJyxcbiAgICAgICAgZGF0YTogcmVjaXBlXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKTtcbiAgICAgIH0pXG4gICAgfVxuICAgICRzY29wZS5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMvc2F2ZWQnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKTtcbiAgICAgIH0pXG4gICAgfTtcbiAgICAvL2dlbmVyaWMgZnVuY3Rpb24gdG8gYWRkIGFuIGl0ZW0gdG8gdGhlIGFycmF5IGZvciB0aG9zZSBpbmdyZWRpZW50c1xuICAgICRzY29wZS5hZGRJbmdyZWRpZW50ID0gZnVuY3Rpb24oaW5ncmVkaWVudCwgdHlwZSl7XG4gICAgICAkc2NvcGUucmVjaXBlW2luZ3JlZGllbnRdLmFkZGVkLnB1c2goJHNjb3BlW3R5cGVdKTtcbiAgICAgICRzY29wZVt0eXBlXSA9IHt9O1xuICAgIH1cbiAgICAvL3JlbW92ZSBidXR0b24gZnVuY3Rpb24gLSByZW1vdmVzIG9uZSBpdGVtIGZyb20gdGhlIGFycmF5XG4gICAgJHNjb3BlLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbihpbmRleCwgdHlwZSkge1xuICAgICAgJHNjb3BlLnJlY2lwZVt0eXBlXS5hZGRlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cbiAgICAvL2dlbmVyaWMgZnVuY3Rpb24gdG8gY2FsbCB0aGUgc2VydmVyIGZvciBhIHNwZWNpZmljIGluZ3JlZGllbnRcbiAgICBmdW5jdGlvbiBnZXRJdGVtKGl0ZW0pe1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6ICcvJyArIGl0ZW1cbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICRzY29wZVtpdGVtXSA9IHJlcy5kYXRhO1xuICAgICAgfSlcbiAgICB9O1xuICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICAgIHZhciB1c2VyVG9rZW4gPSBqd3RIZWxwZXIuZGVjb2RlVG9rZW4oc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICAgICRzY29wZS51c2VyID0gdXNlclRva2VuO1xuICAgICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy9wcml2YXRlL3ZpZXdzL3NhdmVkcmVjaXBlcy5odG1sJ1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnXG4gICAgICB9XG4gICAgfSk7XG4gIH1dKTtcblxuXG4gIC8vZXh0cmEgZm9yIGEgY2FsY3VsYXRvciBjb250cm9sbGVyXG4gIGFwcC5jb250cm9sbGVyKCdkYnNnQ2FsYycsIFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgICBjb25zb2xlLmxvZygnY2xpY2tlZCcpO1xuICAgIGNvbnNvbGUubG9nKCRzY29wZS5kYmZnICsgJHNjb3BlLm5hbWUpO1xuICAgIC8vICRzY29wZS5hZGRncmFpbiA9IGZ1bmN0aW9uKCl7XG4gICAgLy8gICBpZighJHNjb3BlLmdyYWlucykge1xuICAgIC8vICAgICAkc2NvcGUuZ3JhaW5zID0gW107XG4gICAgLy8gICB9XG4gICAgLy8gICAkc2NvcGUuZ3JhaW5zLnB1c2goJHNjb3BlLmdyYWluKTtcbiAgICAvLyAgICRzY29wZS5ncmFpbiA9IHt9O1xuICAgIC8vIH1cbiAgfV0pO1xuXG5cbiAgLy9jb250cm9sbGVyIGZvciBsb2dpbiBzY3JlZW4gLSBzZW5kcyB1c2VyL3Bhc3MgYW5kIHN0b3JlcyBqd3RcbiAgYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbCcsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUudXNlckxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgdXJsOiAnL2xvZ2luYXV0aCdcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgaWYocmVzLmRhdGEudG9rZW4pe1xuICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJUb2tlbicsIHJlcy5kYXRhLnRva2VuKTtcbiAgICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAgICRsb2NhdGlvbi51cmwoJy8nKTtcbiAgICAgICAgfTtcbiAgICAgIH0sIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS5lcnJvciA9IHJlcy5kYXRhO1xuICAgICAgICAkc2NvcGUudXNlci5wYXNzd29yZCA9ICcnO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG5cblxuICAvL2NvbnRyb2xsZXIgZm9yIHJlZ2lzdGVyIHBhZ2UgLSBzZW5kcyBuZXcgdXNlciBpbmZvIGFuZCByZXR1cm5zIHRoYXQgZGF0YVxuICBhcHAuY29udHJvbGxlcigncmVnaXN0ZXJDb250cm9sJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgICAkc2NvcGUucmVnaXN0ZXJVc2VyID0gZnVuY3Rpb24oKXtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgICB1cmw6ICcvcmVnaXN0ZXInXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgICAgIGlmKCEkc2NvcGUudXNlci5lcnIpIHtcbiAgICAgICAgICAkbG9jYXRpb24udXJsKCcvbG9naW4nKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1dKTtcbiAgYXBwLmNvbnRyb2xsZXIoJ2hlYWRlckNvbnRyb2wnLCBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJ2p3dEhlbHBlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgand0SGVscGVyKXtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuXG4gICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH0sIGZ1bmN0aW9uKCl7XG4gICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSl7XG4gICAgICAgICRzY29wZS51c2VyID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW4gPSAnTG9nb3V0ICcgKyAkc2NvcGUudXNlci51c2VybmFtZTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW5VcmwgPSAnLyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dpbi9SZWdpc3Rlcic7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy9sb2dpbidcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICRzY29wZS5sb2dPdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH1cbiAgfV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9