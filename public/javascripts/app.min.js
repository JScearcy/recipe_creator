var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,n,r){t.html5Mode(!0),r.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,n){e.user={},e.user.recipetemplate="/views/notloggedin.html",n.getItem(t,e,"grains"),n.getItem(t,e,"hops"),n.getItem(t,e,"yeasts"),e.recipe=new n.recipe(e,n),e.clearCurrentRecipe=function(){return new n.clearCurrentRecipe(e,n)},e.saveRecipe=function(){return n.saveRecipe(t,e,n)},e.editRecipe=function(t){return n.editRecipe(t,e,n)},e.addIngredient=function(t,i,r){switch(i){case"grains":var o=new n.newGrain(t);break;case"hops":var o=new n.newHop(t);break;default:return}e.recipe[i].added.push(o),e[r]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.goToPage=function(e){return e},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.deleteRecipe=function(n){i.deleteRecipe(n._id,t,function(t){e.getSavedRecipes()})},e.getSavedRecipes=function(){return i.getSavedRecipes(e,t,i)}}]),app.controller("dbsgCalc",["$scope","PpgCalc",function(e,t){e.ppgItems=[],e.clearAll=function(){console.log("button clicked"),e.ppgItems=[]},e.addGrain=function(){e.ppgItems.push(new t.newItem(e.newItem,t)),e.newItem={}}}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,n){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,n){if(e.length>0&&t.length>0){var r=0,o=0,a=1.65*Math.pow(125e-6,n-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"Boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,n=a*t;r+=n*o}else if("Whirlpool"==e.hopType){var n=.1;r+=n*o}}),Math.round(100*r)/100}return 0},this.fg=function(e,t,i){if(t>0){var n=Math.round(1e3*(t-1)*(i/100))/1e3;return n=t-n,n.toString().length>5&&(n=n.toString().slice(0,5)),n}return 0},this.srm=function(e,t){if(e.length>0){var i=0,n=e.forEach(function(e,t){i+=e.lovi*e.weight});return n=i/t,n=Math.round(1.4922*Math.pow(n,.6859)*100)/100,n>50&&(n=50),n}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=75,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){var n={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:n}).then(function(e){t.recipe=new i.recipe(t,i),t.notes="",t.yeast={}})},this.clearCurrentRecipe=function(e,t){e.recipe=new t.recipe(e,t),e.notes="",e.yeast={}},this.editRecipe=function(e,t,i){t.recipe.name=e.name,t.recipe.efficiency=e.efficiency,t.recipe.attenuation=e.attenuation,t.recipe.volume=e.volume,t.recipe.grains.added=e.grains.added,t.recipe.hops.added=e.hops.added,t.notes=e.notes,t.yeast=e.yeast,t.selectedIndex=0},this.deleteRecipe=function(e,t,i){t({method:"delete",data:{id:e},url:"/private/recipes/delete/",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(e){i(e)})},this.getSavedRecipes=function(e,t,i){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,n){e.recipes[n]=i.calculateStats(t,i)})})}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return"number"!=typeof e&&(e=0),e=1e3*(1+e/100*.04621)/1e3,e=e.toString().slice(0,5)},this.newItem=function(e,t){this.ppg=t.calcPpg(e.dbfg),this.dbfg=e.dbfg,this.name=e.name}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJlY2lwZXNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwiand0SW50ZXJjZXB0b3JQcm92aWRlciIsImh0bWw1TW9kZSIsInRva2VuR2V0dGVyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJzY29wZSIsIm90aGVyVmFsIiwibGluayIsImVsZW0iLCJhdHRyIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiaXNNYXRjaCIsIm1vZGVsVmFsIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJyZWNpcGVGdW5jIiwidXNlciIsInJlY2lwZXRlbXBsYXRlIiwicmVjaXBlIiwiY2xlYXJDdXJyZW50UmVjaXBlIiwic2F2ZVJlY2lwZSIsImVkaXRSZWNpcGUiLCJhZGRJbmdyZWRpZW50IiwiaW5ncmVkaWVudCIsInR5cGUiLCJtb2RlbCIsImFkZGVkSW5ncmVkaWVudCIsIm5ld0dyYWluIiwibmV3SG9wIiwiYWRkZWQiLCJkZWxldGVJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJ1c2VyVG9rZW4iLCJkZWNvZGVUb2tlbiIsIiRsb2NhdGlvbiIsInVzZXJMb2dpbiIsIm1ldGhvZCIsImRhdGEiLCJ1cmwiLCJ0aGVuIiwicmVzIiwidG9rZW4iLCJzZXRJdGVtIiwiZXJyb3IiLCJwYXNzd29yZCIsInJlZ2lzdGVyVXNlciIsImdvVG9QYWdlIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsImRlbGV0ZVJlY2lwZSIsIl9pZCIsImdldFNhdmVkUmVjaXBlcyIsIlBwZ0NhbGMiLCJwcGdJdGVtcyIsImNsZWFyQWxsIiwiY29uc29sZSIsImxvZyIsImFkZEdyYWluIiwibmV3SXRlbSIsInNlcnZpY2UiLCJ0aGlzIiwidG90YWxXZWlnaHQiLCJpbmdyZWRpZW50cyIsInRvdGFsIiwiZm9yRWFjaCIsIndlaWdodCIsInBhcnNlSW50IiwidG90YWxQUEciLCJncmFpbnMiLCJ2b2x1bWUiLCJncmFpbiIsIk1hdGgiLCJyb3VuZCIsIlBQRyIsImVmZmljaWVuY3lQUEciLCJlZmZpY2llbmN5IiwiZWZmUFBHIiwidG9TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImlidSIsImhvcHMiLCJvZyIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJob3AiLCJBbHBoYV9BY2lkIiwiaG9wVHlwZSIsImJvaWxURmFjdCIsImhvcFRpbWUiLCJ1dGlsIiwiZmciLCJhdHRlbnVhdGlvbiIsInllYXN0Rm9vZCIsInNybSIsInRvdGFsQ29sb3IiLCJtY3UiLCJsb3ZpIiwiYWJ2IiwiZHAiLCJ0b3RhbGRwIiwiZ3JhaW5PYmoiLCJjaGFyYW5kQXBwcyIsImZsYXZvciIsImlkIiwibmFtZSIsImhvcE9iaiIsIkJldGFfQWNpZCIsIk5hbWUiLCJOb3RlcyIsIk9yaWdpbiIsIlR5cGUiLCJub3RlcyIsInJlY2lwZXllYXN0IiwieWVhc3QiLCJjYWxjdWxhdGVTdGF0cyIsImh0dHAiLCJpdGVtIiwic2F2ZWRyZWNpcGUiLCJzZWxlY3RlZEluZGV4IiwiY2FsbGJhY2siLCJoZWFkZXJzIiwiQ29udGVudC1UeXBlIiwicmVjaXBlcyIsImNhbGNQcGciLCJkYmZnIiwicHBnIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGlCQUFBLGFBQUEsVUFBQSxlQUNBRixLQUFBRyxRQUFBLGlCQUNBLG9CQUNBLHFCQUNBLGdCQUNBLHlCQUNBLFNBQUFDLEVBQUFDLEVB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QThGLEVBQUF0QyxLQUFBeEQsTUFDQTVCLEVBQUFvSCxNQUFBTSxFQUFBTixNQUNBcEgsRUFBQXNILE1BQUFJLEVBQUFKLE1BQ0F0SCxFQUFBMkgsY0FBQSxHQUdBNUQsS0FBQVgsYUFBQSxTQUFBd0QsRUFBQVksRUFBQUksR0FDQUosR0FDQXBGLE9BQUEsU0FDQUMsTUFBQXVFLEdBQUFBLEdBQ0F0RSxJQUFBLDJCQUNBdUYsU0FBQUMsZUFBQSxvQ0FDQXZGLEtBQUEsU0FBQUMsR0FDQW9GLEVBQUFwRixNQUtBdUIsS0FBQVQsZ0JBQUEsU0FBQXRELEVBQUF3SCxFQUFBMUcsR0FDQTBHLEdBQ0FwRixPQUFBLE9BQ0FFLElBQUEsMkJBQ0FDLEtBQUEsU0FBQUMsR0FDQXhDLEVBQUErSCxRQUFBdkYsRUFBQUgsS0FDQXJDLEVBQUErSCxRQUFBNUQsUUFBQSxTQUFBbEQsRUFBQWEsR0FDQTlCLEVBQUErSCxRQUFBakcsR0FBQWhCLEVBQUF5RyxlQUFBdEcsRUFBQUgsVUFPQXRDLElBQUFzRixRQUFBLFVBQUEsV0FDQUMsS0FBQWlFLFFBQUEsU0FBQUMsR0FNQSxNQUxBLGdCQUFBQSxLQUNBQSxFQUFBLEdBRUFBLEVBQUEsS0FBQSxFQUFBQSxFQUFBLElBQUEsUUFBQSxJQUNBQSxFQUFBQSxFQUFBakQsV0FBQUUsTUFBQSxFQUFBLElBR0FuQixLQUFBRixRQUFBLFNBQUFBLEVBQUFOLEdBQ0FRLEtBQUFtRSxJQUFBM0UsRUFBQXlFLFFBQUFuRSxFQUFBb0UsTUFDQWxFLEtBQUFrRSxLQUFBcEUsRUFBQW9FLEtBQ0FsRSxLQUFBOEMsS0FBQWhELEVBQUFnRCIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ3JlY2lwZUNyZWF0b3InLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICdhbmd1bGFyLWp3dCddKTtcbiAgYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRsb2NhdGlvblByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRtZFRoZW1pbmdQcm92aWRlcicsXG4gICAgICAgICAgICAgICckaHR0cFByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJ2p3dEludGVyY2VwdG9yUHJvdmlkZXInLFxuICAgICAgICAgICAgICBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlciwgJGh0dHBQcm92aWRlciwgand0SW50ZXJjZXB0b3JQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgand0SW50ZXJjZXB0b3JQcm92aWRlci50b2tlbkdldHRlciA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfVxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2p3dEludGVyY2VwdG9yJyk7XG5cbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgLnByaW1hcnlQYWxldHRlKCdhbWJlcicpXG4gICAgICAuYWNjZW50UGFsZXR0ZSgneWVsbG93Jyk7XG5cbiAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pLndoZW4oJy9kYnNnX2NhbGMnLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kYnNnY2FsYy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdkYnNnQ2FsYydcbiAgICB9KS53aGVuKCcvbG9naW4nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkNvbnRyb2wnXG4gICAgfSkud2hlbignL3JlZ2lzdGVyJywge1xuICAgICAgdGVtcGxhdGVVcmw6Jy92aWV3cy9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckNvbnRyb2wnXG4gICAgfSkub3RoZXJ3aXNlKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pO1xuICB9XSk7XG4gIGFwcC5kaXJlY3RpdmUoJ2lzTWF0Y2gnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICBzY29wZToge1xuICAgICAgICBvdGhlclZhbDogXCI9aXNNYXRjaFwiXG4gICAgICB9LFxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcbiAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5pc01hdGNoID0gZnVuY3Rpb24obW9kZWxWYWwpIHtcbiAgICAgICAgICByZXR1cm4gbW9kZWxWYWwgPT09IHNjb3BlLm90aGVyVmFsO1xuICAgICAgICB9O1xuICAgICAgICBzY29wZS4kd2F0Y2goJ290aGVyVmFsJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgLy9jb250cm9sbGVyIGZvciB0aGUgcmVjaXBlIGJ1aWxkZXJcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlY2lwZU1ha2UnLCBbJyRzY29wZScsICckaHR0cCcsICdqd3RIZWxwZXInLCAncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIGp3dEhlbHBlciwgcmVjaXBlRnVuYyl7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCc7XG5cbiAgICAvL2dldCBhbGwgaXRlbXMgbGlzdGVkIGluIHRoZSBzZWxlY3QgbWVudVxuICAgIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAnZ3JhaW5zJyk7XG4gICAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICdob3BzJyk7XG4gICAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICd5ZWFzdHMnKTtcblxuICAgIC8vVGhlIG9iamVjdCB1c2VkIGZvciByZWNpcGUgY3JlYXRpb24gYXMgd2VsbCBhcyBjYWxjdWxhdGlvbnNcbiAgICAkc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKCRzY29wZSwgcmVjaXBlRnVuYyk7XG5cbiAgICAvL1NhdmUvY2xlYXIvZWRpdCBmdW5jdGlvbiBmb3IgYnV0dG9uIG5nLWNsaWNrXG4gICAgJHNjb3BlLmNsZWFyQ3VycmVudFJlY2lwZSA9IGZ1bmN0aW9uKCl7IHJldHVybiBuZXcgcmVjaXBlRnVuYy5jbGVhckN1cnJlbnRSZWNpcGUoJHNjb3BlLCByZWNpcGVGdW5jKSB9O1xuICAgICRzY29wZS5zYXZlUmVjaXBlID0gZnVuY3Rpb24oKXsgcmV0dXJuIHJlY2lwZUZ1bmMuc2F2ZVJlY2lwZSgkaHR0cCwgJHNjb3BlLCByZWNpcGVGdW5jKSB9O1xuICAgICRzY29wZS5lZGl0UmVjaXBlID0gZnVuY3Rpb24ocmVjaXBlKSB7IHJldHVybiByZWNpcGVGdW5jLmVkaXRSZWNpcGUocmVjaXBlLCAkc2NvcGUsIHJlY2lwZUZ1bmMpIH1cblxuICAgIC8vZ2VuZXJpYyBmdW5jdGlvbiB0byBhZGQgYW4gaXRlbSB0byB0aGUgYXJyYXkgZm9yIHRob3NlIGluZ3JlZGllbnRzXG4gICAgJHNjb3BlLmFkZEluZ3JlZGllbnQgPSBmdW5jdGlvbihpbmdyZWRpZW50LCB0eXBlLCBtb2RlbCl7XG4gICAgICBzd2l0Y2godHlwZSkge1xuICAgICAgICBjYXNlICdncmFpbnMnOlxuICAgICAgICAgIHZhciBhZGRlZEluZ3JlZGllbnQgPSBuZXcgcmVjaXBlRnVuYy5uZXdHcmFpbihpbmdyZWRpZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnaG9wcyc6XG4gICAgICAgICAgdmFyIGFkZGVkSW5ncmVkaWVudCA9IG5ldyByZWNpcGVGdW5jLm5ld0hvcChpbmdyZWRpZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9O1xuICAgICAgJHNjb3BlLnJlY2lwZVt0eXBlXS5hZGRlZC5wdXNoKGFkZGVkSW5ncmVkaWVudCk7XG4gICAgICAkc2NvcGVbbW9kZWxdID0ge307XG4gICAgfVxuICAgIC8vcmVtb3ZlIGJ1dHRvbiBmdW5jdGlvbiAtIHJlbW92ZXMgb25lIGl0ZW0gZnJvbSB0aGUgYXJyYXlcbiAgICAkc2NvcGUuZGVsZXRlSXRlbSA9IGZ1bmN0aW9uKGluZGV4LCB0eXBlKSB7XG4gICAgICAkc2NvcGUucmVjaXBlW3R5cGVdLmFkZGVkLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuXG4gICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH0sIGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKSB7XG4gICAgICAgICAgdmFyIHVzZXJUb2tlbiA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyVG9rZW47XG4gICAgICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ByaXZhdGUvdmlld3Mvc2F2ZWRyZWNpcGVzLmh0bWwnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCdcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XSk7XG4gIC8vY29udHJvbGxlciBmb3IgbG9naW4gc2NyZWVuIC0gc2VuZHMgdXNlci9wYXNzIGFuZCBzdG9yZXMgand0XG4gIGFwcC5jb250cm9sbGVyKCdsb2dpbkNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS51c2VyTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgICB1cmw6ICcvbG9naW5hdXRoJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBpZihyZXMuZGF0YS50b2tlbil7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlclRva2VuJywgcmVzLmRhdGEudG9rZW4pO1xuICAgICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xuICAgICAgICB9O1xuICAgICAgfSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gcmVzLmRhdGE7XG4gICAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gJyc7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuXG4gIC8vY29udHJvbGxlciBmb3IgcmVnaXN0ZXIgcGFnZSAtIHNlbmRzIG5ldyB1c2VyIGluZm8gYW5kIHJldHVybnMgdGhhdCBkYXRhXG4gIGFwcC5jb250cm9sbGVyKCdyZWdpc3RlckNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAgICRzY29wZS5yZWdpc3RlclVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9yZWdpc3RlcidcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSByZXMuZGF0YTtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnL2xvZ2luJyk7XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG4gIGFwcC5jb250cm9sbGVyKCdoZWFkZXJDb250cm9sJywgWyckc2NvcGUnLCAnand0SGVscGVyJywgZnVuY3Rpb24oJHNjb3BlLCBqd3RIZWxwZXIpe1xuICAgICRzY29wZS51c2VyID0ge307XG4gICAgJHNjb3BlLmdvVG9QYWdlID0gZnVuY3Rpb24odXJsKSB7XG4gICAgICByZXR1cm4gdXJsO1xuICAgIH1cbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKXtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBqd3RIZWxwZXIuZGVjb2RlVG9rZW4oc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dvdXQgJyArICRzY29wZS51c2VyLnVzZXJuYW1lO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ2luL1JlZ2lzdGVyJztcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW5VcmwgPSAnL2xvZ2luJ1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLmxvZ091dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlclRva2VuJyk7XG4gICAgfTtcbiAgfV0pO1xuXG4gIGFwcC5jb250cm9sbGVyKCdzYXZlZFJlY2lwZXMnLCBbJyRzY29wZScsICckaHR0cCcsJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCByZWNpcGVGdW5jKXtcbiAgICAkc2NvcGUuZGVsZXRlUmVjaXBlID0gZnVuY3Rpb24ocmVjaXBlKSB7XG4gICAgICByZWNpcGVGdW5jLmRlbGV0ZVJlY2lwZShyZWNpcGUuX2lkLCAkaHR0cCwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLmdldFNhdmVkUmVjaXBlcygpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzID0gZnVuY3Rpb24oKSB7IHJldHVybiByZWNpcGVGdW5jLmdldFNhdmVkUmVjaXBlcygkc2NvcGUsICRodHRwLCByZWNpcGVGdW5jKSB9O1xuICB9XSk7XG4gIGFwcC5jb250cm9sbGVyKCdkYnNnQ2FsYycsIFsnJHNjb3BlJywgJ1BwZ0NhbGMnLCBmdW5jdGlvbigkc2NvcGUsIFBwZ0NhbGMpe1xuICAgICRzY29wZS5wcGdJdGVtcyA9IFtdO1xuICAgICRzY29wZS5jbGVhckFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgY29uc29sZS5sb2coJ2J1dHRvbiBjbGlja2VkJylcbiAgICAgICRzY29wZS5wcGdJdGVtcyA9IFtdO1xuICAgIH07XG4gICAgJHNjb3BlLmFkZEdyYWluID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUucHBnSXRlbXMucHVzaChuZXcgUHBnQ2FsYy5uZXdJdGVtKCRzY29wZS5uZXdJdGVtLCBQcGdDYWxjKSk7XG4gICAgICAkc2NvcGUubmV3SXRlbSA9IHt9O1xuICAgIH07XG4gIH1dKTtcbiIsImFwcC5zZXJ2aWNlKCdyZWNpcGVGdW5jJywgZnVuY3Rpb24oKXtcbiAgLy9pbiB1bml0IHRlc3QgdGhpcyBjYWxjdWxhdGVzIHRoZSB3ZWlnaHQgb2YgYWxsIGdyYWlucyBhZGRlZFxuICB0aGlzLnRvdGFsV2VpZ2h0ID0gZnVuY3Rpb24oaW5ncmVkaWVudHMpe1xuICAgIHZhciB0b3RhbCA9IDA7XG4gICAgaW5ncmVkaWVudHMuZm9yRWFjaChmdW5jdGlvbihpbmdyZWRpZW50KXtcbiAgICAgIGlmKGluZ3JlZGllbnQud2VpZ2h0ID4gMCl7XG4gICAgICAgIHRvdGFsICs9IHBhcnNlSW50KGluZ3JlZGllbnQud2VpZ2h0KTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIHRoaXMgY2FsY3VsYXRlcyB0aGUgbWF4IHN1Z2FyIGV4dHJhY3Rpb24gcG9zc2libGUgZnJvbSB0aGUgZ3JhaW5zXG4gIHRoaXMudG90YWxQUEcgPSBmdW5jdGlvbihncmFpbnMsIHZvbHVtZSl7XG4gICAgdmFyIHRvdGFsID0gMDtcbiAgICBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpe1xuICAgICAgdG90YWwgKz0gKE1hdGgucm91bmQoKGdyYWluLlBQRyAtIDEpICogMTAwMCAqIGdyYWluLndlaWdodCAvIHZvbHVtZSkpIC8gMTAwMDtcbiAgICB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IHRoaXMgY2FsY3VsYXRlcyB0aGUgZXN0aW1hdGVkIHN1Z2FyIGV4dHJhY3Rpb24gYmFzZWQgb24gdXNlcidzIGVmZi4gaW5wdXRcbiAgdGhpcy5lZmZpY2llbmN5UFBHID0gZnVuY3Rpb24odG90YWxQUEcsIGVmZmljaWVuY3kpIHtcbiAgICBpZih0b3RhbFBQRyA9PT0gMCl7XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZWZmUFBHID0gTWF0aC5yb3VuZCh0b3RhbFBQRyAqIChlZmZpY2llbmN5IC8gMTAwKSAqIDEwMDApIC8gMTAwMCArIDE7XG4gICAgICAgIGlmKGVmZlBQRyA+IDEuNSkge1xuICAgICAgICAgIGVmZlBQRyA9IDEuNTtcbiAgICAgICAgfVxuICAgICAgICBpZihlZmZQUEcudG9TdHJpbmcoKS5sZW5ndGggPiA1KSB7XG4gICAgICAgICAgZWZmUFBHID0gZWZmUFBHLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBlZmZQUEc7XG4gICAgICB9XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gY2FsY3VsYXRlcyBpYnUncyBmb3IgdXNlcidzIGlucHV0IGhvcHNcbiAgdGhpcy5pYnUgPSBmdW5jdGlvbihob3BzLCBncmFpbnMsIHZvbHVtZSwgb2cpIHtcbiAgICBpZihob3BzLmxlbmd0aCA+IDAgJiYgZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciBpYnUgPSAwO1xuICAgICAgdmFyIGFhdSA9IDA7XG4gICAgICB2YXIgYmlnRmFjdCA9IDEuNjUgKiBNYXRoLnBvdygwLjAwMDEyNSwgKG9nIC0gMSkpO1xuICAgICAgaG9wcy5mb3JFYWNoKGZ1bmN0aW9uKGhvcCkge1xuICAgICAgICBhYXUgPSBob3Aud2VpZ2h0ICogKGhvcC5BbHBoYV9BY2lkIC8gMTAwKSAqIDc0OTAgLyB2b2x1bWU7XG4gICAgICAgIGlmKGhvcC5ob3BUeXBlID09ICdCb2lsJykge1xuICAgICAgICAgIHZhciBib2lsVEZhY3QgPSAoKDEgLSBNYXRoLnBvdygyLjcxODI4MTgyODQ1OTA0NTIzNTM2LCAoLS4wNCAqIGhvcC5ob3BUaW1lKSkpIC8gMy44KTtcbiAgICAgICAgICB2YXIgdXRpbCA9IGJpZ0ZhY3QgKiBib2lsVEZhY3Q7XG4gICAgICAgICAgaWJ1ICs9IHV0aWwgKiBhYXU7XG4gICAgICAgIH0gZWxzZSBpZihob3AuaG9wVHlwZSA9PSAnV2hpcmxwb29sJykge1xuICAgICAgICAgIHZhciB1dGlsID0gLjEwO1xuICAgICAgICAgIGlidSArPSB1dGlsICogYWF1XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoaWJ1ICogMTAwKSAvIDEwMDtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gdGhpcyBjYWxjdWxhdGVzIHRoZSBmaW5hbCBncmF2aXR5IGJhc2VkIG9uIGF0dGVudWF0aW9uXG4gIHRoaXMuZmcgPSBmdW5jdGlvbihncmFpbnMsIG9nLCBhdHRlbnVhdGlvbil7XG4gICAgaWYob2cgPiAwKSB7XG4gICAgICB2YXIgeWVhc3RGb29kID0gTWF0aC5yb3VuZCgoKG9nIC0gMSkgKiAxMDAwKSAqIChhdHRlbnVhdGlvbiAvIDEwMCkpIC8gMTAwMDtcbiAgICAgIHllYXN0Rm9vZCA9IG9nIC0geWVhc3RGb29kO1xuICAgICAgaWYoeWVhc3RGb29kLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICB5ZWFzdEZvb2QgPSB5ZWFzdEZvb2QudG9TdHJpbmcoKS5zbGljZSgwLCA1KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB5ZWFzdEZvb2Q7XG4gICAgfSBlbHNlIHtcbiAgICByZXR1cm4gMFxuICAgIH1cbiAgfTtcbiAgICAgIC8vaW4gdW5pdCB0ZXN0IC0gZXN0aW1hdGUgY29sb3IgYmFzZWQgb24gZ3JhaW5zIGFkZGVkXG4gIHRoaXMuc3JtID0gZnVuY3Rpb24oZ3JhaW5zLCB2b2x1bWUpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgdG90YWxDb2xvciA9IDA7XG4gICAgICB2YXIgbWN1ID0gZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgIHRvdGFsQ29sb3IgKz0gKGdyYWluLmxvdmkgKiBncmFpbi53ZWlnaHQpO1xuICAgICAgfSk7XG4gICAgICBtY3UgPSB0b3RhbENvbG9yIC8gdm9sdW1lO1xuICAgICAgbWN1ID0gTWF0aC5yb3VuZCgoMS40OTIyICogKE1hdGgucG93KG1jdSwgMC42ODU5KSkpICogMTAwKSAvIDEwMDtcbiAgICAgIGlmKG1jdSA+IDUwKXtcbiAgICAgICAgbWN1ID0gNTA7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1jdTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgIH07XG4gICAgLy9pbiB1bml0IHRlc3QgLSBjYWxjIGFidiAlXG4gIHRoaXMuYWJ2ID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgZmcpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZCgoNzYuMDggKiAob2ctZmcpIC8gKDEuNzc1IC0gb2cpKSAqIChmZyAvIDAuNzk0KSAqIDEwMCkgLyAxMDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwXG4gICAgfVxuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNhbGN1bGF0ZSBkaWFzdGF0aWMgcG93ZXJcbiAgdGhpcy5kcCA9IGZ1bmN0aW9uKGdyYWlucywgdG90YWxXZWlnaHQpe1xuICAgIGlmKGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgdG90YWxkcCA9IDA7XG4gICAgICBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgdG90YWxkcCArPSBncmFpbi5kcCAqIGdyYWluLndlaWdodDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQodG90YWxkcCAvIHRvdGFsV2VpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG4gIC8vaW4gdW5pdCB0ZXN0IC0gY29uc3RydWN0b3IgZm9yIG5ldyBncmFpbiBpdGVtXG4gIHRoaXMubmV3R3JhaW4gPSBmdW5jdGlvbihncmFpbk9iaikge1xuICAgIHRoaXMuUFBHID0gZ3JhaW5PYmouUFBHO1xuICAgIHRoaXMuY2hhcmFuZEFwcHMgPSBncmFpbk9iai5jaGFyYW5kQXBwcztcbiAgICB0aGlzLmRwID0gZ3JhaW5PYmouZHA7XG4gICAgdGhpcy5mbGF2b3IgPSBncmFpbk9iai5mbGF2b3I7XG4gICAgdGhpcy5pZCA9IGdyYWluT2JqLmlkO1xuICAgIHRoaXMubG92aSA9IGdyYWluT2JqLmxvdmk7XG4gICAgdGhpcy5uYW1lID0gZ3JhaW5PYmoubmFtZTtcbiAgICB0aGlzLndlaWdodD0gZ3JhaW5PYmoud2VpZ2h0O1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNvbnN0cnVjdG9yIGZvciBuZXcgaG9wIGl0ZW1cbiAgdGhpcy5uZXdIb3AgPSBmdW5jdGlvbihob3BPYmopIHtcbiAgICB0aGlzLkFscGhhX0FjaWQgPSBob3BPYmouQWxwaGFfQWNpZDtcbiAgICB0aGlzLkJldGFfQWNpZCA9IGhvcE9iai5CZXRhX0FjaWQ7XG4gICAgdGhpcy5OYW1lID0gaG9wT2JqLk5hbWU7XG4gICAgdGhpcy5Ob3RlcyA9IGhvcE9iai5Ob3RlcztcbiAgICB0aGlzLk9yaWdpbiA9IGhvcE9iai5PcmlnaW47XG4gICAgdGhpcy5UeXBlID0gaG9wT2JqLlR5cGU7XG4gICAgdGhpcy5ob3BUaW1lID0gaG9wT2JqLmhvcFRpbWU7XG4gICAgdGhpcy5ob3BUeXBlID0gaG9wT2JqLmhvcFR5cGU7XG4gICAgdGhpcy53ZWlnaHQgPSBob3BPYmoud2VpZ2h0O1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNvbnN0cnVjdG9yIGZvciBhIGJsYW5rIHJlY2lwZVxuICB0aGlzLnJlY2lwZSA9IGZ1bmN0aW9uKHNjb3BlLCByZWNpcGVGdW5jKSB7XG4gICAgdGhpcy5lZmZpY2llbmN5ID0gNjU7XG4gICAgdGhpcy5hdHRlbnVhdGlvbiA9IDc1O1xuICAgIHRoaXMudm9sdW1lID0gNTtcbiAgICB0aGlzLmdyYWlucyA9IHtcbiAgICAgIGFkZGVkOiBbXVxuICAgIH07XG4gICAgdGhpcy5ob3BzID0ge1xuICAgICAgYWRkZWQ6IFtdLFxuICAgICAgaWJ1OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5pYnUoc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQsIHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUsIHNjb3BlLnJlY2lwZS5vZygpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMub2cgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUpLCBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSlcbiAgICB9O1xuICAgIHRoaXMuZmcgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZmcoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLm9nKCksIHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbilcbiAgICB9O1xuICAgIHRoaXMuYWJ2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmFidihzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUub2coKSwgc2NvcGUucmVjaXBlLmZnKCkpO1xuICAgICAgfTtcbiAgICB0aGlzLnNybSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5zcm0oc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSk7XG4gICAgICB9O1xuICAgIHRoaXMuZHAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZHAoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgICB9O1xuICAgIHRoaXMubm90ZXMgPSAnJztcbiAgICB0aGlzLnJlY2lwZXllYXN0ID0gIHNjb3BlLnllYXN0O1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSB0aGlzIGNhbGN1bGF0ZXMgc3RhdHMgZm9yIGVhY2ggc2F2ZWQgcmVjaXBlXG4gIHRoaXMuY2FsY3VsYXRlU3RhdHMgPSBmdW5jdGlvbihyZWNpcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICByZWNpcGUub2cgPSByZWNpcGVGdW5jLmVmZmljaWVuY3lQUEcocmVjaXBlRnVuYy50b3RhbFBQRyhyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUudm9sdW1lKSwgcmVjaXBlLmVmZmljaWVuY3kpO1xuICAgIHJlY2lwZS5mZyA9IHJlY2lwZUZ1bmMuZmcocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLm9nLCByZWNpcGUuYXR0ZW51YXRpb24pO1xuICAgIHJlY2lwZS5hYnYgPSByZWNpcGVGdW5jLmFidihyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUub2csIHJlY2lwZS5mZyk7XG4gICAgcmVjaXBlLnNybSA9IHJlY2lwZUZ1bmMuc3JtKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUpO1xuICAgIHJlY2lwZS5kcCA9IHJlY2lwZUZ1bmMuZHAocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChyZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgcmVjaXBlLmhvcHMuaWJ1ID0gcmVjaXBlRnVuYy5pYnUocmVjaXBlLmhvcHMuYWRkZWQsIHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUsIHJlY2lwZS5vZyk7XG4gICAgcmV0dXJuIHJlY2lwZTtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0cyAtIHRoaXMgZ2V0cyBhbiBpdGVtIGZyb20gdGhlIHNxbGl0ZSBkYlxuICB0aGlzLmdldEl0ZW0gPSBmdW5jdGlvbihodHRwLCBzY29wZSwgaXRlbSkge1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHVybDogJy8nICsgaXRlbVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICBzY29wZVtpdGVtXSA9IHJlcy5kYXRhO1xuICAgIH0pO1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSBzYXZlcyByZWNpcGUgdG8gZGF0YWJhc2Ugd2l0aCBhIHRpZSB0byB0aGUgdXNlclxuICB0aGlzLnNhdmVSZWNpcGUgPSBmdW5jdGlvbihodHRwLCBzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHZhciByZWNpcGUgPSB7XG4gICAgICB1c2VybmFtZTogc2NvcGUudXNlci51c2VybmFtZSxcbiAgICAgIG5hbWU6IHNjb3BlLnJlY2lwZS5uYW1lLFxuICAgICAgZ3JhaW5zOiB7XG4gICAgICAgIGFkZGVkOiBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkXG4gICAgICB9LFxuICAgICAgZWZmaWNpZW5jeTogc2NvcGUucmVjaXBlLmVmZmljaWVuY3ksXG4gICAgICB2b2x1bWU6IHNjb3BlLnJlY2lwZS52b2x1bWUsXG4gICAgICBhdHRlbnVhdGlvbjogc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uLFxuICAgICAgaG9wczoge1xuICAgICAgICBhZGRlZDogc2NvcGUucmVjaXBlLmhvcHMuYWRkZWRcbiAgICAgIH0sXG4gICAgICBub3Rlczogc2NvcGUubm90ZXMsXG4gICAgICB5ZWFzdDogc2NvcGUueWVhc3RcbiAgICB9O1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzJyxcbiAgICAgIGRhdGE6IHJlY2lwZVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgIHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZShzY29wZSwgcmVjaXBlRnVuYyk7XG4gICAgICBzY29wZS5ub3RlcyA9ICcnO1xuICAgICAgc2NvcGUueWVhc3QgPSB7fTtcbiAgICB9KVxuICB9O1xuLy9pbiB1bml0IHRlc3QgLSByZXNldCBzY29wZS5yZWNpcGUgdmFsdWVzXG4gIHRoaXMuY2xlYXJDdXJyZW50UmVjaXBlID0gZnVuY3Rpb24oc2NvcGUsIHJlY2lwZUZ1bmMpe1xuICAgIHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZShzY29wZSwgcmVjaXBlRnVuYyk7XG4gICAgc2NvcGUubm90ZXMgPSAnJztcbiAgICBzY29wZS55ZWFzdCA9IHt9O1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSByZXBsYWNlIHNjb3BlLnJlY2lwZSB3aXRoIGEgc2VsZWN0ZWQgcmVjaXBlJ3MgdmFsdWVzXG4gIHRoaXMuZWRpdFJlY2lwZSA9IGZ1bmN0aW9uKHNhdmVkcmVjaXBlLCBzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHNjb3BlLnJlY2lwZS5uYW1lID0gc2F2ZWRyZWNpcGUubmFtZTtcbiAgICBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSA9IHNhdmVkcmVjaXBlLmVmZmljaWVuY3k7XG4gICAgc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uID0gc2F2ZWRyZWNpcGUuYXR0ZW51YXRpb247XG4gICAgc2NvcGUucmVjaXBlLnZvbHVtZSA9IHNhdmVkcmVjaXBlLnZvbHVtZTtcbiAgICBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkID0gc2F2ZWRyZWNpcGUuZ3JhaW5zLmFkZGVkO1xuICAgIHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkID0gc2F2ZWRyZWNpcGUuaG9wcy5hZGRlZDtcbiAgICBzY29wZS5ub3RlcyA9IHNhdmVkcmVjaXBlLm5vdGVzO1xuICAgIHNjb3BlLnllYXN0ID0gc2F2ZWRyZWNpcGUueWVhc3Q7XG4gICAgc2NvcGUuc2VsZWN0ZWRJbmRleCA9IDA7XG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHJlbW92ZSByZWNpcGUgZnJvbSBkYiBieSB1c2VybmFtZVxuICB0aGlzLmRlbGV0ZVJlY2lwZSA9IGZ1bmN0aW9uKGlkLCBodHRwLCBjYWxsYmFjayl7XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdkZWxldGUnLFxuICAgICAgZGF0YToge2lkOiBpZH0sXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL2RlbGV0ZS8nLFxuICAgICAgaGVhZGVyczoge1wiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04XCJ9XG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgY2FsbGJhY2socmVzKTtcbiAgICB9KVxuICB9O1xuXG4vL2luIHVuaXQgdGVzdCAtIHRoaXMgd2lsbCBncmFiIGxsIHNhdmVkIHJlY2lwZXMgYnkgdXNlcm5hbWUgdGhhdCBpcyBpbiB0aGUgZGF0YWJhc2VcbiAgdGhpcy5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbihzY29wZSwgaHR0cCwgcmVjaXBlRnVuYykge1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL3NhdmVkJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgc2NvcGUucmVjaXBlcyA9IHJlcy5kYXRhO1xuICAgICAgICBzY29wZS5yZWNpcGVzLmZvckVhY2goZnVuY3Rpb24ocmVjaXBlLCBpbmRleCl7XG4gICAgICAgICAgc2NvcGUucmVjaXBlc1tpbmRleF0gPSByZWNpcGVGdW5jLmNhbGN1bGF0ZVN0YXRzKHJlY2lwZSwgcmVjaXBlRnVuYyk7XG4gICAgICB9KTtcbiAgICB9KVxuICB9XG59KTtcblxuLy9pbiB1bml0IHRlc3QgLSB0aGlzIHdpbGwgY2FsY3VsYXRlIGEgcHBnIGJhc2VkIG9uIHRoZSBEQkZHIGZyb20gYSBkYXRhc2hlZXRcbmFwcC5zZXJ2aWNlKCdQcGdDYWxjJywgZnVuY3Rpb24gKCl7XG4gIHRoaXMuY2FsY1BwZyA9IGZ1bmN0aW9uKGRiZmcpIHtcbiAgICBpZih0eXBlb2YgZGJmZyAhPT0gJ251bWJlcicpe1xuICAgICAgZGJmZyA9IDA7XG4gICAgfVxuICAgIGRiZmcgPSAoMTAwMCAqICgxICsgKGRiZmcgLyAxMDApICogMC4wNDYyMSkpIC8gMTAwMFxuICAgIGRiZmcgPSBkYmZnLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgcmV0dXJuIGRiZmc7XG4gIH07XG4gIHRoaXMubmV3SXRlbSA9IGZ1bmN0aW9uIChuZXdJdGVtLCBQcGdDYWxjKSB7XG4gICAgdGhpcy5wcGcgPSBQcGdDYWxjLmNhbGNQcGcobmV3SXRlbS5kYmZnKTtcbiAgICB0aGlzLmRiZmcgPSBuZXdJdGVtLmRiZmc7XG4gICAgdGhpcy5uYW1lID0gbmV3SXRlbS5uYW1lO1xuICB9XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==