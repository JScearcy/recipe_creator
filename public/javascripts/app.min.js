var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,n,r){t.html5Mode(!0),r.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,n){e.user={},e.user.recipetemplate="/views/notloggedin.html",n.getItem(t,e,"grains"),n.getItem(t,e,"hops"),n.getItem(t,e,"yeasts"),e.recipe=new n.recipe(e,n),e.clearCurrentRecipe=function(){return new n.clearCurrentRecipe(e,n)},e.saveRecipe=function(){return n.saveRecipe(t,e,n)},e.editRecipe=function(t){return n.editRecipe(t,e,n)},e.addIngredient=function(t,i,r){switch(i){case"grains":var o=new n.newGrain(t);break;case"hops":var o=new n.newHop(t);break;default:return}e.recipe[i].added.push(o),e[r]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.goToPage=function(e){return e},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.deleteRecipe=function(n){i.deleteRecipe(n._id,t,function(t){e.getSavedRecipes()})},e.getSavedRecipes=function(){return i.getSavedRecipes(e,t,i)}}]),app.controller("dbsgCalc",["$scope","PpgCalc",function(e,t){e.ppgItems=[],e.clearAll=function(){e.ppgItems=[]},e.addGrain=function(){e.ppgItems.push(new t.newItem(e.newItem,t)),e.newItem={}}}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,n){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,n){if(e.length>0&&t.length>0){var r=0,o=0,a=1.65*Math.pow(125e-6,n-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"Boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,n=a*t;r+=n*o}else if("Whirlpool"==e.hopType){var n=.1;r+=n*o}}),Math.round(100*r)/100}return 0},this.fg=function(e,t,i){if(t>0){var n=Math.round(1e3*(t-1)*(i/100))/1e3;return n=t-n,n.toString().length>5&&(n=n.toString().slice(0,5)),n}return 0},this.srm=function(e,t){if(e.length>0){var i=0,n=e.forEach(function(e,t){i+=e.lovi*e.weight});return n=i/t,n=Math.round(1.4922*Math.pow(n,.6859)*100)/100,n>50&&(n=50),n}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=75,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){var n={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:n}).then(function(e){t.recipe=new i.recipe(t,i),t.notes="",t.yeast={}})},this.clearCurrentRecipe=function(e,t){e.recipe=new t.recipe(e,t),e.notes="",e.yeast={}},this.editRecipe=function(e,t,i){t.recipe.name=e.name,t.recipe.efficiency=e.efficiency,t.recipe.attenuation=e.attenuation,t.recipe.volume=e.volume,t.recipe.grains.added=e.grains.added,t.recipe.hops.added=e.hops.added,t.notes=e.notes,t.yeast=e.yeast,t.selectedIndex=0},this.deleteRecipe=function(e,t,i){t({method:"delete",data:{id:e},url:"/private/recipes/delete/",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(e){i(e)})},this.getSavedRecipes=function(e,t,i){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,n){e.recipes[n]=i.calculateStats(t,i)})})}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return"number"!=typeof e&&(e=0),e=1e3*(1+e/100*.04621)/1e3,e=e.toString().slice(0,5)},this.newItem=function(e,t){this.ppg=t.calcPpg(e.dbfg),this.dbfg=e.dbfg,this.name=e.name}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJlY2lwZXNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwiand0SW50ZXJjZXB0b3JQcm92aWRlciIsImh0bWw1TW9kZSIsInRva2VuR2V0dGVyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJzY29wZSIsIm90aGVyVmFsIiwibGluayIsImVsZW0iLCJhdHRyIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiaXNNYXRjaCIsIm1vZGVsVmFsIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJyZWNpcGVGdW5jIiwidXNlciIsInJlY2lwZXRlbXBsYXRlIiwicmVjaXBlIiwiY2xlYXJDdXJyZW50UmVjaXBlIiwic2F2ZVJlY2lwZSIsImVkaXRSZWNpcGUiLCJhZGRJbmdyZWRpZW50IiwiaW5ncmVkaWVudCIsInR5cGUiLCJtb2RlbCIsImFkZGVkSW5ncmVkaWVudCIsIm5ld0dyYWluIiwibmV3SG9wIiwiYWRkZWQiLCJkZWxldGVJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJ1c2VyVG9rZW4iLCJkZWNvZGVUb2tlbiIsIiRsb2NhdGlvbiIsInVzZXJMb2dpbiIsIm1ldGhvZCIsImRhdGEiLCJ1cmwiLCJ0aGVuIiwicmVzIiwidG9rZW4iLCJzZXRJdGVtIiwiZXJyb3IiLCJwYXNzd29yZCIsInJlZ2lzdGVyVXNlciIsImdvVG9QYWdlIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsImRlbGV0ZVJlY2lwZSIsIl9pZCIsImdldFNhdmVkUmVjaXBlcyIsIlBwZ0NhbGMiLCJwcGdJdGVtcyIsImNsZWFyQWxsIiwiYWRkR3JhaW4iLCJuZXdJdGVtIiwic2VydmljZSIsInRoaXMiLCJ0b3RhbFdlaWdodCIsImluZ3JlZGllbnRzIiwidG90YWwiLCJmb3JFYWNoIiwid2VpZ2h0IiwicGFyc2VJbnQiLCJ0b3RhbFBQRyIsImdyYWlucyIsInZvbHVtZSIsImdyYWluIiwiTWF0aCIsInJvdW5kIiwiUFBHIiwiZWZmaWNpZW5jeVBQRyIsImVmZmljaWVuY3kiLCJlZmZQUEciLCJ0b1N0cmluZyIsImxlbmd0aCIsInNsaWNlIiwiaWJ1IiwiaG9wcyIsIm9nIiwiYWF1IiwiYmlnRmFjdCIsInBvdyIsImhvcCIsIkFscGhhX0FjaWQiLCJob3BUeXBlIiwiYm9pbFRGYWN0IiwiaG9wVGltZSIsInV0aWwiLCJmZyIsImF0dGVudWF0aW9uIiwieWVhc3RGb29kIiwic3JtIiwidG90YWxDb2xvciIsIm1jdSIsImxvdmkiLCJhYnYiLCJkcCIsInRvdGFsZHAiLCJncmFpbk9iaiIsImNoYXJhbmRBcHBzIiwiZmxhdm9yIiwiaWQiLCJuYW1lIiwiaG9wT2JqIiwiQmV0YV9BY2lkIiwiTmFtZSIsIk5vdGVzIiwiT3JpZ2luIiwiVHlwZSIsIm5vdGVzIiwicmVjaXBleWVhc3QiLCJ5ZWFzdCIsImNhbGN1bGF0ZVN0YXRzIiwiaHR0cCIsIml0ZW0iLCJzYXZlZHJlY2lwZSIsInNlbGVjdGVkSW5kZXgiLCJjYWxsYmFjayIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJyZWNpcGVzIiwiY2FsY1BwZyIsImRiZmciLCJwcGciXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsaUJBQUEsYUFBQSxVQUFBLGVBQ0FGLEtBQUFHLFFBQUEsaUJBQ0Esb0JBQ0EscUJBQ0EsZ0JBQ0EseUJBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMs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QUFNLEVBQUFOLE1BQ0FsSCxFQUFBb0gsTUFBQUksRUFBQUosTUFDQXBILEVBQUF5SCxjQUFBLEdBR0E1RCxLQUFBVCxhQUFBLFNBQUFzRCxFQUFBWSxFQUFBSSxHQUNBSixHQUNBbEYsT0FBQSxTQUNBQyxNQUFBcUUsR0FBQUEsR0FDQXBFLElBQUEsMkJBQ0FxRixTQUFBQyxlQUFBLG9DQUNBckYsS0FBQSxTQUFBQyxHQUNBa0YsRUFBQWxGLE1BS0FxQixLQUFBUCxnQkFBQSxTQUFBdEQsRUFBQXNILEVBQUF4RyxHQUNBd0csR0FDQWxGLE9BQUEsT0FDQUUsSUFBQSwyQkFDQUMsS0FBQSxTQUFBQyxHQUNBeEMsRUFBQTZILFFBQUFyRixFQUFBSCxLQUNBckMsRUFBQTZILFFBQUE1RCxRQUFBLFNBQUFoRCxFQUFBYSxHQUNBOUIsRUFBQTZILFFBQUEvRixHQUFBaEIsRUFBQXVHLGVBQUFwRyxFQUFBSCxVQU9BdEMsSUFBQW9GLFFBQUEsVUFBQSxXQUNBQyxLQUFBaUUsUUFBQSxTQUFBQyxHQU1BLE1BTEEsZ0JBQUFBLEtBQ0FBLEVBQUEsR0FFQUEsRUFBQSxLQUFBLEVBQUFBLEVBQUEsSUFBQSxRQUFBLElBQ0FBLEVBQUFBLEVBQUFqRCxXQUFBRSxNQUFBLEVBQUEsSUFHQW5CLEtBQUFGLFFBQUEsU0FBQUEsRUFBQUosR0FDQU0sS0FBQW1FLElBQUF6RSxFQUFBdUUsUUFBQW5FLEVBQUFvRSxNQUNBbEUsS0FBQWtFLEtBQUFwRSxFQUFBb0UsS0FDQWxFLEtBQUE4QyxLQUFBaEQsRUFBQWdEIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgncmVjaXBlQ3JlYXRvcicsIFsnbmdNYXRlcmlhbCcsICduZ1JvdXRlJywgJ2FuZ3VsYXItand0J10pO1xuICBhcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJG1kVGhlbWluZ1Byb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRodHRwUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnand0SW50ZXJjZXB0b3JQcm92aWRlcicsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCBqd3RJbnRlcmNlcHRvclByb3ZpZGVyKXtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICBqd3RJbnRlcmNlcHRvclByb3ZpZGVyLnRva2VuR2V0dGVyID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9XG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnand0SW50ZXJjZXB0b3InKTtcblxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXG4gICAgICAucHJpbWFyeVBhbGV0dGUoJ2FtYmVyJylcbiAgICAgIC5hY2NlbnRQYWxldHRlKCd5ZWxsb3cnKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSkud2hlbignL2Ric2dfY2FsYycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Ric2djYWxjLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2Ric2dDYWxjJ1xuICAgIH0pLndoZW4oJy9sb2dpbicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ29udHJvbCdcbiAgICB9KS53aGVuKCcvcmVnaXN0ZXInLCB7XG4gICAgICB0ZW1wbGF0ZVVybDonL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlZ2lzdGVyQ29udHJvbCdcbiAgICB9KS5vdGhlcndpc2UoJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSk7XG4gIH1dKTtcbiAgYXBwLmRpcmVjdGl2ZSgnaXNNYXRjaCcsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIG90aGVyVmFsOiBcIj1pc01hdGNoXCJcbiAgICAgIH0sXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0ciwgbmdNb2RlbCkge1xuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmlzTWF0Y2ggPSBmdW5jdGlvbihtb2RlbFZhbCkge1xuICAgICAgICAgIHJldHVybiBtb2RlbFZhbCA9PT0gc2NvcGUub3RoZXJWYWw7XG4gICAgICAgIH07XG4gICAgICAgIHNjb3BlLiR3YXRjaCgnb3RoZXJWYWwnLCBmdW5jdGlvbigpe1xuICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xuICAvL2NvbnRyb2xsZXIgZm9yIHRoZSByZWNpcGUgYnVpbGRlclxuICBhcHAuY29udHJvbGxlcigncmVjaXBlTWFrZScsIFsnJHNjb3BlJywgJyRodHRwJywgJ2p3dEhlbHBlcicsICdyZWNpcGVGdW5jJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgand0SGVscGVyLCByZWNpcGVGdW5jKXtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJztcblxuICAgIC8vZ2V0IGFsbCBpdGVtcyBsaXN0ZWQgaW4gdGhlIHNlbGVjdCBtZW51XG4gICAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICdncmFpbnMnKTtcbiAgICByZWNpcGVGdW5jLmdldEl0ZW0oJGh0dHAsICRzY29wZSwgJ2hvcHMnKTtcbiAgICByZWNpcGVGdW5jLmdldEl0ZW0oJGh0dHAsICRzY29wZSwgJ3llYXN0cycpO1xuXG4gICAgLy9UaGUgb2JqZWN0IHVzZWQgZm9yIHJlY2lwZSBjcmVhdGlvbiBhcyB3ZWxsIGFzIGNhbGN1bGF0aW9uc1xuICAgICRzY29wZS5yZWNpcGUgPSBuZXcgcmVjaXBlRnVuYy5yZWNpcGUoJHNjb3BlLCByZWNpcGVGdW5jKTtcblxuICAgIC8vU2F2ZS9jbGVhci9lZGl0IGZ1bmN0aW9uIGZvciBidXR0b24gbmctY2xpY2tcbiAgICAkc2NvcGUuY2xlYXJDdXJyZW50UmVjaXBlID0gZnVuY3Rpb24oKXsgcmV0dXJuIG5ldyByZWNpcGVGdW5jLmNsZWFyQ3VycmVudFJlY2lwZSgkc2NvcGUsIHJlY2lwZUZ1bmMpIH07XG4gICAgJHNjb3BlLnNhdmVSZWNpcGUgPSBmdW5jdGlvbigpeyByZXR1cm4gcmVjaXBlRnVuYy5zYXZlUmVjaXBlKCRodHRwLCAkc2NvcGUsIHJlY2lwZUZ1bmMpIH07XG4gICAgJHNjb3BlLmVkaXRSZWNpcGUgPSBmdW5jdGlvbihyZWNpcGUpIHsgcmV0dXJuIHJlY2lwZUZ1bmMuZWRpdFJlY2lwZShyZWNpcGUsICRzY29wZSwgcmVjaXBlRnVuYykgfVxuXG4gICAgLy9nZW5lcmljIGZ1bmN0aW9uIHRvIGFkZCBhbiBpdGVtIHRvIHRoZSBhcnJheSBmb3IgdGhvc2UgaW5ncmVkaWVudHNcbiAgICAkc2NvcGUuYWRkSW5ncmVkaWVudCA9IGZ1bmN0aW9uKGluZ3JlZGllbnQsIHR5cGUsIG1vZGVsKXtcbiAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ2dyYWlucyc6XG4gICAgICAgICAgdmFyIGFkZGVkSW5ncmVkaWVudCA9IG5ldyByZWNpcGVGdW5jLm5ld0dyYWluKGluZ3JlZGllbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdob3BzJzpcbiAgICAgICAgICB2YXIgYWRkZWRJbmdyZWRpZW50ID0gbmV3IHJlY2lwZUZ1bmMubmV3SG9wKGluZ3JlZGllbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybjtcbiAgICAgIH07XG4gICAgICAkc2NvcGUucmVjaXBlW3R5cGVdLmFkZGVkLnB1c2goYWRkZWRJbmdyZWRpZW50KTtcbiAgICAgICRzY29wZVttb2RlbF0gPSB7fTtcbiAgICB9XG4gICAgLy9yZW1vdmUgYnV0dG9uIGZ1bmN0aW9uIC0gcmVtb3ZlcyBvbmUgaXRlbSBmcm9tIHRoZSBhcnJheVxuICAgICRzY29wZS5kZWxldGVJdGVtID0gZnVuY3Rpb24oaW5kZXgsIHR5cGUpIHtcbiAgICAgICRzY29wZS5yZWNpcGVbdHlwZV0uYWRkZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG5cbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpIHtcbiAgICAgICAgICB2YXIgdXNlclRva2VuID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXJUb2tlbjtcbiAgICAgICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvcHJpdmF0ZS92aWV3cy9zYXZlZHJlY2lwZXMuaHRtbCdcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJ1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1dKTtcbiAgLy9jb250cm9sbGVyIGZvciBsb2dpbiBzY3JlZW4gLSBzZW5kcyB1c2VyL3Bhc3MgYW5kIHN0b3JlcyBqd3RcbiAgYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnVzZXJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9sb2dpbmF1dGgnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGlmKHJlcy5kYXRhLnRva2VuKXtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyVG9rZW4nLCByZXMuZGF0YS50b2tlbik7XG4gICAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XG4gICAgICAgIH07XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUuZXJyb3IgPSByZXMuZGF0YTtcbiAgICAgICAgJHNjb3BlLnVzZXIucGFzc3dvcmQgPSAnJztcbiAgICAgIH0pO1xuICAgIH1cbiAgfV0pO1xuXG5cbiAgLy9jb250cm9sbGVyIGZvciByZWdpc3RlciBwYWdlIC0gc2VuZHMgbmV3IHVzZXIgaW5mbyBhbmQgcmV0dXJucyB0aGF0IGRhdGFcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uKCl7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgICAkbG9jYXRpb24udXJsKCcvbG9naW4nKTtcbiAgICAgIH0sIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcbiAgYXBwLmNvbnRyb2xsZXIoJ2hlYWRlckNvbnRyb2wnLCBbJyRzY29wZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkc2NvcGUsIGp3dEhlbHBlcil7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAkc2NvcGUuZ29Ub1BhZ2UgPSBmdW5jdGlvbih1cmwpIHtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpe1xuICAgICAgICAkc2NvcGUudXNlciA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ291dCAnICsgJHNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy8nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW4gPSAnTG9naW4vUmVnaXN0ZXInO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvbG9naW4nXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9O1xuICB9XSk7XG5cbiAgYXBwLmNvbnRyb2xsZXIoJ3NhdmVkUmVjaXBlcycsIFsnJHNjb3BlJywgJyRodHRwJywncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHJlY2lwZUZ1bmMpe1xuICAgICRzY29wZS5kZWxldGVSZWNpcGUgPSBmdW5jdGlvbihyZWNpcGUpIHtcbiAgICAgIHJlY2lwZUZ1bmMuZGVsZXRlUmVjaXBlKHJlY2lwZS5faWQsICRodHRwLCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgICRzY29wZS5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHJlY2lwZUZ1bmMuZ2V0U2F2ZWRSZWNpcGVzKCRzY29wZSwgJGh0dHAsIHJlY2lwZUZ1bmMpIH07XG4gIH1dKTtcbiAgYXBwLmNvbnRyb2xsZXIoJ2Ric2dDYWxjJywgWyckc2NvcGUnLCAnUHBnQ2FsYycsIGZ1bmN0aW9uKCRzY29wZSwgUHBnQ2FsYyl7XG4gICAgJHNjb3BlLnBwZ0l0ZW1zID0gW107XG4gICAgJHNjb3BlLmNsZWFyQWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUucHBnSXRlbXMgPSBbXTtcbiAgICB9O1xuICAgICRzY29wZS5hZGRHcmFpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgJHNjb3BlLnBwZ0l0ZW1zLnB1c2gobmV3IFBwZ0NhbGMubmV3SXRlbSgkc2NvcGUubmV3SXRlbSwgUHBnQ2FsYykpO1xuICAgICAgJHNjb3BlLm5ld0l0ZW0gPSB7fTtcbiAgICB9O1xuICB9XSk7XG4iLCJhcHAuc2VydmljZSgncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCl7XG4gIC8vaW4gdW5pdCB0ZXN0IHRoaXMgY2FsY3VsYXRlcyB0aGUgd2VpZ2h0IG9mIGFsbCBncmFpbnMgYWRkZWRcbiAgdGhpcy50b3RhbFdlaWdodCA9IGZ1bmN0aW9uKGluZ3JlZGllbnRzKXtcbiAgICB2YXIgdG90YWwgPSAwO1xuICAgIGluZ3JlZGllbnRzLmZvckVhY2goZnVuY3Rpb24oaW5ncmVkaWVudCl7XG4gICAgICBpZihpbmdyZWRpZW50LndlaWdodCA+IDApe1xuICAgICAgICB0b3RhbCArPSBwYXJzZUludChpbmdyZWRpZW50LndlaWdodCk7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSB0aGlzIGNhbGN1bGF0ZXMgdGhlIG1heCBzdWdhciBleHRyYWN0aW9uIHBvc3NpYmxlIGZyb20gdGhlIGdyYWluc1xuICB0aGlzLnRvdGFsUFBHID0gZnVuY3Rpb24oZ3JhaW5zLCB2b2x1bWUpe1xuICAgIHZhciB0b3RhbCA9IDA7XG4gICAgZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KXtcbiAgICAgIHRvdGFsICs9IChNYXRoLnJvdW5kKChncmFpbi5QUEcgLSAxKSAqIDEwMDAgKiBncmFpbi53ZWlnaHQgLyB2b2x1bWUpKSAvIDEwMDA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCB0aGlzIGNhbGN1bGF0ZXMgdGhlIGVzdGltYXRlZCBzdWdhciBleHRyYWN0aW9uIGJhc2VkIG9uIHVzZXIncyBlZmYuIGlucHV0XG4gIHRoaXMuZWZmaWNpZW5jeVBQRyA9IGZ1bmN0aW9uKHRvdGFsUFBHLCBlZmZpY2llbmN5KSB7XG4gICAgaWYodG90YWxQUEcgPT09IDApe1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVmZlBQRyA9IE1hdGgucm91bmQodG90YWxQUEcgKiAoZWZmaWNpZW5jeSAvIDEwMCkgKiAxMDAwKSAvIDEwMDAgKyAxO1xuICAgICAgICBpZihlZmZQUEcgPiAxLjUpIHtcbiAgICAgICAgICBlZmZQUEcgPSAxLjU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZWZmUFBHLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgIGVmZlBQRyA9IGVmZlBQRy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZWZmUFBHO1xuICAgICAgfVxuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNhbGN1bGF0ZXMgaWJ1J3MgZm9yIHVzZXIncyBpbnB1dCBob3BzXG4gIHRoaXMuaWJ1ID0gZnVuY3Rpb24oaG9wcywgZ3JhaW5zLCB2b2x1bWUsIG9nKSB7XG4gICAgaWYoaG9wcy5sZW5ndGggPiAwICYmIGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgaWJ1ID0gMDtcbiAgICAgIHZhciBhYXUgPSAwO1xuICAgICAgdmFyIGJpZ0ZhY3QgPSAxLjY1ICogTWF0aC5wb3coMC4wMDAxMjUsIChvZyAtIDEpKTtcbiAgICAgIGhvcHMuZm9yRWFjaChmdW5jdGlvbihob3ApIHtcbiAgICAgICAgYWF1ID0gaG9wLndlaWdodCAqIChob3AuQWxwaGFfQWNpZCAvIDEwMCkgKiA3NDkwIC8gdm9sdW1lO1xuICAgICAgICBpZihob3AuaG9wVHlwZSA9PSAnQm9pbCcpIHtcbiAgICAgICAgICB2YXIgYm9pbFRGYWN0ID0gKCgxIC0gTWF0aC5wb3coMi43MTgyODE4Mjg0NTkwNDUyMzUzNiwgKC0uMDQgKiBob3AuaG9wVGltZSkpKSAvIDMuOCk7XG4gICAgICAgICAgdmFyIHV0aWwgPSBiaWdGYWN0ICogYm9pbFRGYWN0O1xuICAgICAgICAgIGlidSArPSB1dGlsICogYWF1O1xuICAgICAgICB9IGVsc2UgaWYoaG9wLmhvcFR5cGUgPT0gJ1doaXJscG9vbCcpIHtcbiAgICAgICAgICB2YXIgdXRpbCA9IC4xMDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKGlidSAqIDEwMCkgLyAxMDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIHRoaXMgY2FsY3VsYXRlcyB0aGUgZmluYWwgZ3Jhdml0eSBiYXNlZCBvbiBhdHRlbnVhdGlvblxuICB0aGlzLmZnID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgYXR0ZW51YXRpb24pe1xuICAgIGlmKG9nID4gMCkge1xuICAgICAgdmFyIHllYXN0Rm9vZCA9IE1hdGgucm91bmQoKChvZyAtIDEpICogMTAwMCkgKiAoYXR0ZW51YXRpb24gLyAxMDApKSAvIDEwMDA7XG4gICAgICB5ZWFzdEZvb2QgPSBvZyAtIHllYXN0Rm9vZDtcbiAgICAgIGlmKHllYXN0Rm9vZC50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgeWVhc3RGb29kID0geWVhc3RGb29kLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geWVhc3RGb29kO1xuICAgIH0gZWxzZSB7XG4gICAgcmV0dXJuIDBcbiAgICB9XG4gIH07XG4gICAgICAvL2luIHVuaXQgdGVzdCAtIGVzdGltYXRlIGNvbG9yIGJhc2VkIG9uIGdyYWlucyBhZGRlZFxuICB0aGlzLnNybSA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsQ29sb3IgPSAwO1xuICAgICAgdmFyIG1jdSA9IGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICB0b3RhbENvbG9yICs9IChncmFpbi5sb3ZpICogZ3JhaW4ud2VpZ2h0KTtcbiAgICAgIH0pO1xuICAgICAgbWN1ID0gdG90YWxDb2xvciAvIHZvbHVtZTtcbiAgICAgIG1jdSA9IE1hdGgucm91bmQoKDEuNDkyMiAqIChNYXRoLnBvdyhtY3UsIDAuNjg1OSkpKSAqIDEwMCkgLyAxMDA7XG4gICAgICBpZihtY3UgPiA1MCl7XG4gICAgICAgIG1jdSA9IDUwO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtY3U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9O1xuICAgIC8vaW4gdW5pdCB0ZXN0IC0gY2FsYyBhYnYgJVxuICB0aGlzLmFidiA9IGZ1bmN0aW9uKGdyYWlucywgb2csIGZnKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoKDc2LjA4ICogKG9nLWZnKSAvICgxLjc3NSAtIG9nKSkgKiAoZmcgLyAwLjc5NCkgKiAxMDApIC8gMTAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMFxuICAgIH1cbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjYWxjdWxhdGUgZGlhc3RhdGljIHBvd2VyXG4gIHRoaXMuZHAgPSBmdW5jdGlvbihncmFpbnMsIHRvdGFsV2VpZ2h0KXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsZHAgPSAwO1xuICAgICAgZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgIHRvdGFsZHAgKz0gZ3JhaW4uZHAgKiBncmFpbi53ZWlnaHQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRvdGFsZHAgLyB0b3RhbFdlaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuICAvL2luIHVuaXQgdGVzdCAtIGNvbnN0cnVjdG9yIGZvciBuZXcgZ3JhaW4gaXRlbVxuICB0aGlzLm5ld0dyYWluID0gZnVuY3Rpb24oZ3JhaW5PYmopIHtcbiAgICB0aGlzLlBQRyA9IGdyYWluT2JqLlBQRztcbiAgICB0aGlzLmNoYXJhbmRBcHBzID0gZ3JhaW5PYmouY2hhcmFuZEFwcHM7XG4gICAgdGhpcy5kcCA9IGdyYWluT2JqLmRwO1xuICAgIHRoaXMuZmxhdm9yID0gZ3JhaW5PYmouZmxhdm9yO1xuICAgIHRoaXMuaWQgPSBncmFpbk9iai5pZDtcbiAgICB0aGlzLmxvdmkgPSBncmFpbk9iai5sb3ZpO1xuICAgIHRoaXMubmFtZSA9IGdyYWluT2JqLm5hbWU7XG4gICAgdGhpcy53ZWlnaHQ9IGdyYWluT2JqLndlaWdodDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjb25zdHJ1Y3RvciBmb3IgbmV3IGhvcCBpdGVtXG4gIHRoaXMubmV3SG9wID0gZnVuY3Rpb24oaG9wT2JqKSB7XG4gICAgdGhpcy5BbHBoYV9BY2lkID0gaG9wT2JqLkFscGhhX0FjaWQ7XG4gICAgdGhpcy5CZXRhX0FjaWQgPSBob3BPYmouQmV0YV9BY2lkO1xuICAgIHRoaXMuTmFtZSA9IGhvcE9iai5OYW1lO1xuICAgIHRoaXMuTm90ZXMgPSBob3BPYmouTm90ZXM7XG4gICAgdGhpcy5PcmlnaW4gPSBob3BPYmouT3JpZ2luO1xuICAgIHRoaXMuVHlwZSA9IGhvcE9iai5UeXBlO1xuICAgIHRoaXMuaG9wVGltZSA9IGhvcE9iai5ob3BUaW1lO1xuICAgIHRoaXMuaG9wVHlwZSA9IGhvcE9iai5ob3BUeXBlO1xuICAgIHRoaXMud2VpZ2h0ID0gaG9wT2JqLndlaWdodDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjb25zdHJ1Y3RvciBmb3IgYSBibGFuayByZWNpcGVcbiAgdGhpcy5yZWNpcGUgPSBmdW5jdGlvbihzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHRoaXMuZWZmaWNpZW5jeSA9IDY1O1xuICAgIHRoaXMuYXR0ZW51YXRpb24gPSA3NTtcbiAgICB0aGlzLnZvbHVtZSA9IDU7XG4gICAgdGhpcy5ncmFpbnMgPSB7XG4gICAgICBhZGRlZDogW11cbiAgICB9O1xuICAgIHRoaXMuaG9wcyA9IHtcbiAgICAgIGFkZGVkOiBbXSxcbiAgICAgIGlidTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuaWJ1KHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkLCBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUudm9sdW1lLCBzY29wZS5yZWNpcGUub2coKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLm9nID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiByZWNpcGVGdW5jLmVmZmljaWVuY3lQUEcocmVjaXBlRnVuYy50b3RhbFBQRyhzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUudm9sdW1lKSwgc2NvcGUucmVjaXBlLmVmZmljaWVuY3kpXG4gICAgfTtcbiAgICB0aGlzLmZnID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiByZWNpcGVGdW5jLmZnKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS5vZygpLCBzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24pXG4gICAgfTtcbiAgICB0aGlzLmFidiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5hYnYoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLm9nKCksIHNjb3BlLnJlY2lwZS5mZygpKTtcbiAgICAgIH07XG4gICAgdGhpcy5zcm0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuc3JtKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUpO1xuICAgICAgfTtcbiAgICB0aGlzLmRwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmRwKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZUZ1bmMudG90YWxXZWlnaHQoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCkpO1xuICAgICAgfTtcbiAgICB0aGlzLm5vdGVzID0gJyc7XG4gICAgdGhpcy5yZWNpcGV5ZWFzdCA9ICBzY29wZS55ZWFzdDtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0IC0gdGhpcyBjYWxjdWxhdGVzIHN0YXRzIGZvciBlYWNoIHNhdmVkIHJlY2lwZVxuICB0aGlzLmNhbGN1bGF0ZVN0YXRzID0gZnVuY3Rpb24ocmVjaXBlLCByZWNpcGVGdW5jKSB7XG4gICAgcmVjaXBlLm9nID0gcmVjaXBlRnVuYy5lZmZpY2llbmN5UFBHKHJlY2lwZUZ1bmMudG90YWxQUEcocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLnZvbHVtZSksIHJlY2lwZS5lZmZpY2llbmN5KTtcbiAgICByZWNpcGUuZmcgPSByZWNpcGVGdW5jLmZnKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS5vZywgcmVjaXBlLmF0dGVudWF0aW9uKTtcbiAgICByZWNpcGUuYWJ2ID0gcmVjaXBlRnVuYy5hYnYocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLm9nLCByZWNpcGUuZmcpO1xuICAgIHJlY2lwZS5zcm0gPSByZWNpcGVGdW5jLnNybShyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUudm9sdW1lKTtcbiAgICByZWNpcGUuZHAgPSByZWNpcGVGdW5jLmRwKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZUZ1bmMudG90YWxXZWlnaHQocmVjaXBlLmdyYWlucy5hZGRlZCkpO1xuICAgIHJlY2lwZS5ob3BzLmlidSA9IHJlY2lwZUZ1bmMuaWJ1KHJlY2lwZS5ob3BzLmFkZGVkLCByZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUudm9sdW1lLCByZWNpcGUub2cpO1xuICAgIHJldHVybiByZWNpcGU7XG4gIH07XG4vL2luIHVuaXQgdGVzdHMgLSB0aGlzIGdldHMgYW4gaXRlbSBmcm9tIHRoZSBzcWxpdGUgZGJcbiAgdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24oaHR0cCwgc2NvcGUsIGl0ZW0pIHtcbiAgICBodHRwKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICB1cmw6ICcvJyArIGl0ZW1cbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgICAgc2NvcGVbaXRlbV0gPSByZXMuZGF0YTtcbiAgICB9KTtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0IC0gc2F2ZXMgcmVjaXBlIHRvIGRhdGFiYXNlIHdpdGggYSB0aWUgdG8gdGhlIHVzZXJcbiAgdGhpcy5zYXZlUmVjaXBlID0gZnVuY3Rpb24oaHR0cCwgc2NvcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICB2YXIgcmVjaXBlID0ge1xuICAgICAgdXNlcm5hbWU6IHNjb3BlLnVzZXIudXNlcm5hbWUsXG4gICAgICBuYW1lOiBzY29wZS5yZWNpcGUubmFtZSxcbiAgICAgIGdyYWluczoge1xuICAgICAgICBhZGRlZDogc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZFxuICAgICAgfSxcbiAgICAgIGVmZmljaWVuY3k6IHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5LFxuICAgICAgdm9sdW1lOiBzY29wZS5yZWNpcGUudm9sdW1lLFxuICAgICAgYXR0ZW51YXRpb246IHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbixcbiAgICAgIGhvcHM6IHtcbiAgICAgICAgYWRkZWQ6IHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkXG4gICAgICB9LFxuICAgICAgbm90ZXM6IHNjb3BlLm5vdGVzLFxuICAgICAgeWVhc3Q6IHNjb3BlLnllYXN0XG4gICAgfTtcbiAgICBodHRwKHtcbiAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgdXJsOiAnL3ByaXZhdGUvcmVjaXBlcycsXG4gICAgICBkYXRhOiByZWNpcGVcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICBzY29wZS5yZWNpcGUgPSBuZXcgcmVjaXBlRnVuYy5yZWNpcGUoc2NvcGUsIHJlY2lwZUZ1bmMpO1xuICAgICAgc2NvcGUubm90ZXMgPSAnJztcbiAgICAgIHNjb3BlLnllYXN0ID0ge307XG4gICAgfSlcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0IC0gcmVzZXQgc2NvcGUucmVjaXBlIHZhbHVlc1xuICB0aGlzLmNsZWFyQ3VycmVudFJlY2lwZSA9IGZ1bmN0aW9uKHNjb3BlLCByZWNpcGVGdW5jKXtcbiAgICBzY29wZS5yZWNpcGUgPSBuZXcgcmVjaXBlRnVuYy5yZWNpcGUoc2NvcGUsIHJlY2lwZUZ1bmMpO1xuICAgIHNjb3BlLm5vdGVzID0gJyc7XG4gICAgc2NvcGUueWVhc3QgPSB7fTtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0IC0gcmVwbGFjZSBzY29wZS5yZWNpcGUgd2l0aCBhIHNlbGVjdGVkIHJlY2lwZSdzIHZhbHVlc1xuICB0aGlzLmVkaXRSZWNpcGUgPSBmdW5jdGlvbihzYXZlZHJlY2lwZSwgc2NvcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICBzY29wZS5yZWNpcGUubmFtZSA9IHNhdmVkcmVjaXBlLm5hbWU7XG4gICAgc2NvcGUucmVjaXBlLmVmZmljaWVuY3kgPSBzYXZlZHJlY2lwZS5lZmZpY2llbmN5O1xuICAgIHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbiA9IHNhdmVkcmVjaXBlLmF0dGVudWF0aW9uO1xuICAgIHNjb3BlLnJlY2lwZS52b2x1bWUgPSBzYXZlZHJlY2lwZS52b2x1bWU7XG4gICAgc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCA9IHNhdmVkcmVjaXBlLmdyYWlucy5hZGRlZDtcbiAgICBzY29wZS5yZWNpcGUuaG9wcy5hZGRlZCA9IHNhdmVkcmVjaXBlLmhvcHMuYWRkZWQ7XG4gICAgc2NvcGUubm90ZXMgPSBzYXZlZHJlY2lwZS5ub3RlcztcbiAgICBzY29wZS55ZWFzdCA9IHNhdmVkcmVjaXBlLnllYXN0O1xuICAgIHNjb3BlLnNlbGVjdGVkSW5kZXggPSAwO1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSByZW1vdmUgcmVjaXBlIGZyb20gZGIgYnkgdXNlcm5hbWVcbiAgdGhpcy5kZWxldGVSZWNpcGUgPSBmdW5jdGlvbihpZCwgaHR0cCwgY2FsbGJhY2spe1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAnZGVsZXRlJyxcbiAgICAgIGRhdGE6IHtpZDogaWR9LFxuICAgICAgdXJsOiAnL3ByaXZhdGUvcmVjaXBlcy9kZWxldGUvJyxcbiAgICAgIGhlYWRlcnM6IHtcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOFwifVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgfSlcbiAgfTtcblxuLy9pbiB1bml0IHRlc3QgLSB0aGlzIHdpbGwgZ3JhYiBsbCBzYXZlZCByZWNpcGVzIGJ5IHVzZXJuYW1lIHRoYXQgaXMgaW4gdGhlIGRhdGFiYXNlXG4gIHRoaXMuZ2V0U2F2ZWRSZWNpcGVzID0gZnVuY3Rpb24oc2NvcGUsIGh0dHAsIHJlY2lwZUZ1bmMpIHtcbiAgICBodHRwKHtcbiAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgdXJsOiAnL3ByaXZhdGUvcmVjaXBlcy9zYXZlZCdcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIHNjb3BlLnJlY2lwZXMgPSByZXMuZGF0YTtcbiAgICAgICAgc2NvcGUucmVjaXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHJlY2lwZSwgaW5kZXgpe1xuICAgICAgICAgIHNjb3BlLnJlY2lwZXNbaW5kZXhdID0gcmVjaXBlRnVuYy5jYWxjdWxhdGVTdGF0cyhyZWNpcGUsIHJlY2lwZUZ1bmMpO1xuICAgICAgfSk7XG4gICAgfSlcbiAgfVxufSk7XG5cbi8vaW4gdW5pdCB0ZXN0IC0gdGhpcyB3aWxsIGNhbGN1bGF0ZSBhIHBwZyBiYXNlZCBvbiB0aGUgREJGRyBmcm9tIGEgZGF0YXNoZWV0XG5hcHAuc2VydmljZSgnUHBnQ2FsYycsIGZ1bmN0aW9uICgpe1xuICB0aGlzLmNhbGNQcGcgPSBmdW5jdGlvbihkYmZnKSB7XG4gICAgaWYodHlwZW9mIGRiZmcgIT09ICdudW1iZXInKXtcbiAgICAgIGRiZmcgPSAwO1xuICAgIH1cbiAgICBkYmZnID0gKDEwMDAgKiAoMSArIChkYmZnIC8gMTAwKSAqIDAuMDQ2MjEpKSAvIDEwMDBcbiAgICBkYmZnID0gZGJmZy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgIHJldHVybiBkYmZnO1xuICB9O1xuICB0aGlzLm5ld0l0ZW0gPSBmdW5jdGlvbiAobmV3SXRlbSwgUHBnQ2FsYykge1xuICAgIHRoaXMucHBnID0gUHBnQ2FsYy5jYWxjUHBnKG5ld0l0ZW0uZGJmZyk7XG4gICAgdGhpcy5kYmZnID0gbmV3SXRlbS5kYmZnO1xuICAgIHRoaXMubmFtZSA9IG5ld0l0ZW0ubmFtZTtcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=