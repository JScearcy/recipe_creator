var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,n,r){t.html5Mode(!0),r.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.goToPage=function(e){return e},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.service("PpgCalc",function(){this.calcPpg=function(e){return"number"!=typeof e&&(e=0),e=1e3*(1+e/100*.04621)/1e3,e=e.toString().slice(0,5)},this.newItem=function(e,t){this.ppg=t.calcPpg(e.dbfg),this.dbfg=e.dbfg,this.name=e.name}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,n){e.user={},e.user.recipetemplate="/views/notloggedin.html",n.getItem(t,e,"grains"),n.getItem(t,e,"hops"),n.getItem(t,e,"yeasts"),e.recipe=new n.recipe(e,n),e.clearCurrentRecipe=function(){return new n.clearCurrentRecipe(e,n)},e.saveRecipe=function(){return n.saveRecipe(t,e,n)},e.editRecipe=function(t){return n.editRecipe(t,e,n)},e.addIngredient=function(t,i,r){switch(i){case"grains":var o=new n.newGrain(t);break;case"hops":var o=new n.newHop(t);break;default:return}e.recipe[i].added.push(o),e[r]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,n){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,n){if(e.length>0&&t.length>0){var r=0,o=0,a=1.65*Math.pow(125e-6,n-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"Boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,n=a*t;r+=n*o}else if("Whirlpool"==e.hopType){var n=.1;r+=n*o}}),Math.round(100*r)/100}return 0},this.fg=function(e,t,i){if(t>0){var n=Math.round(1e3*(t-1)*(i/100))/1e3;return n=t-n,n.toString().length>5&&(n=n.toString().slice(0,5)),n}return 0},this.srm=function(e,t){if(e.length>0){var i=0,n=e.forEach(function(e,t){i+=e.lovi*e.weight});return n=i/t,n=Math.round(1.4922*Math.pow(n,.6859)*100)/100,n>50&&(n=50),n}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.hopTimeUnit=e.hopTimeUnit,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=75,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){var n={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:n}).then(function(e){t.recipe=new i.recipe(t,i),t.notes="",t.yeast={}})},this.clearCurrentRecipe=function(e,t){e.recipe=new t.recipe(e,t),e.notes="",e.yeast={}},this.editRecipe=function(e,t,i){t.recipe.name=e.name,t.recipe.efficiency=e.efficiency,t.recipe.attenuation=e.attenuation,t.recipe.volume=e.volume,t.recipe.grains.added=e.grains.added,t.recipe.hops.added=e.hops.added,t.notes=e.notes,t.yeast=e.yeast,t.selectedIndex=0},this.deleteRecipe=function(e,t,i){t({method:"delete",data:{id:e},url:"/private/recipes/delete/",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(e){i(e)})},this.getSavedRecipes=function(e,t,i){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,n){e.recipes[n]=i.calculateStats(t,i)})})},this.srmToRgbArray=function(e){if(1>e||"number"!=typeof e)return[251,192,0];var t=[];return t.push(Math.round(Math.min(255,Math.max(0,255*Math.pow(.975,e))))),t.push(Math.round(Math.min(255,Math.max(0,245*Math.pow(.88,e))))),t.push(Math.round(Math.min(255,Math.max(0,220*Math.pow(.7,e))))),t},this.RgbArrayToCSS=function(e){if("object"!=typeof e)var t="rgb(251, 192, 0);";else var t="rgb("+e[0]+", "+e[1]+", "+e[2]+");";return t}}),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.deleteRecipe=function(n){i.deleteRecipe(n._id,t,function(t){e.getSavedRecipes()})},e.getSavedRecipes=function(){return i.getSavedRecipes(e,t,i)}}]),app.controller("dbsgCalc",["$scope","PpgCalc",function(e,t){e.ppgItems=[],e.clearAll=function(){e.ppgItems=[]},e.addGrain=function(){e.ppgItems.push(new t.newItem(e.newItem,t)),e.newItem={}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhlYWRlckN0cmwuanMiLCJsb2dpbkN0cmwuanMiLCJwcGdDYWxjU2VydmljZS5qcyIsInJlY2lwZU1ha2VDdHJsLmpzIiwicmVjaXBlc2VydmljZS5qcyIsInJlZ2lzdHJhdGlvbkN0cmwuanMiLCJzYXZlZFJlY2lwZXNDdHJsLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJG1kVGhlbWluZ1Byb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImp3dEludGVyY2VwdG9yUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ0b2tlbkdldHRlciIsInNlc3Npb25TdG9yYWdlIiwiZ2V0SXRlbSIsImludGVyY2VwdG9ycyIsInB1c2giLCJ0aGVtZSIsInByaW1hcnlQYWxldHRlIiwiYWNjZW50UGFsZXR0ZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJkaXJlY3RpdmUiLCJyZXF1aXJlIiwic2NvcGUiLCJvdGhlclZhbCIsImxpbmsiLCJlbGVtIiwiYXR0ciIsIm5nTW9kZWwiLCIkdmFsaWRhdG9ycyIsImlzTWF0Y2giLCJtb2RlbFZhbCIsIiR3YXRjaCIsIiR2YWxpZGF0ZSIsIiRzY29wZSIsImp3dEhlbHBlciIsInVzZXIiLCJnb1RvUGFnZSIsInVybCIsImRlY29kZVRva2VuIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsIiRodHRwIiwiJGxvY2F0aW9uIiwidXNlckxvZ2luIiwibWV0aG9kIiwiZGF0YSIsInRoZW4iLCJyZXMiLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwic2VydmljZSIsInRoaXMiLCJjYWxjUHBnIiwiZGJmZyIsInRvU3RyaW5nIiwic2xpY2UiLCJuZXdJdGVtIiwiUHBnQ2FsYyIsInBwZyIsIm5hbWUiLCJyZWNpcGVGdW5jIiwicmVjaXBldGVtcGxhdGUiLCJyZWNpcGUiLCJjbGVhckN1cnJlbnRSZWNpcGUiLCJzYXZlUmVjaXBlIiwiZWRpdFJlY2lwZSIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsIm1vZGVsIiwiYWRkZWRJbmdyZWRpZW50IiwibmV3R3JhaW4iLCJuZXdIb3AiLCJhZGRlZCIsImRlbGV0ZUl0ZW0iLCJpbmRleCIsInNwbGljZSIsInVzZXJUb2tlbiIsInRvdGFsV2VpZ2h0IiwiaW5ncmVkaWVudHMiLCJ0b3RhbCIsImZvckVhY2giLCJ3ZWlnaHQiLCJwYXJzZUludCIsInRvdGFsUFBHIiwiZ3JhaW5zIiwidm9sdW1lIiwiZ3JhaW4iLCJNYXRoIiwicm91bmQiLCJQUEciLCJlZmZpY2llbmN5UFBHIiwiZWZmaWNpZW5jeSIsImVmZlBQRyIsImxlbmd0aCIsImlidSIsImhvcHMiLCJvZyIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJob3AiLCJBbHBoYV9BY2lkIiwiaG9wVHlwZSIsImJvaWxURmFjdCIsImhvcFRpbWUiLCJ1dGlsIiwiZmciLCJhdHRlbnVhdGlvbiIsInllYXN0Rm9vZCIsInNybSIsInRvdGFsQ29sb3IiLCJtY3UiLCJsb3ZpIiwiYWJ2IiwiZHAiLCJ0b3RhbGRwIiwiZ3JhaW5PYmoiLCJjaGFyYW5kQXBwcyIsImZsYXZvciIsImlkIiwiaG9wT2JqIiwiQmV0YV9BY2lkIiwiTmFtZSIsIk5vdGVzIiwiT3JpZ2luIiwiVHlwZSIsImhvcFRpbWVVbml0Iiwibm90ZXMiLCJyZWNpcGV5ZWFzdCIsInllYXN0IiwiY2FsY3VsYXRlU3RhdHMiLCJodHRwIiwiaXRlbSIsInNhdmVkcmVjaXBlIiwic2VsZWN0ZWRJbmRleCIsImRlbGV0ZVJlY2lwZSIsImNhbGxiYWNrIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsImdldFNhdmVkUmVjaXBlcyIsInJlY2lwZXMiLCJzcm1Ub1JnYkFycmF5IiwicmdiIiwibWluIiwibWF4IiwiUmdiQXJyYXlUb0NTUyIsInJnYmFycmF5IiwicmdiQ1NTIiwicmVnaXN0ZXJVc2VyIiwiX2lkIiwicHBnSXRlbXMiLCJjbGVhckFsbCIsImFkZEdyYWluIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGlCQUFBLGFBQUEsVUFBQSxlQUNBRixLQUFBRyxRQUFBLGlCQUNBLG9CQUNBLHFCQUNBLGdCQUNBLHlCQUNBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FILEVBQUFJLFdBQUEsR0FFQUQsRUFBQUUsWUFBQSxXQUNBLE1BQUFDLGdCQUFBQyxRQUFBLGNBRUFMLEVBQUFNLGFBQUFDLEtBQUEsa0JBRUFSLEVBQUFTLE1BQUEsV0FDQUMsZUFBQSxTQUNBQyxjQUFBLFVBRUFiLEVBQUFjLEtBQUEsS0FDQUMsWUFBQSxzQkFDQUMsV0FBQSxlQUNBRixLQUFBLGNBQ0FDLFlBQUEsdUJBQ0FDLFdBQUEsYUFDQUYsS0FBQSxVQUNBQyxZQUFBLG9CQUNBQyxXQUFBLGlCQUNBRixLQUFBLGFBQ0FDLFlBQUEsdUJBQ0FDLFdBQUEsb0JBQ0FDLFVBQUEsS0FDQUYsWUFBQSxzQkFDQUMsV0FBQSxrQkFHQXBCLElBQUFzQixVQUFBLFVBQUEsV0FDQSxPQUNBQyxRQUFBLFVBQ0FDLE9BQ0FDLFNBQUEsWUFFQUMsS0FBQSxTQUFBRixFQUFBRyxFQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxZQUFBQyxRQUFBLFNBQUFDLEdBQ0EsTUFBQUEsS0FBQVIsRUFBQUMsVUFFQUQsRUFBQVMsT0FBQSxXQUFBLFdBQ0FKLEVBQUFLLGtCQzlDQWxDLElBQUFvQixXQUFBLGlCQUFBLFNBQUEsWUFBQSxTQUFBZSxFQUFBQyxHQUNBRCxFQUFBRSxRQUNBRixFQUFBRyxTQUFBLFNBQUFDLEdBQ0EsTUFBQUEsSUFFQUosRUFBQUYsT0FBQSxXQUNBLE1BQUF0QixnQkFBQUMsUUFBQSxjQUNBLFdBQ0FELGVBQUFDLFFBQUEsY0FDQXVCLEVBQUFFLEtBQUFELEVBQUFJLFlBQUE3QixlQUFBQyxRQUFBLGNBQ0F1QixFQUFBRSxLQUFBSSxNQUFBLFVBQUFOLEVBQUFFLEtBQUFLLFNBQ0FQLEVBQUFFLEtBQUFNLFNBQUEsTUFFQVIsRUFBQUUsUUFDQUYsRUFBQUUsS0FBQUksTUFBQSxpQkFDQU4sRUFBQUUsS0FBQU0sU0FBQSxZQUlBUixFQUFBUyxPQUFBLFdBQ0FqQyxlQUFBa0MsV0FBQSxpQkNuQkE3QyxJQUFBb0IsV0FBQSxnQkFBQSxTQUFBLFFBQUEsWUFBQSxTQUFBZSxFQUFBVyxFQUFBQyxHQUNBWixFQUFBYSxVQUFBLFdBQ0FGLEdBQ0FHLE9BQUEsT0FDQUMsS0FBQWYsRUFBQUUsS0FDQUUsSUFBQSxlQUNBWSxLQUFBLFNBQUFDLEdBQ0FBLEVBQUFGLEtBQUFHLFFBQ0ExQyxlQUFBMkMsUUFBQSxZQUFBRixFQUFBRixLQUFBRyxPQUNBbEIsRUFBQUUsUUFDQVUsRUFBQVIsSUFBQSxPQUVBLFNBQUFhLEdBQ0FqQixFQUFBb0IsTUFBQUgsRUFBQUYsS0FDQWYsRUFBQUUsS0FBQW1CLFNBQUEsU0NmQXhELElBQUF5RCxRQUFBLFVBQUEsV0FDQUMsS0FBQUMsUUFBQSxTQUFBQyxHQU1BLE1BTEEsZ0JBQUFBLEtBQ0FBLEVBQUEsR0FFQUEsRUFBQSxLQUFBLEVBQUFBLEVBQUEsSUFBQSxRQUFBLElBQ0FBLEVBQUFBLEVBQUFDLFdBQUFDLE1BQUEsRUFBQSxJQUdBSixLQUFBSyxRQUFBLFNBQUFBLEVBQUFDLEdBQ0FOLEtBQUFPLElBQUFELEVBQUFMLFFBQUFJLEVBQUFILE1BQ0FGLEtBQUFFLEtBQUFHLEVBQUFILEtBQ0FGLEtBQUFRLEtBQUFILEVBQUFHLFFDWkFsRSxJQUFBb0IsV0FBQSxjQUFBLFNBQUEsUUFBQSxZQUFBLGFBQUEsU0FBQWUsRUFBQVcsRUFBQVYsRUFBQStCLEdBQ0FoQyxFQUFBRSxRQUNBRixFQUFBRSxLQUFBK0IsZUFBQSwwQkFHQUQsRUFBQXZELFFBQUFrQyxFQUFBWCxFQUFBLFVBQ0FnQyxFQUFBdkQsUUFBQWtDLEVBQUFYLEVBQUEsUUFDQWdDLEVBQUF2RCxRQUFBa0MsRUFBQVgsRUFBQSxVQUdBQSxFQUFBa0MsT0FBQSxHQUFBRixHQUFBRSxPQUFBbEMsRUFBQWdDLEdBR0FoQyxFQUFBbUMsbUJBQUEsV0FBQSxNQUFBLElBQUFILEdBQUFHLG1CQUFBbkMsRUFBQWdDLElBQ0FoQyxFQUFBb0MsV0FBQSxXQUFBLE1BQUFKLEdBQUFJLFdBQUF6QixFQUFBWCxFQUFBZ0MsSUFDQWhDLEVBQUFxQyxXQUFBLFNBQUFILEdBQUEsTUFBQUYsR0FBQUssV0FBQUgsRUFBQWxDLEVBQUFnQyxJQUdBaEMsRUFBQXNDLGNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUFBRCxHQUNBLElBQUEsU0FDQSxHQUFBRSxHQUFBLEdBQUFWLEdBQUFXLFNBQUFKLEVBQ0EsTUFDQSxLQUFBLE9BQ0EsR0FBQUcsR0FBQSxHQUFBVixHQUFBWSxPQUFBTCxFQUNBLE1BQ0EsU0FDQSxPQUVBdkMsRUFBQWtDLE9BQUFNLEdBQUFLLE1BQUFsRSxLQUFBK0QsR0FDQTFDLEVBQUF5QyxPQUdBekMsRUFBQThDLFdBQUEsU0FBQUMsRUFBQVAsR0FDQXhDLEVBQUFrQyxPQUFBTSxHQUFBSyxNQUFBRyxPQUFBRCxFQUFBLElBR0EvQyxFQUFBRixPQUFBLFdBQ0EsTUFBQXRCLGdCQUFBQyxRQUFBLGNBQ0EsV0FDQSxHQUFBRCxlQUFBQyxRQUFBLGFBQUEsQ0FDQSxHQUFBd0UsR0FBQWhELEVBQUFJLFlBQUE3QixlQUFBQyxRQUFBLGFBQ0F1QixHQUFBRSxLQUFBK0MsRUFDQWpELEVBQUFFLEtBQUErQixlQUFBLHVDQUVBakMsR0FBQUUsUUFDQUYsRUFBQUUsS0FBQStCLGVBQUEsK0JDOUNBcEUsSUFBQXlELFFBQUEsYUFBQSxXQUVBQyxLQUFBMkIsWUFBQSxTQUFBQyxHQUNBLEdBQUFDLEdBQUEsQ0FNQSxPQUxBRCxHQUFBRSxRQUFBLFNBQUFkLEdBQ0FBLEVBQUFlLE9BQUEsSUFDQUYsR0FBQUcsU0FBQWhCLEVBQUFlLFdBR0FGLEdBR0E3QixLQUFBaUMsU0FBQSxTQUFBQyxFQUFBQyxHQUNBLEdBQUFOLEdBQUEsQ0FJQSxPQUhBSyxHQUFBSixRQUFBLFNBQUFNLEVBQUFaLEdBQ0FLLEdBQUFRLEtBQUFDLE1BQUEsS0FBQUYsRUFBQUcsSUFBQSxHQUFBSCxFQUFBTCxPQUFBSSxHQUFBLE1BRUFOLEdBR0E3QixLQUFBd0MsY0FBQSxTQUFBUCxFQUFBUSxHQUNBLEdBQUEsSUFBQVIsRUFDQSxNQUFBLEVBRUEsSUFBQVMsR0FBQUwsS0FBQUMsTUFBQUwsR0FBQVEsRUFBQSxLQUFBLEtBQUEsSUFBQSxDQU9BLE9BTkFDLEdBQUEsTUFDQUEsRUFBQSxLQUVBQSxFQUFBdkMsV0FBQXdDLE9BQUEsSUFDQUQsRUFBQUEsRUFBQXZDLFdBQUFDLE1BQUEsRUFBQSxJQUVBc0MsR0FJQTFDLEtBQUE0QyxJQUFBLFNBQUFDLEVBQUFYLEVBQUFDLEVBQUFXLEdBQ0EsR0FBQUQsRUFBQUYsT0FBQSxHQUFBVCxFQUFBUyxPQUFBLEVBQUEsQ0FDQSxHQUFBQyxHQUFBLEVBQ0FHLEVBQUEsRUFDQUMsRUFBQSxLQUFBWCxLQUFBWSxJQUFBLE9BQUFILEVBQUEsRUFZQSxPQVhBRCxHQUFBZixRQUFBLFNBQUFvQixHQUVBLEdBREFILEVBQUFHLEVBQUFuQixRQUFBbUIsRUFBQUMsV0FBQSxLQUFBLEtBQUFoQixFQUNBLFFBQUFlLEVBQUFFLFFBQUEsQ0FDQSxHQUFBQyxJQUFBLEVBQUFoQixLQUFBWSxJQUFBLG1CQUFBLElBQUFDLEVBQUFJLFVBQUEsSUFDQUMsRUFBQVAsRUFBQUssQ0FDQVQsSUFBQVcsRUFBQVIsTUFDQSxJQUFBLGFBQUFHLEVBQUFFLFFBQUEsQ0FDQSxHQUFBRyxHQUFBLEVBQ0FYLElBQUFXLEVBQUFSLEtBR0FWLEtBQUFDLE1BQUEsSUFBQU0sR0FBQSxJQUVBLE1BQUEsSUFHQTVDLEtBQUF3RCxHQUFBLFNBQUF0QixFQUFBWSxFQUFBVyxHQUNBLEdBQUFYLEVBQUEsRUFBQSxDQUNBLEdBQUFZLEdBQUFyQixLQUFBQyxNQUFBLEtBQUFRLEVBQUEsSUFBQVcsRUFBQSxNQUFBLEdBS0EsT0FKQUMsR0FBQVosRUFBQVksRUFDQUEsRUFBQXZELFdBQUF3QyxPQUFBLElBQ0FlLEVBQUFBLEVBQUF2RCxXQUFBQyxNQUFBLEVBQUEsSUFFQXNELEVBRUEsTUFBQSxJQUlBMUQsS0FBQTJELElBQUEsU0FBQXpCLEVBQUFDLEdBQ0EsR0FBQUQsRUFBQVMsT0FBQSxFQUFBLENBQ0EsR0FBQWlCLEdBQUEsRUFDQUMsRUFBQTNCLEVBQUFKLFFBQUEsU0FBQU0sRUFBQVosR0FDQW9DLEdBQUF4QixFQUFBMEIsS0FBQTFCLEVBQUFMLFFBT0EsT0FMQThCLEdBQUFELEVBQUF6QixFQUNBMEIsRUFBQXhCLEtBQUFDLE1BQUEsT0FBQUQsS0FBQVksSUFBQVksRUFBQSxPQUFBLEtBQUEsSUFDQUEsRUFBQSxLQUNBQSxFQUFBLElBRUFBLEVBRUEsTUFBQSxJQUlBN0QsS0FBQStELElBQUEsU0FBQTdCLEVBQUFZLEVBQUFVLEdBQ0EsTUFBQXRCLEdBQUFTLE9BQUEsRUFDQU4sS0FBQUMsTUFBQSxPQUFBUSxFQUFBVSxJQUFBLE1BQUFWLElBQUFVLEVBQUEsTUFBQSxLQUFBLElBRUEsR0FJQXhELEtBQUFnRSxHQUFBLFNBQUE5QixFQUFBUCxHQUNBLEdBQUFPLEVBQUFTLE9BQUEsRUFBQSxDQUNBLEdBQUFzQixHQUFBLENBSUEsT0FIQS9CLEdBQUFKLFFBQUEsU0FBQU0sRUFBQVosR0FDQXlDLEdBQUE3QixFQUFBNEIsR0FBQTVCLEVBQUFMLFNBRUFNLEtBQUFDLE1BQUEyQixFQUFBdEMsR0FFQSxNQUFBLElBSUEzQixLQUFBb0IsU0FBQSxTQUFBOEMsR0FDQWxFLEtBQUF1QyxJQUFBMkIsRUFBQTNCLElBQ0F2QyxLQUFBbUUsWUFBQUQsRUFBQUMsWUFDQW5FLEtBQUFnRSxHQUFBRSxFQUFBRixHQUNBaEUsS0FBQW9FLE9BQUFGLEVBQUFFLE9BQ0FwRSxLQUFBcUUsR0FBQUgsRUFBQUcsR0FDQXJFLEtBQUE4RCxLQUFBSSxFQUFBSixLQUNBOUQsS0FBQVEsS0FBQTBELEVBQUExRCxLQUNBUixLQUFBK0IsT0FBQW1DLEVBQUFuQyxRQUdBL0IsS0FBQXFCLE9BQUEsU0FBQWlELEdBQ0F0RSxLQUFBbUQsV0FBQW1CLEVBQUFuQixXQUNBbkQsS0FBQXVFLFVBQUFELEVBQUFDLFVBQ0F2RSxLQUFBd0UsS0FBQUYsRUFBQUUsS0FDQXhFLEtBQUF5RSxNQUFBSCxFQUFBRyxNQUNBekUsS0FBQTBFLE9BQUFKLEVBQUFJLE9BQ0ExRSxLQUFBMkUsS0FBQUwsRUFBQUssS0FDQTNFLEtBQUFzRCxRQUFBZ0IsRUFBQWhCLFFBQ0F0RCxLQUFBb0QsUUFBQWtCLEVBQUFsQixRQUNBcEQsS0FBQTRFLFlBQUFOLEVBQUFNLFlBQ0E1RSxLQUFBK0IsT0FBQXVDLEVBQUF2QyxRQUdBL0IsS0FBQVcsT0FBQSxTQUFBN0MsRUFBQTJDLEdBQ0FULEtBQUF5QyxXQUFBLEdBQ0F6QyxLQUFBeUQsWUFBQSxHQUNBekQsS0FBQW1DLE9BQUEsRUFDQW5DLEtBQUFrQyxRQUNBWixVQUVBdEIsS0FBQTZDLE1BQ0F2QixTQUNBc0IsSUFBQSxXQUNBLE1BQUFuQyxHQUFBbUMsSUFBQTlFLEVBQUE2QyxPQUFBa0MsS0FBQXZCLE1BQUF4RCxFQUFBNkMsT0FBQXVCLE9BQUFaLE1BQUF4RCxFQUFBNkMsT0FBQXdCLE9BQUFyRSxFQUFBNkMsT0FBQW1DLFFBR0E5QyxLQUFBOEMsR0FBQSxXQUNBLE1BQUFyQyxHQUFBK0IsY0FBQS9CLEVBQUF3QixTQUFBbkUsRUFBQTZDLE9BQUF1QixPQUFBWixNQUFBeEQsRUFBQTZDLE9BQUF3QixRQUFBckUsRUFBQTZDLE9BQUE4QixhQUVBekMsS0FBQXdELEdBQUEsV0FDQSxNQUFBL0MsR0FBQStDLEdBQUExRixFQUFBNkMsT0FBQXVCLE9BQUFaLE1BQUF4RCxFQUFBNkMsT0FBQW1DLEtBQUFoRixFQUFBNkMsT0FBQThDLGNBRUF6RCxLQUFBK0QsSUFBQSxXQUNBLE1BQUF0RCxHQUFBc0QsSUFBQWpHLEVBQUE2QyxPQUFBdUIsT0FBQVosTUFBQXhELEVBQUE2QyxPQUFBbUMsS0FBQWhGLEVBQUE2QyxPQUFBNkMsT0FFQXhELEtBQUEyRCxJQUFBLFdBQ0EsTUFBQWxELEdBQUFrRCxJQUFBN0YsRUFBQTZDLE9BQUF1QixPQUFBWixNQUFBeEQsRUFBQTZDLE9BQUF3QixTQUVBbkMsS0FBQWdFLEdBQUEsV0FDQSxNQUFBdkQsR0FBQXVELEdBQUFsRyxFQUFBNkMsT0FBQXVCLE9BQUFaLE1BQUFiLEVBQUFrQixZQUFBN0QsRUFBQTZDLE9BQUF1QixPQUFBWixTQUVBdEIsS0FBQTZFLE1BQUEsR0FDQTdFLEtBQUE4RSxZQUFBaEgsRUFBQWlILE9BR0EvRSxLQUFBZ0YsZUFBQSxTQUFBckUsRUFBQUYsR0FPQSxNQU5BRSxHQUFBbUMsR0FBQXJDLEVBQUErQixjQUFBL0IsRUFBQXdCLFNBQUF0QixFQUFBdUIsT0FBQVosTUFBQVgsRUFBQXdCLFFBQUF4QixFQUFBOEIsWUFDQTlCLEVBQUE2QyxHQUFBL0MsRUFBQStDLEdBQUE3QyxFQUFBdUIsT0FBQVosTUFBQVgsRUFBQW1DLEdBQUFuQyxFQUFBOEMsYUFDQTlDLEVBQUFvRCxJQUFBdEQsRUFBQXNELElBQUFwRCxFQUFBdUIsT0FBQVosTUFBQVgsRUFBQW1DLEdBQUFuQyxFQUFBNkMsSUFDQTdDLEVBQUFnRCxJQUFBbEQsRUFBQWtELElBQUFoRCxFQUFBdUIsT0FBQVosTUFBQVgsRUFBQXdCLFFBQ0F4QixFQUFBcUQsR0FBQXZELEVBQUF1RCxHQUFBckQsRUFBQXVCLE9BQUFaLE1BQUFiLEVBQUFrQixZQUFBaEIsRUFBQXVCLE9BQUFaLFFBQ0FYLEVBQUFrQyxLQUFBRCxJQUFBbkMsRUFBQW1DLElBQUFqQyxFQUFBa0MsS0FBQXZCLE1BQUFYLEVBQUF1QixPQUFBWixNQUFBWCxFQUFBd0IsT0FBQXhCLEVBQUFtQyxJQUNBbkMsR0FHQVgsS0FBQTlDLFFBQUEsU0FBQStILEVBQUFuSCxFQUFBb0gsR0FDQUQsR0FDQTFGLE9BQUEsTUFDQVYsSUFBQSxJQUFBcUcsSUFDQXpGLEtBQUEsU0FBQUMsR0FDQTVCLEVBQUFvSCxHQUFBeEYsRUFBQUYsUUFJQVEsS0FBQWEsV0FBQSxTQUFBb0UsRUFBQW5ILEVBQUEyQyxHQUNBLEdBQUFFLElBQ0EzQixTQUFBbEIsRUFBQWEsS0FBQUssU0FDQXdCLEtBQUExQyxFQUFBNkMsT0FBQUgsS0FDQTBCLFFBQ0FaLE1BQUF4RCxFQUFBNkMsT0FBQXVCLE9BQUFaLE9BRUFtQixXQUFBM0UsRUFBQTZDLE9BQUE4QixXQUNBTixPQUFBckUsRUFBQTZDLE9BQUF3QixPQUNBc0IsWUFBQTNGLEVBQUE2QyxPQUFBOEMsWUFDQVosTUFDQXZCLE1BQUF4RCxFQUFBNkMsT0FBQWtDLEtBQUF2QixPQUVBdUQsTUFBQS9HLEVBQUErRyxNQUNBRSxNQUFBakgsRUFBQWlILE1BRUFFLElBQ0ExRixPQUFBLE9BQ0FWLElBQUEsbUJBQ0FXLEtBQUFtQixJQUNBbEIsS0FBQSxTQUFBQyxHQUNBNUIsRUFBQTZDLE9BQUEsR0FBQUYsR0FBQUUsT0FBQTdDLEVBQUEyQyxHQUNBM0MsRUFBQStHLE1BQUEsR0FDQS9HLEVBQUFpSCxZQUlBL0UsS0FBQVksbUJBQUEsU0FBQTlDLEVBQUEyQyxHQUNBM0MsRUFBQTZDLE9BQUEsR0FBQUYsR0FBQUUsT0FBQTdDLEVBQUEyQyxHQUNBM0MsRUFBQStHLE1BQUEsR0FDQS9HLEVBQUFpSCxVQUdBL0UsS0FBQWMsV0FBQSxTQUFBcUUsRUFBQXJILEVBQUEyQyxHQUNBM0MsRUFBQTZDLE9BQUFILEtBQUEyRSxFQUFBM0UsS0FDQTFDLEVBQUE2QyxPQUFBOEIsV0FBQTBDLEVBQUExQyxXQUNBM0UsRUFBQTZDLE9BQUE4QyxZQUFBMEIsRUFBQTFCLFlBQ0EzRixFQUFBNkMsT0FBQXdCLE9BQUFnRCxFQUFBaEQsT0FDQXJFLEVBQUE2QyxPQUFBdUIsT0FBQVosTUFBQTZELEVBQUFqRCxPQUFBWixNQUNBeEQsRUFBQTZDLE9BQUFrQyxLQUFBdkIsTUFBQTZELEVBQUF0QyxLQUFBdkIsTUFDQXhELEVBQUErRyxNQUFBTSxFQUFBTixNQUNBL0csRUFBQWlILE1BQUFJLEVBQUFKLE1BQ0FqSCxFQUFBc0gsY0FBQSxHQUdBcEYsS0FBQXFGLGFBQUEsU0FBQWhCLEVBQUFZLEVBQUFLLEdBQ0FMLEdBQ0ExRixPQUFBLFNBQ0FDLE1BQUE2RSxHQUFBQSxHQUNBeEYsSUFBQSwyQkFDQTBHLFNBQUFDLGVBQUEsb0NBQ0EvRixLQUFBLFNBQUFDLEdBQ0E0RixFQUFBNUYsTUFLQU0sS0FBQXlGLGdCQUFBLFNBQUEzSCxFQUFBbUgsRUFBQXhFLEdBQ0F3RSxHQUNBMUYsT0FBQSxPQUNBVixJQUFBLDJCQUNBWSxLQUFBLFNBQUFDLEdBQ0E1QixFQUFBNEgsUUFBQWhHLEVBQUFGLEtBQ0ExQixFQUFBNEgsUUFBQTVELFFBQUEsU0FBQW5CLEVBQUFhLEdBQ0ExRCxFQUFBNEgsUUFBQWxFLEdBQUFmLEVBQUF1RSxlQUFBckUsRUFBQUYsUUFJQVQsS0FBQTJGLGNBQUEsU0FBQWhDLEdBQ0EsR0FBQSxFQUFBQSxHQUFBLGdCQUFBQSxHQUNBLE9BQUEsSUFBQSxJQUFBLEVBRUEsSUFBQWlDLEtBSUEsT0FIQUEsR0FBQXhJLEtBQUFpRixLQUFBQyxNQUFBRCxLQUFBd0QsSUFBQSxJQUFBeEQsS0FBQXlELElBQUEsRUFBQSxJQUFBekQsS0FBQVksSUFBQSxLQUFBVSxPQUNBaUMsRUFBQXhJLEtBQUFpRixLQUFBQyxNQUFBRCxLQUFBd0QsSUFBQSxJQUFBeEQsS0FBQXlELElBQUEsRUFBQSxJQUFBekQsS0FBQVksSUFBQSxJQUFBVSxPQUNBaUMsRUFBQXhJLEtBQUFpRixLQUFBQyxNQUFBRCxLQUFBd0QsSUFBQSxJQUFBeEQsS0FBQXlELElBQUEsRUFBQSxJQUFBekQsS0FBQVksSUFBQSxHQUFBVSxPQUNBaUMsR0FHQTVGLEtBQUErRixjQUFBLFNBQUFDLEdBQ0EsR0FBQSxnQkFBQUEsR0FDQSxHQUFBQyxHQUFBLHdCQUVBLElBQUFBLEdBQUEsT0FBQUQsRUFBQSxHQUFBLEtBQUFBLEVBQUEsR0FBQSxLQUFBQSxFQUFBLEdBQUEsSUFFQSxPQUFBQyxNQ3pRQTNKLElBQUFvQixXQUFBLG1CQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFlLEVBQUFXLEVBQUFDLEdBQ0FaLEVBQUF5SCxhQUFBLFdBQ0E5RyxHQUNBRyxPQUFBLE9BQ0FDLEtBQUFmLEVBQUFFLEtBQ0FFLElBQUEsY0FDQVksS0FBQSxTQUFBQyxHQUNBakIsRUFBQUUsS0FBQWUsRUFBQUYsS0FDQUgsRUFBQVIsSUFBQSxXQUNBLFNBQUFhLEdBQ0FqQixFQUFBRSxLQUFBZSxFQUFBRixXQ1hBbEQsSUFBQW9CLFdBQUEsZ0JBQUEsU0FBQSxRQUFBLGFBQUEsU0FBQWUsRUFBQVcsRUFBQXFCLEdBQ0FoQyxFQUFBNEcsYUFBQSxTQUFBMUUsR0FDQUYsRUFBQTRFLGFBQUExRSxFQUFBd0YsSUFBQS9HLEVBQUEsU0FBQU0sR0FDQWpCLEVBQUFnSCxxQkFHQWhILEVBQUFnSCxnQkFBQSxXQUFBLE1BQUFoRixHQUFBZ0YsZ0JBQUFoSCxFQUFBVyxFQUFBcUIsT0FFQW5FLElBQUFvQixXQUFBLFlBQUEsU0FBQSxVQUFBLFNBQUFlLEVBQUE2QixHQUNBN0IsRUFBQTJILFlBQ0EzSCxFQUFBNEgsU0FBQSxXQUNBNUgsRUFBQTJILGFBRUEzSCxFQUFBNkgsU0FBQSxXQUNBN0gsRUFBQTJILFNBQUFoSixLQUFBLEdBQUFrRCxHQUFBRCxRQUFBNUIsRUFBQTRCLFFBQUFDLElBQ0E3QixFQUFBNEIiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdyZWNpcGVDcmVhdG9yJywgWyduZ01hdGVyaWFsJywgJ25nUm91dGUnLCAnYW5ndWxhci1qd3QnXSk7XG4gIGFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsXG4gICAgICAgICAgICAgICckbG9jYXRpb25Qcm92aWRlcicsXG4gICAgICAgICAgICAgICckbWRUaGVtaW5nUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGh0dHBQcm92aWRlcicsXG4gICAgICAgICAgICAgICdqd3RJbnRlcmNlcHRvclByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIsICRodHRwUHJvdmlkZXIsIGp3dEludGVyY2VwdG9yUHJvdmlkZXIpe1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgIGp3dEludGVyY2VwdG9yUHJvdmlkZXIudG9rZW5HZXR0ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH1cbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdqd3RJbnRlcmNlcHRvcicpO1xuXG4gICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnYW1iZXInKVxuICAgICAgLmFjY2VudFBhbGV0dGUoJ3llbGxvdycpO1xuXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KS53aGVuKCcvZGJzZ19jYWxjJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvZGJzZ2NhbGMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnZGJzZ0NhbGMnXG4gICAgfSkud2hlbignL2xvZ2luJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sJ1xuICAgIH0pLndoZW4oJy9yZWdpc3RlcicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOicvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVnaXN0ZXJDb250cm9sJ1xuICAgIH0pLm90aGVyd2lzZSgnLycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlY2lwZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAncmVjaXBlTWFrZSdcbiAgICB9KTtcbiAgfV0pO1xuICBhcHAuZGlyZWN0aXZlKCdpc01hdGNoJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgc2NvcGU6IHtcbiAgICAgICAgb3RoZXJWYWw6IFwiPWlzTWF0Y2hcIlxuICAgICAgfSxcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtLCBhdHRyLCBuZ01vZGVsKSB7XG4gICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuaXNNYXRjaCA9IGZ1bmN0aW9uKG1vZGVsVmFsKSB7XG4gICAgICAgICAgcmV0dXJuIG1vZGVsVmFsID09PSBzY29wZS5vdGhlclZhbDtcbiAgICAgICAgfTtcbiAgICAgICAgc2NvcGUuJHdhdGNoKCdvdGhlclZhbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG4iLCJhcHAuY29udHJvbGxlcignaGVhZGVyQ29udHJvbCcsIFsnJHNjb3BlJywgJ2p3dEhlbHBlcicsIGZ1bmN0aW9uKCRzY29wZSwgand0SGVscGVyKXtcbiAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgJHNjb3BlLmdvVG9QYWdlID0gZnVuY3Rpb24odXJsKSB7XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICB9LCBmdW5jdGlvbigpe1xuICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKXtcbiAgICAgICRzY29wZS51c2VyID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ291dCAnICsgJHNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvJztcbiAgICB9IGVsc2Uge1xuICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ2luL1JlZ2lzdGVyJztcbiAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy9sb2dpbidcbiAgICB9XG4gIH0pO1xuXG4gICRzY29wZS5sb2dPdXQgPSBmdW5jdGlvbigpIHtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyVG9rZW4nKTtcbiAgfTtcbn1dKTtcbiIsIi8vY29udHJvbGxlciBmb3IgbG9naW4gc2NyZWVuIC0gc2VuZHMgdXNlci9wYXNzIGFuZCBzdG9yZXMgand0XG5hcHAuY29udHJvbGxlcignbG9naW5Db250cm9sJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgJHNjb3BlLnVzZXJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICRodHRwKHtcbiAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICB1cmw6ICcvbG9naW5hdXRoJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgIGlmKHJlcy5kYXRhLnRva2VuKXtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlclRva2VuJywgcmVzLmRhdGEudG9rZW4pO1xuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XG4gICAgICB9O1xuICAgIH0sIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAkc2NvcGUuZXJyb3IgPSByZXMuZGF0YTtcbiAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gJyc7XG4gICAgfSk7XG4gIH1cbn1dKTtcbiIsImFwcC5zZXJ2aWNlKCdQcGdDYWxjJywgZnVuY3Rpb24gKCl7XG4gIHRoaXMuY2FsY1BwZyA9IGZ1bmN0aW9uKGRiZmcpIHtcbiAgICBpZih0eXBlb2YgZGJmZyAhPT0gJ251bWJlcicpe1xuICAgICAgZGJmZyA9IDA7XG4gICAgfVxuICAgIGRiZmcgPSAoMTAwMCAqICgxICsgKGRiZmcgLyAxMDApICogMC4wNDYyMSkpIC8gMTAwMFxuICAgIGRiZmcgPSBkYmZnLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgcmV0dXJuIGRiZmc7XG4gIH07XG4gIHRoaXMubmV3SXRlbSA9IGZ1bmN0aW9uIChuZXdJdGVtLCBQcGdDYWxjKSB7XG4gICAgdGhpcy5wcGcgPSBQcGdDYWxjLmNhbGNQcGcobmV3SXRlbS5kYmZnKTtcbiAgICB0aGlzLmRiZmcgPSBuZXdJdGVtLmRiZmc7XG4gICAgdGhpcy5uYW1lID0gbmV3SXRlbS5uYW1lO1xuICB9XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdyZWNpcGVNYWtlJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnand0SGVscGVyJywgJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBqd3RIZWxwZXIsIHJlY2lwZUZ1bmMpe1xuICAkc2NvcGUudXNlciA9IHt9O1xuICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCc7XG5cbiAgLy9nZXQgYWxsIGl0ZW1zIGxpc3RlZCBpbiB0aGUgc2VsZWN0IG1lbnVcbiAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICdncmFpbnMnKTtcbiAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICdob3BzJyk7XG4gIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAneWVhc3RzJyk7XG5cbiAgLy9UaGUgb2JqZWN0IHVzZWQgZm9yIHJlY2lwZSBjcmVhdGlvbiBhcyB3ZWxsIGFzIGNhbGN1bGF0aW9uc1xuICAkc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKCRzY29wZSwgcmVjaXBlRnVuYyk7XG5cbiAgLy9TYXZlL2NsZWFyL2VkaXQgZnVuY3Rpb24gZm9yIGJ1dHRvbiBuZy1jbGlja1xuICAkc2NvcGUuY2xlYXJDdXJyZW50UmVjaXBlID0gZnVuY3Rpb24oKXsgcmV0dXJuIG5ldyByZWNpcGVGdW5jLmNsZWFyQ3VycmVudFJlY2lwZSgkc2NvcGUsIHJlY2lwZUZ1bmMpIH07XG4gICRzY29wZS5zYXZlUmVjaXBlID0gZnVuY3Rpb24oKXsgcmV0dXJuIHJlY2lwZUZ1bmMuc2F2ZVJlY2lwZSgkaHR0cCwgJHNjb3BlLCByZWNpcGVGdW5jKSB9O1xuICAkc2NvcGUuZWRpdFJlY2lwZSA9IGZ1bmN0aW9uKHJlY2lwZSkgeyByZXR1cm4gcmVjaXBlRnVuYy5lZGl0UmVjaXBlKHJlY2lwZSwgJHNjb3BlLCByZWNpcGVGdW5jKSB9XG5cbiAgLy9nZW5lcmljIGZ1bmN0aW9uIHRvIGFkZCBhbiBpdGVtIHRvIHRoZSBhcnJheSBmb3IgdGhvc2UgaW5ncmVkaWVudHNcbiAgJHNjb3BlLmFkZEluZ3JlZGllbnQgPSBmdW5jdGlvbihpbmdyZWRpZW50LCB0eXBlLCBtb2RlbCl7XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgJ2dyYWlucyc6XG4gICAgICAgIHZhciBhZGRlZEluZ3JlZGllbnQgPSBuZXcgcmVjaXBlRnVuYy5uZXdHcmFpbihpbmdyZWRpZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdob3BzJzpcbiAgICAgICAgdmFyIGFkZGVkSW5ncmVkaWVudCA9IG5ldyByZWNpcGVGdW5jLm5ld0hvcChpbmdyZWRpZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICAkc2NvcGUucmVjaXBlW3R5cGVdLmFkZGVkLnB1c2goYWRkZWRJbmdyZWRpZW50KTtcbiAgICAkc2NvcGVbbW9kZWxdID0ge307XG4gIH1cbiAgLy9yZW1vdmUgYnV0dG9uIGZ1bmN0aW9uIC0gcmVtb3ZlcyBvbmUgaXRlbSBmcm9tIHRoZSBhcnJheVxuICAkc2NvcGUuZGVsZXRlSXRlbSA9IGZ1bmN0aW9uKGluZGV4LCB0eXBlKSB7XG4gICAgJHNjb3BlLnJlY2lwZVt0eXBlXS5hZGRlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG5cbiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgfSwgZnVuY3Rpb24oKXtcbiAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKSB7XG4gICAgICAgIHZhciB1c2VyVG9rZW4gPSBqd3RIZWxwZXIuZGVjb2RlVG9rZW4oc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICAkc2NvcGUudXNlciA9IHVzZXJUb2tlbjtcbiAgICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ByaXZhdGUvdmlld3Mvc2F2ZWRyZWNpcGVzLmh0bWwnXG4gICAgfSBlbHNlIHtcbiAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCdcbiAgICB9XG4gIH0pO1xuXG59XSk7XG4iLCJhcHAuc2VydmljZSgncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCl7XG4gIC8vaW4gdW5pdCB0ZXN0IHRoaXMgY2FsY3VsYXRlcyB0aGUgd2VpZ2h0IG9mIGFsbCBncmFpbnMgYWRkZWRcbiAgdGhpcy50b3RhbFdlaWdodCA9IGZ1bmN0aW9uKGluZ3JlZGllbnRzKXtcbiAgICB2YXIgdG90YWwgPSAwO1xuICAgIGluZ3JlZGllbnRzLmZvckVhY2goZnVuY3Rpb24oaW5ncmVkaWVudCl7XG4gICAgICBpZihpbmdyZWRpZW50LndlaWdodCA+IDApe1xuICAgICAgICB0b3RhbCArPSBwYXJzZUludChpbmdyZWRpZW50LndlaWdodCk7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSB0aGlzIGNhbGN1bGF0ZXMgdGhlIG1heCBzdWdhciBleHRyYWN0aW9uIHBvc3NpYmxlIGZyb20gdGhlIGdyYWluc1xuICB0aGlzLnRvdGFsUFBHID0gZnVuY3Rpb24oZ3JhaW5zLCB2b2x1bWUpe1xuICAgIHZhciB0b3RhbCA9IDA7XG4gICAgZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KXtcbiAgICAgIHRvdGFsICs9IChNYXRoLnJvdW5kKChncmFpbi5QUEcgLSAxKSAqIDEwMDAgKiBncmFpbi53ZWlnaHQgLyB2b2x1bWUpKSAvIDEwMDA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCB0aGlzIGNhbGN1bGF0ZXMgdGhlIGVzdGltYXRlZCBzdWdhciBleHRyYWN0aW9uIGJhc2VkIG9uIHVzZXIncyBlZmYuIGlucHV0XG4gIHRoaXMuZWZmaWNpZW5jeVBQRyA9IGZ1bmN0aW9uKHRvdGFsUFBHLCBlZmZpY2llbmN5KSB7XG4gICAgaWYodG90YWxQUEcgPT09IDApe1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVmZlBQRyA9IE1hdGgucm91bmQodG90YWxQUEcgKiAoZWZmaWNpZW5jeSAvIDEwMCkgKiAxMDAwKSAvIDEwMDAgKyAxO1xuICAgICAgICBpZihlZmZQUEcgPiAxLjUpIHtcbiAgICAgICAgICBlZmZQUEcgPSAxLjU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZWZmUFBHLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgIGVmZlBQRyA9IGVmZlBQRy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZWZmUFBHO1xuICAgICAgfVxuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNhbGN1bGF0ZXMgaWJ1J3MgZm9yIHVzZXIncyBpbnB1dCBob3BzXG4gIHRoaXMuaWJ1ID0gZnVuY3Rpb24oaG9wcywgZ3JhaW5zLCB2b2x1bWUsIG9nKSB7XG4gICAgaWYoaG9wcy5sZW5ndGggPiAwICYmIGdyYWlucy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgaWJ1ID0gMDtcbiAgICAgIHZhciBhYXUgPSAwO1xuICAgICAgdmFyIGJpZ0ZhY3QgPSAxLjY1ICogTWF0aC5wb3coMC4wMDAxMjUsIChvZyAtIDEpKTtcbiAgICAgIGhvcHMuZm9yRWFjaChmdW5jdGlvbihob3ApIHtcbiAgICAgICAgYWF1ID0gaG9wLndlaWdodCAqIChob3AuQWxwaGFfQWNpZCAvIDEwMCkgKiA3NDkwIC8gdm9sdW1lO1xuICAgICAgICBpZihob3AuaG9wVHlwZSA9PSAnQm9pbCcpIHtcbiAgICAgICAgICB2YXIgYm9pbFRGYWN0ID0gKCgxIC0gTWF0aC5wb3coMi43MTgyODE4Mjg0NTkwNDUyMzUzNiwgKC0uMDQgKiBob3AuaG9wVGltZSkpKSAvIDMuOCk7XG4gICAgICAgICAgdmFyIHV0aWwgPSBiaWdGYWN0ICogYm9pbFRGYWN0O1xuICAgICAgICAgIGlidSArPSB1dGlsICogYWF1O1xuICAgICAgICB9IGVsc2UgaWYoaG9wLmhvcFR5cGUgPT0gJ1doaXJscG9vbCcpIHtcbiAgICAgICAgICB2YXIgdXRpbCA9IC4xMDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKGlidSAqIDEwMCkgLyAxMDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIHRoaXMgY2FsY3VsYXRlcyB0aGUgZmluYWwgZ3Jhdml0eSBiYXNlZCBvbiBhdHRlbnVhdGlvblxuICB0aGlzLmZnID0gZnVuY3Rpb24oZ3JhaW5zLCBvZywgYXR0ZW51YXRpb24pe1xuICAgIGlmKG9nID4gMCkge1xuICAgICAgdmFyIHllYXN0Rm9vZCA9IE1hdGgucm91bmQoKChvZyAtIDEpICogMTAwMCkgKiAoYXR0ZW51YXRpb24gLyAxMDApKSAvIDEwMDA7XG4gICAgICB5ZWFzdEZvb2QgPSBvZyAtIHllYXN0Rm9vZDtcbiAgICAgIGlmKHllYXN0Rm9vZC50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgeWVhc3RGb29kID0geWVhc3RGb29kLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICB9XG4gICAgICByZXR1cm4geWVhc3RGb29kO1xuICAgIH0gZWxzZSB7XG4gICAgcmV0dXJuIDBcbiAgICB9XG4gIH07XG4gICAgICAvL2luIHVuaXQgdGVzdCAtIGVzdGltYXRlIGNvbG9yIGJhc2VkIG9uIGdyYWlucyBhZGRlZFxuICB0aGlzLnNybSA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsQ29sb3IgPSAwO1xuICAgICAgdmFyIG1jdSA9IGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICB0b3RhbENvbG9yICs9IChncmFpbi5sb3ZpICogZ3JhaW4ud2VpZ2h0KTtcbiAgICAgIH0pO1xuICAgICAgbWN1ID0gdG90YWxDb2xvciAvIHZvbHVtZTtcbiAgICAgIG1jdSA9IE1hdGgucm91bmQoKDEuNDkyMiAqIChNYXRoLnBvdyhtY3UsIDAuNjg1OSkpKSAqIDEwMCkgLyAxMDA7XG4gICAgICBpZihtY3UgPiA1MCl7XG4gICAgICAgIG1jdSA9IDUwO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtY3U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9O1xuICAgIC8vaW4gdW5pdCB0ZXN0IC0gY2FsYyBhYnYgJVxuICB0aGlzLmFidiA9IGZ1bmN0aW9uKGdyYWlucywgb2csIGZnKXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoKDc2LjA4ICogKG9nLWZnKSAvICgxLjc3NSAtIG9nKSkgKiAoZmcgLyAwLjc5NCkgKiAxMDApIC8gMTAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMFxuICAgIH1cbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjYWxjdWxhdGUgZGlhc3RhdGljIHBvd2VyXG4gIHRoaXMuZHAgPSBmdW5jdGlvbihncmFpbnMsIHRvdGFsV2VpZ2h0KXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsZHAgPSAwO1xuICAgICAgZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgIHRvdGFsZHAgKz0gZ3JhaW4uZHAgKiBncmFpbi53ZWlnaHQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRvdGFsZHAgLyB0b3RhbFdlaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuICAvL2luIHVuaXQgdGVzdCAtIGNvbnN0cnVjdG9yIGZvciBuZXcgZ3JhaW4gaXRlbVxuICB0aGlzLm5ld0dyYWluID0gZnVuY3Rpb24oZ3JhaW5PYmopIHtcbiAgICB0aGlzLlBQRyA9IGdyYWluT2JqLlBQRztcbiAgICB0aGlzLmNoYXJhbmRBcHBzID0gZ3JhaW5PYmouY2hhcmFuZEFwcHM7XG4gICAgdGhpcy5kcCA9IGdyYWluT2JqLmRwO1xuICAgIHRoaXMuZmxhdm9yID0gZ3JhaW5PYmouZmxhdm9yO1xuICAgIHRoaXMuaWQgPSBncmFpbk9iai5pZDtcbiAgICB0aGlzLmxvdmkgPSBncmFpbk9iai5sb3ZpO1xuICAgIHRoaXMubmFtZSA9IGdyYWluT2JqLm5hbWU7XG4gICAgdGhpcy53ZWlnaHQ9IGdyYWluT2JqLndlaWdodDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjb25zdHJ1Y3RvciBmb3IgbmV3IGhvcCBpdGVtXG4gIHRoaXMubmV3SG9wID0gZnVuY3Rpb24oaG9wT2JqKSB7XG4gICAgdGhpcy5BbHBoYV9BY2lkID0gaG9wT2JqLkFscGhhX0FjaWQ7XG4gICAgdGhpcy5CZXRhX0FjaWQgPSBob3BPYmouQmV0YV9BY2lkO1xuICAgIHRoaXMuTmFtZSA9IGhvcE9iai5OYW1lO1xuICAgIHRoaXMuTm90ZXMgPSBob3BPYmouTm90ZXM7XG4gICAgdGhpcy5PcmlnaW4gPSBob3BPYmouT3JpZ2luO1xuICAgIHRoaXMuVHlwZSA9IGhvcE9iai5UeXBlO1xuICAgIHRoaXMuaG9wVGltZSA9IGhvcE9iai5ob3BUaW1lO1xuICAgIHRoaXMuaG9wVHlwZSA9IGhvcE9iai5ob3BUeXBlO1xuICAgIHRoaXMuaG9wVGltZVVuaXQgPSBob3BPYmouaG9wVGltZVVuaXQ7XG4gICAgdGhpcy53ZWlnaHQgPSBob3BPYmoud2VpZ2h0O1xuICB9O1xuICAvL2luIHVuaXQgdGVzdCAtIGNvbnN0cnVjdG9yIGZvciBhIGJsYW5rIHJlY2lwZVxuICB0aGlzLnJlY2lwZSA9IGZ1bmN0aW9uKHNjb3BlLCByZWNpcGVGdW5jKSB7XG4gICAgdGhpcy5lZmZpY2llbmN5ID0gNjU7XG4gICAgdGhpcy5hdHRlbnVhdGlvbiA9IDc1O1xuICAgIHRoaXMudm9sdW1lID0gNTtcbiAgICB0aGlzLmdyYWlucyA9IHtcbiAgICAgIGFkZGVkOiBbXVxuICAgIH07XG4gICAgdGhpcy5ob3BzID0ge1xuICAgICAgYWRkZWQ6IFtdLFxuICAgICAgaWJ1OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5pYnUoc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQsIHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUsIHNjb3BlLnJlY2lwZS5vZygpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMub2cgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUpLCBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSlcbiAgICB9O1xuICAgIHRoaXMuZmcgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZmcoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLm9nKCksIHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbilcbiAgICB9O1xuICAgIHRoaXMuYWJ2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmFidihzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUub2coKSwgc2NvcGUucmVjaXBlLmZnKCkpO1xuICAgICAgfTtcbiAgICB0aGlzLnNybSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5zcm0oc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSk7XG4gICAgICB9O1xuICAgIHRoaXMuZHAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZHAoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgICB9O1xuICAgIHRoaXMubm90ZXMgPSAnJztcbiAgICB0aGlzLnJlY2lwZXllYXN0ID0gIHNjb3BlLnllYXN0O1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSB0aGlzIGNhbGN1bGF0ZXMgc3RhdHMgZm9yIGVhY2ggc2F2ZWQgcmVjaXBlXG4gIHRoaXMuY2FsY3VsYXRlU3RhdHMgPSBmdW5jdGlvbihyZWNpcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICByZWNpcGUub2cgPSByZWNpcGVGdW5jLmVmZmljaWVuY3lQUEcocmVjaXBlRnVuYy50b3RhbFBQRyhyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUudm9sdW1lKSwgcmVjaXBlLmVmZmljaWVuY3kpO1xuICAgIHJlY2lwZS5mZyA9IHJlY2lwZUZ1bmMuZmcocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLm9nLCByZWNpcGUuYXR0ZW51YXRpb24pO1xuICAgIHJlY2lwZS5hYnYgPSByZWNpcGVGdW5jLmFidihyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUub2csIHJlY2lwZS5mZyk7XG4gICAgcmVjaXBlLnNybSA9IHJlY2lwZUZ1bmMuc3JtKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUpO1xuICAgIHJlY2lwZS5kcCA9IHJlY2lwZUZ1bmMuZHAocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChyZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgcmVjaXBlLmhvcHMuaWJ1ID0gcmVjaXBlRnVuYy5pYnUocmVjaXBlLmhvcHMuYWRkZWQsIHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUsIHJlY2lwZS5vZyk7XG4gICAgcmV0dXJuIHJlY2lwZTtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0cyAtIHRoaXMgZ2V0cyBhbiBpdGVtIGZyb20gdGhlIHNxbGl0ZSBkYlxuICB0aGlzLmdldEl0ZW0gPSBmdW5jdGlvbihodHRwLCBzY29wZSwgaXRlbSkge1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHVybDogJy8nICsgaXRlbVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICBzY29wZVtpdGVtXSA9IHJlcy5kYXRhO1xuICAgIH0pO1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSBzYXZlcyByZWNpcGUgdG8gZGF0YWJhc2Ugd2l0aCBhIHRpZSB0byB0aGUgdXNlclxuICB0aGlzLnNhdmVSZWNpcGUgPSBmdW5jdGlvbihodHRwLCBzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHZhciByZWNpcGUgPSB7XG4gICAgICB1c2VybmFtZTogc2NvcGUudXNlci51c2VybmFtZSxcbiAgICAgIG5hbWU6IHNjb3BlLnJlY2lwZS5uYW1lLFxuICAgICAgZ3JhaW5zOiB7XG4gICAgICAgIGFkZGVkOiBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkXG4gICAgICB9LFxuICAgICAgZWZmaWNpZW5jeTogc2NvcGUucmVjaXBlLmVmZmljaWVuY3ksXG4gICAgICB2b2x1bWU6IHNjb3BlLnJlY2lwZS52b2x1bWUsXG4gICAgICBhdHRlbnVhdGlvbjogc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uLFxuICAgICAgaG9wczoge1xuICAgICAgICBhZGRlZDogc2NvcGUucmVjaXBlLmhvcHMuYWRkZWRcbiAgICAgIH0sXG4gICAgICBub3Rlczogc2NvcGUubm90ZXMsXG4gICAgICB5ZWFzdDogc2NvcGUueWVhc3RcbiAgICB9O1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzJyxcbiAgICAgIGRhdGE6IHJlY2lwZVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgIHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZShzY29wZSwgcmVjaXBlRnVuYyk7XG4gICAgICBzY29wZS5ub3RlcyA9ICcnO1xuICAgICAgc2NvcGUueWVhc3QgPSB7fTtcbiAgICB9KVxuICB9O1xuLy9pbiB1bml0IHRlc3QgLSByZXNldCBzY29wZS5yZWNpcGUgdmFsdWVzXG4gIHRoaXMuY2xlYXJDdXJyZW50UmVjaXBlID0gZnVuY3Rpb24oc2NvcGUsIHJlY2lwZUZ1bmMpe1xuICAgIHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZShzY29wZSwgcmVjaXBlRnVuYyk7XG4gICAgc2NvcGUubm90ZXMgPSAnJztcbiAgICBzY29wZS55ZWFzdCA9IHt9O1xuICB9O1xuLy9pbiB1bml0IHRlc3QgLSByZXBsYWNlIHNjb3BlLnJlY2lwZSB3aXRoIGEgc2VsZWN0ZWQgcmVjaXBlJ3MgdmFsdWVzXG4gIHRoaXMuZWRpdFJlY2lwZSA9IGZ1bmN0aW9uKHNhdmVkcmVjaXBlLCBzY29wZSwgcmVjaXBlRnVuYykge1xuICAgIHNjb3BlLnJlY2lwZS5uYW1lID0gc2F2ZWRyZWNpcGUubmFtZTtcbiAgICBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSA9IHNhdmVkcmVjaXBlLmVmZmljaWVuY3k7XG4gICAgc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uID0gc2F2ZWRyZWNpcGUuYXR0ZW51YXRpb247XG4gICAgc2NvcGUucmVjaXBlLnZvbHVtZSA9IHNhdmVkcmVjaXBlLnZvbHVtZTtcbiAgICBzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkID0gc2F2ZWRyZWNpcGUuZ3JhaW5zLmFkZGVkO1xuICAgIHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkID0gc2F2ZWRyZWNpcGUuaG9wcy5hZGRlZDtcbiAgICBzY29wZS5ub3RlcyA9IHNhdmVkcmVjaXBlLm5vdGVzO1xuICAgIHNjb3BlLnllYXN0ID0gc2F2ZWRyZWNpcGUueWVhc3Q7XG4gICAgc2NvcGUuc2VsZWN0ZWRJbmRleCA9IDA7XG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHJlbW92ZSByZWNpcGUgZnJvbSBkYiBieSB1c2VybmFtZVxuICB0aGlzLmRlbGV0ZVJlY2lwZSA9IGZ1bmN0aW9uKGlkLCBodHRwLCBjYWxsYmFjayl7XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdkZWxldGUnLFxuICAgICAgZGF0YToge2lkOiBpZH0sXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL2RlbGV0ZS8nLFxuICAgICAgaGVhZGVyczoge1wiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04XCJ9XG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgY2FsbGJhY2socmVzKTtcbiAgICB9KVxuICB9O1xuXG4vL2luIHVuaXQgdGVzdCAtIHRoaXMgd2lsbCBncmFiIGxsIHNhdmVkIHJlY2lwZXMgYnkgdXNlcm5hbWUgdGhhdCBpcyBpbiB0aGUgZGF0YWJhc2VcbiAgdGhpcy5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbihzY29wZSwgaHR0cCwgcmVjaXBlRnVuYykge1xuICAgIGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL3NhdmVkJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgc2NvcGUucmVjaXBlcyA9IHJlcy5kYXRhO1xuICAgICAgICBzY29wZS5yZWNpcGVzLmZvckVhY2goZnVuY3Rpb24ocmVjaXBlLCBpbmRleCl7XG4gICAgICAgICAgc2NvcGUucmVjaXBlc1tpbmRleF0gPSByZWNpcGVGdW5jLmNhbGN1bGF0ZVN0YXRzKHJlY2lwZSwgcmVjaXBlRnVuYyk7XG4gICAgICB9KTtcbiAgICB9KVxuICB9O1xuICB0aGlzLnNybVRvUmdiQXJyYXkgPSBmdW5jdGlvbihzcm0pIHtcbiAgICBpZihzcm0gPCAxIHx8IHR5cGVvZiBzcm0gIT09ICdudW1iZXInKXtcbiAgICAgIHJldHVybiBbMjUxLCAxOTIsIDBdO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZ2IgPSBbXTtcbiAgICAgICAgcmdiLnB1c2goTWF0aC5yb3VuZChNYXRoLm1pbigyNTUsIE1hdGgubWF4KDAsIDI1NSAqIE1hdGgucG93KDAuOTc1LCBzcm0pKSkpKTtcbiAgICAgICAgcmdiLnB1c2goTWF0aC5yb3VuZChNYXRoLm1pbigyNTUsIE1hdGgubWF4KDAsIDI0NSAqIE1hdGgucG93KDAuODgsIHNybSkpKSkpO1xuICAgICAgICByZ2IucHVzaChNYXRoLnJvdW5kKE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgMjIwICogTWF0aC5wb3coMC43LCBzcm0pKSkpKTtcbiAgICAgICAgcmV0dXJuIHJnYlxuICAgICAgfVxuICB9O1xuICB0aGlzLlJnYkFycmF5VG9DU1MgPSBmdW5jdGlvbihyZ2JhcnJheSkge1xuICAgIGlmKHR5cGVvZiByZ2JhcnJheSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHZhciByZ2JDU1MgPSAncmdiKDI1MSwgMTkyLCAwKTsnO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcmdiQ1NTID0gJ3JnYignICsgcmdiYXJyYXlbMF0gKyAnLCAnICsgcmdiYXJyYXlbMV0gKyAnLCAnICsgcmdiYXJyYXlbMl0gKyAnKTsnO1xuICAgIH1cbiAgICByZXR1cm4gcmdiQ1NTO1xuICB9XG59KTtcbiIsIi8vY29udHJvbGxlciBmb3IgcmVnaXN0ZXIgcGFnZSAtIHNlbmRzIG5ldyB1c2VyIGluZm8gYW5kIHJldHVybnMgdGhhdCBkYXRhXG5hcHAuY29udHJvbGxlcigncmVnaXN0ZXJDb250cm9sJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKXtcbiAgJHNjb3BlLnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uKCl7XG4gICAgJGh0dHAoe1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgIHVybDogJy9yZWdpc3RlcidcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgJGxvY2F0aW9uLnVybCgnL2xvZ2luJyk7XG4gICAgfSwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgfSk7XG4gIH1cbn1dKTtcbiIsImFwcC5jb250cm9sbGVyKCdzYXZlZFJlY2lwZXMnLCBbJyRzY29wZScsICckaHR0cCcsJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCByZWNpcGVGdW5jKXtcbiAgJHNjb3BlLmRlbGV0ZVJlY2lwZSA9IGZ1bmN0aW9uKHJlY2lwZSkge1xuICAgIHJlY2lwZUZ1bmMuZGVsZXRlUmVjaXBlKHJlY2lwZS5faWQsICRodHRwLCBmdW5jdGlvbihyZXMpe1xuICAgICAgJHNjb3BlLmdldFNhdmVkUmVjaXBlcygpO1xuICAgIH0pO1xuICB9O1xuICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzID0gZnVuY3Rpb24oKSB7IHJldHVybiByZWNpcGVGdW5jLmdldFNhdmVkUmVjaXBlcygkc2NvcGUsICRodHRwLCByZWNpcGVGdW5jKSB9O1xufV0pO1xuYXBwLmNvbnRyb2xsZXIoJ2Ric2dDYWxjJywgWyckc2NvcGUnLCAnUHBnQ2FsYycsIGZ1bmN0aW9uKCRzY29wZSwgUHBnQ2FsYyl7XG4gICRzY29wZS5wcGdJdGVtcyA9IFtdO1xuICAkc2NvcGUuY2xlYXJBbGwgPSBmdW5jdGlvbigpIHtcbiAgICAkc2NvcGUucHBnSXRlbXMgPSBbXTtcbiAgfTtcbiAgJHNjb3BlLmFkZEdyYWluID0gZnVuY3Rpb24oKSB7XG4gICAgJHNjb3BlLnBwZ0l0ZW1zLnB1c2gobmV3IFBwZ0NhbGMubmV3SXRlbSgkc2NvcGUubmV3SXRlbSwgUHBnQ2FsYykpO1xuICAgICRzY29wZS5uZXdJdGVtID0ge307XG4gIH07XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=