var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,n,r){t.html5Mode(!0),r.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.goToPage=function(e){return e},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.service("PpgCalc",function(){this.calcPpg=function(e){return"number"!=typeof e&&(e=0),e=1e3*(1+e/100*.04621)/1e3,e=e.toString().slice(0,5)},this.newItem=function(e,t){this.ppg=t.calcPpg(e.dbfg),this.dbfg=e.dbfg,this.name=e.name}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,n){e.user={},e.user.recipetemplate="/views/notloggedin.html",n.getItem(t,e,"grains"),n.getItem(t,e,"hops"),n.getItem(t,e,"yeasts"),e.recipe=new n.recipe(e,n),e.clearCurrentRecipe=function(){return new n.clearCurrentRecipe(e,n)},e.saveRecipe=function(){return n.saveRecipe(t,e,n)},e.editRecipe=function(t){return n.editRecipe(t,e,n)},e.addIngredient=function(t,i,r){switch(i){case"grains":var o=new n.newGrain(t);break;case"hops":var o=new n.newHop(t);break;default:return}e.recipe[i].added.push(o),e[r]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,n){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,n){if(e.length>0&&t.length>0){var r=0,o=0,a=1.65*Math.pow(125e-6,n-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"Boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,n=a*t;r+=n*o}else if("Whirlpool"==e.hopType){var n=.1;r+=n*o}}),Math.round(100*r)/100}return 0},this.fg=function(e,t,i){if(t>0){var n=Math.round(1e3*(t-1)*(i/100))/1e3;return n=t-n,n.toString().length>5&&(n=n.toString().slice(0,5)),n}return 0},this.srm=function(e,t){if(e.length>0){var i=0,n=e.forEach(function(e,t){i+=e.lovi*e.weight});return n=i/t,n=Math.round(1.4922*Math.pow(n,.6859)*100)/100,n>50&&(n=50),n}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=75,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){var n={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:n}).then(function(e){t.recipe=new i.recipe(t,i),t.notes="",t.yeast={}})},this.clearCurrentRecipe=function(e,t){e.recipe=new t.recipe(e,t),e.notes="",e.yeast={}},this.editRecipe=function(e,t,i){t.recipe.name=e.name,t.recipe.efficiency=e.efficiency,t.recipe.attenuation=e.attenuation,t.recipe.volume=e.volume,t.recipe.grains.added=e.grains.added,t.recipe.hops.added=e.hops.added,t.notes=e.notes,t.yeast=e.yeast,t.selectedIndex=0},this.deleteRecipe=function(e,t,i){t({method:"delete",data:{id:e},url:"/private/recipes/delete/",headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(e){i(e)})},this.getSavedRecipes=function(e,t,i){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,n){e.recipes[n]=i.calculateStats(t,i)})})}}),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.deleteRecipe=function(n){i.deleteRecipe(n._id,t,function(t){e.getSavedRecipes()})},e.getSavedRecipes=function(){return i.getSavedRecipes(e,t,i)}}]),app.controller("dbsgCalc",["$scope","PpgCalc",function(e,t){e.ppgItems=[],e.clearAll=function(){e.ppgItems=[]},e.addGrain=function(){e.ppgItems.push(new t.newItem(e.newItem,t)),e.newItem={}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhlYWRlckN0cmwuanMiLCJsb2dpbkN0cmwuanMiLCJwcGdDYWxjU2VydmljZS5qcyIsInJlY2lwZU1ha2VDdHJsLmpzIiwicmVjaXBlc2VydmljZS5qcyIsInJlZ2lzdHJhdGlvbkN0cmwuanMiLCJzYXZlZFJlY2lwZXNDdHJsLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJG1kVGhlbWluZ1Byb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImp3dEludGVyY2VwdG9yUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJ0b2tlbkdldHRlciIsInNlc3Npb25TdG9yYWdlIiwiZ2V0SXRlbSIsImludGVyY2VwdG9ycyIsInB1c2giLCJ0aGVtZSIsInByaW1hcnlQYWxldHRlIiwiYWNjZW50UGFsZXR0ZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJkaXJlY3RpdmUiLCJyZXF1aXJlIiwic2NvcGUiLCJvdGhlclZhbCIsImxpbmsiLCJlbGVtIiwiYXR0ciIsIm5nTW9kZWwiLCIkdmFsaWRhdG9ycyIsImlzTWF0Y2giLCJtb2RlbFZhbCIsIiR3YXRjaCIsIiR2YWxpZGF0ZSIsIiRzY29wZSIsImp3dEhlbHBlciIsInVzZXIiLCJnb1RvUGFnZSIsInVybCIsImRlY29kZVRva2VuIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsIiRodHRwIiwiJGxvY2F0aW9uIiwidXNlckxvZ2luIiwibWV0aG9kIiwiZGF0YSIsInRoZW4iLCJyZXMiLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwic2VydmljZSIsInRoaXMiLCJjYWxjUHBnIiwiZGJmZyIsInRvU3RyaW5nIiwic2xpY2UiLCJuZXdJdGVtIiwiUHBnQ2FsYyIsInBwZyIsIm5hbWUiLCJyZWNpcGVGdW5jIiwicmVjaXBldGVtcGxhdGUiLCJyZWNpcGUiLCJjbGVhckN1cnJlbnRSZWNpcGUiLCJzYXZlUmVjaXBlIiwiZWRpdFJlY2lwZSIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsIm1vZGVsIiwiYWRkZWRJbmdyZWRpZW50IiwibmV3R3JhaW4iLCJuZXdIb3AiLCJhZGRlZCIsImRlbGV0ZUl0ZW0iLCJpbmRleCIsInNwbGljZSIsInVzZXJUb2tlbiIsInRvdGFsV2VpZ2h0IiwiaW5ncmVkaWVudHMiLCJ0b3RhbCIsImZvckVhY2giLCJ3ZWlnaHQiLCJwYXJzZUludCIsInRvdGFsUFBHIiwiZ3JhaW5zIiwidm9sdW1lIiwiZ3JhaW4iLCJNYXRoIiwicm91bmQiLCJQUEciLCJlZmZpY2llbmN5UFBHIiwiZWZmaWNpZW5jeSIsImVmZlBQRyIsImxlbmd0aCIsImlidSIsImhvcHMiLCJvZyIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJob3AiLCJBbHBoYV9BY2lkIiwiaG9wVHlwZSIsImJvaWxURmFjdCIsImhvcFRpbWUiLCJ1dGlsIiwiZmciLCJhdHRlbnVhdGlvbiIsInllYXN0Rm9vZCIsInNybSIsInRvdGFsQ29sb3IiLCJtY3UiLCJsb3ZpIiwiYWJ2IiwiZHAiLCJ0b3RhbGRwIiwiZ3JhaW5PYmoiLCJjaGFyYW5kQXBwcyIsImZsYXZvciIsImlkIiwiaG9wT2JqIiwiQmV0YV9BY2lkIiwiTmFtZSIsIk5vdGVzIiwiT3JpZ2luIiwiVHlwZSIsIm5vdGVzIiwicmVjaXBleWVhc3QiLCJ5ZWFzdCIsImNhbGN1bGF0ZVN0YXRzIiwiaHR0cCIsIml0ZW0iLCJzYXZlZHJlY2lwZSIsInNlbGVjdGVkSW5kZXgiLCJkZWxldGVSZWNpcGUiLCJjYWxsYmFjayIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJnZXRTYXZlZFJlY2lwZXMiLCJyZWNpcGVzIiwicmVnaXN0ZXJVc2VyIiwiX2lkIiwicHBnSXRlbXMiLCJjbGVhckFsbCIsImFkZEdyYWluIl0sIm1hcHBpbmdzIjoiQUFBQSxH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LEdBQ0F1RSxHQUNBekYsT0FBQSxPQUNBVixJQUFBLDJCQUNBWSxLQUFBLFNBQUFDLEdBQ0E1QixFQUFBMkgsUUFBQS9GLEVBQUFGLEtBQ0ExQixFQUFBMkgsUUFBQTNELFFBQUEsU0FBQW5CLEVBQUFhLEdBQ0ExRCxFQUFBMkgsUUFBQWpFLEdBQUFmLEVBQUFzRSxlQUFBcEUsRUFBQUYsVUNuUEFuRSxJQUFBb0IsV0FBQSxtQkFBQSxTQUFBLFFBQUEsWUFBQSxTQUFBZSxFQUFBVyxFQUFBQyxHQUNBWixFQUFBaUgsYUFBQSxXQUNBdEcsR0FDQUcsT0FBQSxPQUNBQyxLQUFBZixFQUFBRSxLQUNBRSxJQUFBLGNBQ0FZLEtBQUEsU0FBQUMsR0FDQWpCLEVBQUFFLEtBQUFlLEVBQUFGLEtBQ0FILEVBQUFSLElBQUEsV0FDQSxTQUFBYSxHQUNBakIsRUFBQUUsS0FBQWUsRUFBQUYsV0NYQWxELElBQUFvQixXQUFBLGdCQUFBLFNBQUEsUUFBQSxhQUFBLFNBQUFlLEVBQUFXLEVBQUFxQixHQUNBaEMsRUFBQTJHLGFBQUEsU0FBQXpFLEdBQ0FGLEVBQUEyRSxhQUFBekUsRUFBQWdGLElBQUF2RyxFQUFBLFNBQUFNLEdBQ0FqQixFQUFBK0cscUJBR0EvRyxFQUFBK0csZ0JBQUEsV0FBQSxNQUFBL0UsR0FBQStFLGdCQUFBL0csRUFBQVcsRUFBQXFCLE9BRUFuRSxJQUFBb0IsV0FBQSxZQUFBLFNBQUEsVUFBQSxTQUFBZSxFQUFBNkIsR0FDQTdCLEVBQUFtSCxZQUNBbkgsRUFBQW9ILFNBQUEsV0FDQXBILEVBQUFtSCxhQUVBbkgsRUFBQXFILFNBQUEsV0FDQXJILEVBQUFtSCxTQUFBeEksS0FBQSxHQUFBa0QsR0FBQUQsUUFBQTVCLEVBQUE0QixRQUFBQyxJQUNBN0IsRUFBQTRCIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgncmVjaXBlQ3JlYXRvcicsIFsnbmdNYXRlcmlhbCcsICduZ1JvdXRlJywgJ2FuZ3VsYXItand0J10pO1xuICBhcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJG1kVGhlbWluZ1Byb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRodHRwUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnand0SW50ZXJjZXB0b3JQcm92aWRlcicsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCBqd3RJbnRlcmNlcHRvclByb3ZpZGVyKXtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICBqd3RJbnRlcmNlcHRvclByb3ZpZGVyLnRva2VuR2V0dGVyID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9XG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnand0SW50ZXJjZXB0b3InKTtcblxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXG4gICAgICAucHJpbWFyeVBhbGV0dGUoJ2FtYmVyJylcbiAgICAgIC5hY2NlbnRQYWxldHRlKCd5ZWxsb3cnKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSkud2hlbignL2Ric2dfY2FsYycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Ric2djYWxjLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2Ric2dDYWxjJ1xuICAgIH0pLndoZW4oJy9sb2dpbicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ29udHJvbCdcbiAgICB9KS53aGVuKCcvcmVnaXN0ZXInLCB7XG4gICAgICB0ZW1wbGF0ZVVybDonL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlZ2lzdGVyQ29udHJvbCdcbiAgICB9KS5vdGhlcndpc2UoJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSk7XG4gIH1dKTtcbiAgYXBwLmRpcmVjdGl2ZSgnaXNNYXRjaCcsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIG90aGVyVmFsOiBcIj1pc01hdGNoXCJcbiAgICAgIH0sXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0ciwgbmdNb2RlbCkge1xuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmlzTWF0Y2ggPSBmdW5jdGlvbihtb2RlbFZhbCkge1xuICAgICAgICAgIHJldHVybiBtb2RlbFZhbCA9PT0gc2NvcGUub3RoZXJWYWw7XG4gICAgICAgIH07XG4gICAgICAgIHNjb3BlLiR3YXRjaCgnb3RoZXJWYWwnLCBmdW5jdGlvbigpe1xuICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ2hlYWRlckNvbnRyb2wnLCBbJyRzY29wZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkc2NvcGUsIGp3dEhlbHBlcil7XG4gICRzY29wZS51c2VyID0ge307XG4gICRzY29wZS5nb1RvUGFnZSA9IGZ1bmN0aW9uKHVybCkge1xuICAgIHJldHVybiB1cmw7XG4gIH1cbiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgfSwgZnVuY3Rpb24oKXtcbiAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSl7XG4gICAgICAkc2NvcGUudXNlciA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dvdXQgJyArICRzY29wZS51c2VyLnVzZXJuYW1lO1xuICAgICAgJHNjb3BlLnVzZXIubG9naW5VcmwgPSAnLyc7XG4gICAgfSBlbHNlIHtcbiAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dpbi9SZWdpc3Rlcic7XG4gICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvbG9naW4nXG4gICAgfVxuICB9KTtcblxuICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlclRva2VuJyk7XG4gIH07XG59XSk7XG4iLCIvL2NvbnRyb2xsZXIgZm9yIGxvZ2luIHNjcmVlbiAtIHNlbmRzIHVzZXIvcGFzcyBhbmQgc3RvcmVzIGp3dFxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICRzY29wZS51c2VyTG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgdXJsOiAnL2xvZ2luYXV0aCdcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICBpZihyZXMuZGF0YS50b2tlbil7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJUb2tlbicsIHJlcy5kYXRhLnRva2VuKTtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xuICAgICAgfTtcbiAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgJHNjb3BlLmVycm9yID0gcmVzLmRhdGE7XG4gICAgICAkc2NvcGUudXNlci5wYXNzd29yZCA9ICcnO1xuICAgIH0pO1xuICB9XG59XSk7XG4iLCJhcHAuc2VydmljZSgnUHBnQ2FsYycsIGZ1bmN0aW9uICgpe1xuICB0aGlzLmNhbGNQcGcgPSBmdW5jdGlvbihkYmZnKSB7XG4gICAgaWYodHlwZW9mIGRiZmcgIT09ICdudW1iZXInKXtcbiAgICAgIGRiZmcgPSAwO1xuICAgIH1cbiAgICBkYmZnID0gKDEwMDAgKiAoMSArIChkYmZnIC8gMTAwKSAqIDAuMDQ2MjEpKSAvIDEwMDBcbiAgICBkYmZnID0gZGJmZy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgIHJldHVybiBkYmZnO1xuICB9O1xuICB0aGlzLm5ld0l0ZW0gPSBmdW5jdGlvbiAobmV3SXRlbSwgUHBnQ2FsYykge1xuICAgIHRoaXMucHBnID0gUHBnQ2FsYy5jYWxjUHBnKG5ld0l0ZW0uZGJmZyk7XG4gICAgdGhpcy5kYmZnID0gbmV3SXRlbS5kYmZnO1xuICAgIHRoaXMubmFtZSA9IG5ld0l0ZW0ubmFtZTtcbiAgfVxufSk7XG4iLCJhcHAuY29udHJvbGxlcigncmVjaXBlTWFrZScsIFsnJHNjb3BlJywgJyRodHRwJywgJ2p3dEhlbHBlcicsICdyZWNpcGVGdW5jJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgand0SGVscGVyLCByZWNpcGVGdW5jKXtcbiAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnO1xuXG4gIC8vZ2V0IGFsbCBpdGVtcyBsaXN0ZWQgaW4gdGhlIHNlbGVjdCBtZW51XG4gIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAnZ3JhaW5zJyk7XG4gIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAnaG9wcycpO1xuICByZWNpcGVGdW5jLmdldEl0ZW0oJGh0dHAsICRzY29wZSwgJ3llYXN0cycpO1xuXG4gIC8vVGhlIG9iamVjdCB1c2VkIGZvciByZWNpcGUgY3JlYXRpb24gYXMgd2VsbCBhcyBjYWxjdWxhdGlvbnNcbiAgJHNjb3BlLnJlY2lwZSA9IG5ldyByZWNpcGVGdW5jLnJlY2lwZSgkc2NvcGUsIHJlY2lwZUZ1bmMpO1xuXG4gIC8vU2F2ZS9jbGVhci9lZGl0IGZ1bmN0aW9uIGZvciBidXR0b24gbmctY2xpY2tcbiAgJHNjb3BlLmNsZWFyQ3VycmVudFJlY2lwZSA9IGZ1bmN0aW9uKCl7IHJldHVybiBuZXcgcmVjaXBlRnVuYy5jbGVhckN1cnJlbnRSZWNpcGUoJHNjb3BlLCByZWNpcGVGdW5jKSB9O1xuICAkc2NvcGUuc2F2ZVJlY2lwZSA9IGZ1bmN0aW9uKCl7IHJldHVybiByZWNpcGVGdW5jLnNhdmVSZWNpcGUoJGh0dHAsICRzY29wZSwgcmVjaXBlRnVuYykgfTtcbiAgJHNjb3BlLmVkaXRSZWNpcGUgPSBmdW5jdGlvbihyZWNpcGUpIHsgcmV0dXJuIHJlY2lwZUZ1bmMuZWRpdFJlY2lwZShyZWNpcGUsICRzY29wZSwgcmVjaXBlRnVuYykgfVxuXG4gIC8vZ2VuZXJpYyBmdW5jdGlvbiB0byBhZGQgYW4gaXRlbSB0byB0aGUgYXJyYXkgZm9yIHRob3NlIGluZ3JlZGllbnRzXG4gICRzY29wZS5hZGRJbmdyZWRpZW50ID0gZnVuY3Rpb24oaW5ncmVkaWVudCwgdHlwZSwgbW9kZWwpe1xuICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICBjYXNlICdncmFpbnMnOlxuICAgICAgICB2YXIgYWRkZWRJbmdyZWRpZW50ID0gbmV3IHJlY2lwZUZ1bmMubmV3R3JhaW4oaW5ncmVkaWVudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaG9wcyc6XG4gICAgICAgIHZhciBhZGRlZEluZ3JlZGllbnQgPSBuZXcgcmVjaXBlRnVuYy5uZXdIb3AoaW5ncmVkaWVudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuO1xuICAgIH07XG4gICAgJHNjb3BlLnJlY2lwZVt0eXBlXS5hZGRlZC5wdXNoKGFkZGVkSW5ncmVkaWVudCk7XG4gICAgJHNjb3BlW21vZGVsXSA9IHt9O1xuICB9XG4gIC8vcmVtb3ZlIGJ1dHRvbiBmdW5jdGlvbiAtIHJlbW92ZXMgb25lIGl0ZW0gZnJvbSB0aGUgYXJyYXlcbiAgJHNjb3BlLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbihpbmRleCwgdHlwZSkge1xuICAgICRzY29wZS5yZWNpcGVbdHlwZV0uYWRkZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gIH0sIGZ1bmN0aW9uKCl7XG4gICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICB2YXIgdXNlclRva2VuID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyVG9rZW47XG4gICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy9wcml2YXRlL3ZpZXdzL3NhdmVkcmVjaXBlcy5odG1sJ1xuICAgIH0gZWxzZSB7XG4gICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnXG4gICAgfVxuICB9KTtcblxufV0pO1xuIiwiYXBwLnNlcnZpY2UoJ3JlY2lwZUZ1bmMnLCBmdW5jdGlvbigpe1xuICAvL2luIHVuaXQgdGVzdCB0aGlzIGNhbGN1bGF0ZXMgdGhlIHdlaWdodCBvZiBhbGwgZ3JhaW5zIGFkZGVkXG4gIHRoaXMudG90YWxXZWlnaHQgPSBmdW5jdGlvbihpbmdyZWRpZW50cyl7XG4gICAgdmFyIHRvdGFsID0gMDtcbiAgICBpbmdyZWRpZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGluZ3JlZGllbnQpe1xuICAgICAgaWYoaW5ncmVkaWVudC53ZWlnaHQgPiAwKXtcbiAgICAgICAgdG90YWwgKz0gcGFyc2VJbnQoaW5ncmVkaWVudC53ZWlnaHQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gdGhpcyBjYWxjdWxhdGVzIHRoZSBtYXggc3VnYXIgZXh0cmFjdGlvbiBwb3NzaWJsZSBmcm9tIHRoZSBncmFpbnNcbiAgdGhpcy50b3RhbFBQRyA9IGZ1bmN0aW9uKGdyYWlucywgdm9sdW1lKXtcbiAgICB2YXIgdG90YWwgPSAwO1xuICAgIGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCl7XG4gICAgICB0b3RhbCArPSAoTWF0aC5yb3VuZCgoZ3JhaW4uUFBHIC0gMSkgKiAxMDAwICogZ3JhaW4ud2VpZ2h0IC8gdm9sdW1lKSkgLyAxMDAwO1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgdGhpcyBjYWxjdWxhdGVzIHRoZSBlc3RpbWF0ZWQgc3VnYXIgZXh0cmFjdGlvbiBiYXNlZCBvbiB1c2VyJ3MgZWZmLiBpbnB1dFxuICB0aGlzLmVmZmljaWVuY3lQUEcgPSBmdW5jdGlvbih0b3RhbFBQRywgZWZmaWNpZW5jeSkge1xuICAgIGlmKHRvdGFsUFBHID09PSAwKXtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBlZmZQUEcgPSBNYXRoLnJvdW5kKHRvdGFsUFBHICogKGVmZmljaWVuY3kgLyAxMDApICogMTAwMCkgLyAxMDAwICsgMTtcbiAgICAgICAgaWYoZWZmUFBHID4gMS41KSB7XG4gICAgICAgICAgZWZmUFBHID0gMS41O1xuICAgICAgICB9XG4gICAgICAgIGlmKGVmZlBQRy50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICBlZmZQUEcgPSBlZmZQUEcudG9TdHJpbmcoKS5zbGljZSgwLCA1KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGVmZlBQRztcbiAgICAgIH1cbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSBjYWxjdWxhdGVzIGlidSdzIGZvciB1c2VyJ3MgaW5wdXQgaG9wc1xuICB0aGlzLmlidSA9IGZ1bmN0aW9uKGhvcHMsIGdyYWlucywgdm9sdW1lLCBvZykge1xuICAgIGlmKGhvcHMubGVuZ3RoID4gMCAmJiBncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIGlidSA9IDA7XG4gICAgICB2YXIgYWF1ID0gMDtcbiAgICAgIHZhciBiaWdGYWN0ID0gMS42NSAqIE1hdGgucG93KDAuMDAwMTI1LCAob2cgLSAxKSk7XG4gICAgICBob3BzLmZvckVhY2goZnVuY3Rpb24oaG9wKSB7XG4gICAgICAgIGFhdSA9IGhvcC53ZWlnaHQgKiAoaG9wLkFscGhhX0FjaWQgLyAxMDApICogNzQ5MCAvIHZvbHVtZTtcbiAgICAgICAgaWYoaG9wLmhvcFR5cGUgPT0gJ0JvaWwnKSB7XG4gICAgICAgICAgdmFyIGJvaWxURmFjdCA9ICgoMSAtIE1hdGgucG93KDIuNzE4MjgxODI4NDU5MDQ1MjM1MzYsICgtLjA0ICogaG9wLmhvcFRpbWUpKSkgLyAzLjgpO1xuICAgICAgICAgIHZhciB1dGlsID0gYmlnRmFjdCAqIGJvaWxURmFjdDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdTtcbiAgICAgICAgfSBlbHNlIGlmKGhvcC5ob3BUeXBlID09ICdXaGlybHBvb2wnKSB7XG4gICAgICAgICAgdmFyIHV0aWwgPSAuMTA7XG4gICAgICAgICAgaWJ1ICs9IHV0aWwgKiBhYXVcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZChpYnUgKiAxMDApIC8gMTAwO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfTtcbiAgLy9pbiB1bml0IHRlc3QgLSB0aGlzIGNhbGN1bGF0ZXMgdGhlIGZpbmFsIGdyYXZpdHkgYmFzZWQgb24gYXR0ZW51YXRpb25cbiAgdGhpcy5mZyA9IGZ1bmN0aW9uKGdyYWlucywgb2csIGF0dGVudWF0aW9uKXtcbiAgICBpZihvZyA+IDApIHtcbiAgICAgIHZhciB5ZWFzdEZvb2QgPSBNYXRoLnJvdW5kKCgob2cgLSAxKSAqIDEwMDApICogKGF0dGVudWF0aW9uIC8gMTAwKSkgLyAxMDAwO1xuICAgICAgeWVhc3RGb29kID0gb2cgLSB5ZWFzdEZvb2Q7XG4gICAgICBpZih5ZWFzdEZvb2QudG9TdHJpbmcoKS5sZW5ndGggPiA1KSB7XG4gICAgICAgIHllYXN0Rm9vZCA9IHllYXN0Rm9vZC50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHllYXN0Rm9vZDtcbiAgICB9IGVsc2Uge1xuICAgIHJldHVybiAwXG4gICAgfVxuICB9O1xuICAgICAgLy9pbiB1bml0IHRlc3QgLSBlc3RpbWF0ZSBjb2xvciBiYXNlZCBvbiBncmFpbnMgYWRkZWRcbiAgdGhpcy5zcm0gPSBmdW5jdGlvbihncmFpbnMsIHZvbHVtZSl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0b3RhbENvbG9yID0gMDtcbiAgICAgIHZhciBtY3UgPSBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgdG90YWxDb2xvciArPSAoZ3JhaW4ubG92aSAqIGdyYWluLndlaWdodCk7XG4gICAgICB9KTtcbiAgICAgIG1jdSA9IHRvdGFsQ29sb3IgLyB2b2x1bWU7XG4gICAgICBtY3UgPSBNYXRoLnJvdW5kKCgxLjQ5MjIgKiAoTWF0aC5wb3cobWN1LCAwLjY4NTkpKSkgKiAxMDApIC8gMTAwO1xuICAgICAgaWYobWN1ID4gNTApe1xuICAgICAgICBtY3UgPSA1MDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWN1O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgfTtcbiAgICAvL2luIHVuaXQgdGVzdCAtIGNhbGMgYWJ2ICVcbiAgdGhpcy5hYnYgPSBmdW5jdGlvbihncmFpbnMsIG9nLCBmZyl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKCg3Ni4wOCAqIChvZy1mZykgLyAoMS43NzUgLSBvZykpICogKGZnIC8gMC43OTQpICogMTAwKSAvIDEwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDBcbiAgICB9XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gY2FsY3VsYXRlIGRpYXN0YXRpYyBwb3dlclxuICB0aGlzLmRwID0gZnVuY3Rpb24oZ3JhaW5zLCB0b3RhbFdlaWdodCl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0b3RhbGRwID0gMDtcbiAgICAgIGdyYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICB0b3RhbGRwICs9IGdyYWluLmRwICogZ3JhaW4ud2VpZ2h0O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZCh0b3RhbGRwIC8gdG90YWxXZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cbiAgLy9pbiB1bml0IHRlc3QgLSBjb25zdHJ1Y3RvciBmb3IgbmV3IGdyYWluIGl0ZW1cbiAgdGhpcy5uZXdHcmFpbiA9IGZ1bmN0aW9uKGdyYWluT2JqKSB7XG4gICAgdGhpcy5QUEcgPSBncmFpbk9iai5QUEc7XG4gICAgdGhpcy5jaGFyYW5kQXBwcyA9IGdyYWluT2JqLmNoYXJhbmRBcHBzO1xuICAgIHRoaXMuZHAgPSBncmFpbk9iai5kcDtcbiAgICB0aGlzLmZsYXZvciA9IGdyYWluT2JqLmZsYXZvcjtcbiAgICB0aGlzLmlkID0gZ3JhaW5PYmouaWQ7XG4gICAgdGhpcy5sb3ZpID0gZ3JhaW5PYmoubG92aTtcbiAgICB0aGlzLm5hbWUgPSBncmFpbk9iai5uYW1lO1xuICAgIHRoaXMud2VpZ2h0PSBncmFpbk9iai53ZWlnaHQ7XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gY29uc3RydWN0b3IgZm9yIG5ldyBob3AgaXRlbVxuICB0aGlzLm5ld0hvcCA9IGZ1bmN0aW9uKGhvcE9iaikge1xuICAgIHRoaXMuQWxwaGFfQWNpZCA9IGhvcE9iai5BbHBoYV9BY2lkO1xuICAgIHRoaXMuQmV0YV9BY2lkID0gaG9wT2JqLkJldGFfQWNpZDtcbiAgICB0aGlzLk5hbWUgPSBob3BPYmouTmFtZTtcbiAgICB0aGlzLk5vdGVzID0gaG9wT2JqLk5vdGVzO1xuICAgIHRoaXMuT3JpZ2luID0gaG9wT2JqLk9yaWdpbjtcbiAgICB0aGlzLlR5cGUgPSBob3BPYmouVHlwZTtcbiAgICB0aGlzLmhvcFRpbWUgPSBob3BPYmouaG9wVGltZTtcbiAgICB0aGlzLmhvcFR5cGUgPSBob3BPYmouaG9wVHlwZTtcbiAgICB0aGlzLndlaWdodCA9IGhvcE9iai53ZWlnaHQ7XG4gIH07XG4gIC8vaW4gdW5pdCB0ZXN0IC0gY29uc3RydWN0b3IgZm9yIGEgYmxhbmsgcmVjaXBlXG4gIHRoaXMucmVjaXBlID0gZnVuY3Rpb24oc2NvcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICB0aGlzLmVmZmljaWVuY3kgPSA2NTtcbiAgICB0aGlzLmF0dGVudWF0aW9uID0gNzU7XG4gICAgdGhpcy52b2x1bWUgPSA1O1xuICAgIHRoaXMuZ3JhaW5zID0ge1xuICAgICAgYWRkZWQ6IFtdXG4gICAgfTtcbiAgICB0aGlzLmhvcHMgPSB7XG4gICAgICBhZGRlZDogW10sXG4gICAgICBpYnU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmlidShzY29wZS5yZWNpcGUuaG9wcy5hZGRlZCwgc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSwgc2NvcGUucmVjaXBlLm9nKCkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5vZyA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gcmVjaXBlRnVuYy5lZmZpY2llbmN5UFBHKHJlY2lwZUZ1bmMudG90YWxQUEcoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSksIHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5KVxuICAgIH07XG4gICAgdGhpcy5mZyA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gcmVjaXBlRnVuYy5mZyhzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUub2coKSwgc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uKVxuICAgIH07XG4gICAgdGhpcy5hYnYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuYWJ2KHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS5vZygpLCBzY29wZS5yZWNpcGUuZmcoKSk7XG4gICAgICB9O1xuICAgIHRoaXMuc3JtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLnNybShzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUudm9sdW1lKTtcbiAgICAgIH07XG4gICAgdGhpcy5kcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5kcChzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGVGdW5jLnRvdGFsV2VpZ2h0KHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQpKTtcbiAgICAgIH07XG4gICAgdGhpcy5ub3RlcyA9ICcnO1xuICAgIHRoaXMucmVjaXBleWVhc3QgPSAgc2NvcGUueWVhc3Q7XG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHRoaXMgY2FsY3VsYXRlcyBzdGF0cyBmb3IgZWFjaCBzYXZlZCByZWNpcGVcbiAgdGhpcy5jYWxjdWxhdGVTdGF0cyA9IGZ1bmN0aW9uKHJlY2lwZSwgcmVjaXBlRnVuYykge1xuICAgIHJlY2lwZS5vZyA9IHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUpLCByZWNpcGUuZWZmaWNpZW5jeSk7XG4gICAgcmVjaXBlLmZnID0gcmVjaXBlRnVuYy5mZyhyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUub2csIHJlY2lwZS5hdHRlbnVhdGlvbik7XG4gICAgcmVjaXBlLmFidiA9IHJlY2lwZUZ1bmMuYWJ2KHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS5vZywgcmVjaXBlLmZnKTtcbiAgICByZWNpcGUuc3JtID0gcmVjaXBlRnVuYy5zcm0ocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLnZvbHVtZSk7XG4gICAgcmVjaXBlLmRwID0gcmVjaXBlRnVuYy5kcChyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGVGdW5jLnRvdGFsV2VpZ2h0KHJlY2lwZS5ncmFpbnMuYWRkZWQpKTtcbiAgICByZWNpcGUuaG9wcy5pYnUgPSByZWNpcGVGdW5jLmlidShyZWNpcGUuaG9wcy5hZGRlZCwgcmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLnZvbHVtZSwgcmVjaXBlLm9nKTtcbiAgICByZXR1cm4gcmVjaXBlO1xuICB9O1xuLy9pbiB1bml0IHRlc3RzIC0gdGhpcyBnZXRzIGFuIGl0ZW0gZnJvbSB0aGUgc3FsaXRlIGRiXG4gIHRoaXMuZ2V0SXRlbSA9IGZ1bmN0aW9uKGh0dHAsIHNjb3BlLCBpdGVtKSB7XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgdXJsOiAnLycgKyBpdGVtXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpIHtcbiAgICAgIHNjb3BlW2l0ZW1dID0gcmVzLmRhdGE7XG4gICAgfSk7XG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHNhdmVzIHJlY2lwZSB0byBkYXRhYmFzZSB3aXRoIGEgdGllIHRvIHRoZSB1c2VyXG4gIHRoaXMuc2F2ZVJlY2lwZSA9IGZ1bmN0aW9uKGh0dHAsIHNjb3BlLCByZWNpcGVGdW5jKSB7XG4gICAgdmFyIHJlY2lwZSA9IHtcbiAgICAgIHVzZXJuYW1lOiBzY29wZS51c2VyLnVzZXJuYW1lLFxuICAgICAgbmFtZTogc2NvcGUucmVjaXBlLm5hbWUsXG4gICAgICBncmFpbnM6IHtcbiAgICAgICAgYWRkZWQ6IHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWRcbiAgICAgIH0sXG4gICAgICBlZmZpY2llbmN5OiBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSxcbiAgICAgIHZvbHVtZTogc2NvcGUucmVjaXBlLnZvbHVtZSxcbiAgICAgIGF0dGVudWF0aW9uOiBzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24sXG4gICAgICBob3BzOiB7XG4gICAgICAgIGFkZGVkOiBzY29wZS5yZWNpcGUuaG9wcy5hZGRlZFxuICAgICAgfSxcbiAgICAgIG5vdGVzOiBzY29wZS5ub3RlcyxcbiAgICAgIHllYXN0OiBzY29wZS55ZWFzdFxuICAgIH07XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMnLFxuICAgICAgZGF0YTogcmVjaXBlXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKHNjb3BlLCByZWNpcGVGdW5jKTtcbiAgICAgIHNjb3BlLm5vdGVzID0gJyc7XG4gICAgICBzY29wZS55ZWFzdCA9IHt9O1xuICAgIH0pXG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHJlc2V0IHNjb3BlLnJlY2lwZSB2YWx1ZXNcbiAgdGhpcy5jbGVhckN1cnJlbnRSZWNpcGUgPSBmdW5jdGlvbihzY29wZSwgcmVjaXBlRnVuYyl7XG4gICAgc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKHNjb3BlLCByZWNpcGVGdW5jKTtcbiAgICBzY29wZS5ub3RlcyA9ICcnO1xuICAgIHNjb3BlLnllYXN0ID0ge307XG4gIH07XG4vL2luIHVuaXQgdGVzdCAtIHJlcGxhY2Ugc2NvcGUucmVjaXBlIHdpdGggYSBzZWxlY3RlZCByZWNpcGUncyB2YWx1ZXNcbiAgdGhpcy5lZGl0UmVjaXBlID0gZnVuY3Rpb24oc2F2ZWRyZWNpcGUsIHNjb3BlLCByZWNpcGVGdW5jKSB7XG4gICAgc2NvcGUucmVjaXBlLm5hbWUgPSBzYXZlZHJlY2lwZS5uYW1lO1xuICAgIHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5ID0gc2F2ZWRyZWNpcGUuZWZmaWNpZW5jeTtcbiAgICBzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24gPSBzYXZlZHJlY2lwZS5hdHRlbnVhdGlvbjtcbiAgICBzY29wZS5yZWNpcGUudm9sdW1lID0gc2F2ZWRyZWNpcGUudm9sdW1lO1xuICAgIHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQgPSBzYXZlZHJlY2lwZS5ncmFpbnMuYWRkZWQ7XG4gICAgc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQgPSBzYXZlZHJlY2lwZS5ob3BzLmFkZGVkO1xuICAgIHNjb3BlLm5vdGVzID0gc2F2ZWRyZWNpcGUubm90ZXM7XG4gICAgc2NvcGUueWVhc3QgPSBzYXZlZHJlY2lwZS55ZWFzdDtcbiAgICBzY29wZS5zZWxlY3RlZEluZGV4ID0gMDtcbiAgfTtcbi8vaW4gdW5pdCB0ZXN0IC0gcmVtb3ZlIHJlY2lwZSBmcm9tIGRiIGJ5IHVzZXJuYW1lXG4gIHRoaXMuZGVsZXRlUmVjaXBlID0gZnVuY3Rpb24oaWQsIGh0dHAsIGNhbGxiYWNrKXtcbiAgICBodHRwKHtcbiAgICAgIG1ldGhvZDogJ2RlbGV0ZScsXG4gICAgICBkYXRhOiB7aWQ6IGlkfSxcbiAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMvZGVsZXRlLycsXG4gICAgICBoZWFkZXJzOiB7XCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLThcIn1cbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICBjYWxsYmFjayhyZXMpO1xuICAgIH0pXG4gIH07XG5cbi8vaW4gdW5pdCB0ZXN0IC0gdGhpcyB3aWxsIGdyYWIgbGwgc2F2ZWQgcmVjaXBlcyBieSB1c2VybmFtZSB0aGF0IGlzIGluIHRoZSBkYXRhYmFzZVxuICB0aGlzLmdldFNhdmVkUmVjaXBlcyA9IGZ1bmN0aW9uKHNjb3BlLCBodHRwLCByZWNpcGVGdW5jKSB7XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMvc2F2ZWQnXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBzY29wZS5yZWNpcGVzID0gcmVzLmRhdGE7XG4gICAgICAgIHNjb3BlLnJlY2lwZXMuZm9yRWFjaChmdW5jdGlvbihyZWNpcGUsIGluZGV4KXtcbiAgICAgICAgICBzY29wZS5yZWNpcGVzW2luZGV4XSA9IHJlY2lwZUZ1bmMuY2FsY3VsYXRlU3RhdHMocmVjaXBlLCByZWNpcGVGdW5jKTtcbiAgICAgIH0pO1xuICAgIH0pXG4gIH1cbn0pO1xuIiwiLy9jb250cm9sbGVyIGZvciByZWdpc3RlciBwYWdlIC0gc2VuZHMgbmV3IHVzZXIgaW5mbyBhbmQgcmV0dXJucyB0aGF0IGRhdGFcbmFwcC5jb250cm9sbGVyKCdyZWdpc3RlckNvbnRyb2wnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pe1xuICAkc2NvcGUucmVnaXN0ZXJVc2VyID0gZnVuY3Rpb24oKXtcbiAgICAkaHR0cCh7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgdXJsOiAnL3JlZ2lzdGVyJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgICAkbG9jYXRpb24udXJsKCcvbG9naW4nKTtcbiAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgJHNjb3BlLnVzZXIgPSByZXMuZGF0YTtcbiAgICB9KTtcbiAgfVxufV0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ3NhdmVkUmVjaXBlcycsIFsnJHNjb3BlJywgJyRodHRwJywncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHJlY2lwZUZ1bmMpe1xuICAkc2NvcGUuZGVsZXRlUmVjaXBlID0gZnVuY3Rpb24ocmVjaXBlKSB7XG4gICAgcmVjaXBlRnVuYy5kZWxldGVSZWNpcGUocmVjaXBlLl9pZCwgJGh0dHAsIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzKCk7XG4gICAgfSk7XG4gIH07XG4gICRzY29wZS5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHJlY2lwZUZ1bmMuZ2V0U2F2ZWRSZWNpcGVzKCRzY29wZSwgJGh0dHAsIHJlY2lwZUZ1bmMpIH07XG59XSk7XG5hcHAuY29udHJvbGxlcignZGJzZ0NhbGMnLCBbJyRzY29wZScsICdQcGdDYWxjJywgZnVuY3Rpb24oJHNjb3BlLCBQcGdDYWxjKXtcbiAgJHNjb3BlLnBwZ0l0ZW1zID0gW107XG4gICRzY29wZS5jbGVhckFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICRzY29wZS5wcGdJdGVtcyA9IFtdO1xuICB9O1xuICAkc2NvcGUuYWRkR3JhaW4gPSBmdW5jdGlvbigpIHtcbiAgICAkc2NvcGUucHBnSXRlbXMucHVzaChuZXcgUHBnQ2FsYy5uZXdJdGVtKCRzY29wZS5uZXdJdGVtLCBQcGdDYWxjKSk7XG4gICAgJHNjb3BlLm5ld0l0ZW0gPSB7fTtcbiAgfTtcbn1dKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==