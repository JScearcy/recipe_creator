var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,i,r,n){t.html5Mode(!0),n.tokenGetter=function(){return sessionStorage.getItem("userToken")},r.interceptors.push("jwtInterceptor"),i.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,i,r){r.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){r.$validate()})}}}),app.controller("recipeMake",["$scope","$http","jwtHelper","recipeFunc",function(e,t,i,r){e.user={},e.user.recipetemplate="/views/notloggedin.html",r.getItem(t,e,"grains"),r.getItem(t,e,"hops"),r.getItem(t,e,"yeasts"),e.recipe=new r.recipe(e,r),e.saveRecipe=function(){return r.saveRecipe(t,e,r)},e.addIngredient=function(t,i,n){switch(i){case"grains":var o=new r.newGrain(t);break;case"hops":var o=new r.newHop(t);break;default:var o={}}e.recipe[i].added.push(o),e[n]={}},e.deleteItem=function(t,i){e.recipe[i].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=i.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("loginControl",["$scope","$http","$location",function(e,t,i){e.userLogin=function(){t({method:"post",data:e.user,url:"/loginauth"}).then(function(t){t.data.token&&(sessionStorage.setItem("userToken",t.data.token),e.user={},i.url("/"))},function(t){e.error=t.data,e.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,i){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,i.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$scope","jwtHelper",function(e,t){e.user={},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(e.user=t.decodeToken(sessionStorage.getItem("userToken")),e.user.login="Logout "+e.user.username,e.user.loginUrl="/"):(e.user={},e.user.login="Login/Register",e.user.loginUrl="/login")}),e.logOut=function(){sessionStorage.removeItem("userToken")}}]),app.controller("savedRecipes",["$scope","$http","recipeFunc",function(e,t,i){e.getSavedRecipes=function(){t({method:"post",url:"/private/recipes/saved"}).then(function(t){e.recipes=t.data,e.recipes.forEach(function(t,r){e.recipes[r]=i.calculateStats(t,i)})})}}]),app.service("recipeFunc",function(){this.totalWeight=function(e){var t=0;return e.forEach(function(e){e.weight>0&&(t+=parseInt(e.weight))}),t},this.totalPPG=function(e,t){var i=0;return e.forEach(function(e,r){i+=Math.round(1e3*(e.PPG-1)*e.weight/t)/1e3}),i},this.efficiencyPPG=function(e,t){if(0===e)return 0;var i=Math.round(e*(t/100)*1e3)/1e3+1;return i>1.5&&(i=1.5),i.toString().length>5&&(i=i.toString().slice(0,5)),i},this.ibu=function(e,t,i,r){if(e.length>0&&t.length>0){var n=0,o=0,a=1.65*Math.pow(125e-6,r-1);return e.forEach(function(e){if(o=e.weight*(e.Alpha_Acid/100)*7490/i,"boil"==e.hopType){var t=(1-Math.pow(2.718281828459045,-.04*e.hopTime))/3.8,r=a*t;n+=r*o}else if("whirlpool"==e.hopType){var r=.1;n+=r*o}}),Math.round(100*n)/100}return 0},this.fg=function(e,t,i){if(t>0){var r=Math.round(1e3*(t-1)*(i/100))/1e3;return r=t-r,r.toString().length>5&&(r=r.toString().slice(0,5)),r}return 0},this.srm=function(e,t){if(e.length>0){var i=0,r=e.forEach(function(e,t){i+=e.lovi*e.weight});return r=i/t,r=Math.round(1.4922*Math.pow(r,.6859)*100)/100,r>50&&(r=50),r}return 0},this.abv=function(e,t,i){return e.length>0?Math.round(76.08*(t-i)/(1.775-t)*(i/.794)*100)/100:0},this.dp=function(e,t){if(e.length>0){var i=0;return e.forEach(function(e,t){i+=e.dp*e.weight}),Math.round(i/t)}return 0},this.newGrain=function(e){this.PPG=e.PPG,this.charandApps=e.charandApps,this.dp=e.dp,this.flavor=e.flavor,this.id=e.id,this.lovi=e.lovi,this.name=e.name,this.weight=e.weight},this.newHop=function(e){this.Alpha_Acid=e.Alpha_Acid,this.Beta_Acid=e.Beta_Acid,this.Name=e.Name,this.Notes=e.Notes,this.Origin=e.Origin,this.Type=e.Type,this.hopTime=e.hopTime,this.hopType=e.hopType,this.weight=e.weight},this.recipe=function(e,t){this.efficiency=65,this.attenuation=70,this.volume=5,this.grains={added:[]},this.hops={added:[],ibu:function(){return t.ibu(e.recipe.hops.added,e.recipe.grains.added,e.recipe.volume,e.recipe.og())}},this.og=function(){return t.efficiencyPPG(t.totalPPG(e.recipe.grains.added,e.recipe.volume),e.recipe.efficiency)},this.fg=function(){return t.fg(e.recipe.grains.added,e.recipe.og(),e.recipe.attenuation)},this.abv=function(){return t.abv(e.recipe.grains.added,e.recipe.og(),e.recipe.fg())},this.srm=function(){return t.srm(e.recipe.grains.added,e.recipe.volume)},this.dp=function(){return t.dp(e.recipe.grains.added,t.totalWeight(e.recipe.grains.added))},this.notes="",this.recipeyeast=e.yeast},this.calculateStats=function(e,t){return e.og=t.efficiencyPPG(t.totalPPG(e.grains.added,e.volume),e.efficiency),e.fg=t.fg(e.grains.added,e.og,e.attenuation),e.abv=t.abv(e.grains.added,e.og,e.fg),e.srm=t.srm(e.grains.added,e.volume),e.dp=t.dp(e.grains.added,t.totalWeight(e.grains.added)),e.hops.ibu=t.ibu(e.hops.added,e.grains.added,e.volume,e.og),e},this.getItem=function(e,t,i){e({method:"GET",url:"/"+i}).then(function(e){t[i]=e.data})},this.saveRecipe=function(e,t,i){console.log("in service");var r={username:t.user.username,name:t.recipe.name,grains:{added:t.recipe.grains.added},efficiency:t.recipe.efficiency,volume:t.recipe.volume,attenuation:t.recipe.attenuation,hops:{added:t.recipe.hops.added},notes:t.notes,yeast:t.yeast};e({method:"post",url:"/private/recipes",data:r}).then(function(e){t.recipe=new i.recipe(t,i)})}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return 1e3*(1+e/100*.04621)/1e3}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJlY2lwZXNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwiand0SW50ZXJjZXB0b3JQcm92aWRlciIsImh0bWw1TW9kZSIsInRva2VuR2V0dGVyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsImRpcmVjdGl2ZSIsInJlcXVpcmUiLCJzY29wZSIsIm90aGVyVmFsIiwibGluayIsImVsZW0iLCJhdHRyIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiaXNNYXRjaCIsIm1vZGVsVmFsIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJyZWNpcGVGdW5jIiwidXNlciIsInJlY2lwZXRlbXBsYXRlIiwicmVjaXBlIiwic2F2ZVJlY2lwZSIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsIm1vZGVsIiwiYWRkZWRJbmdyZWRpZW50IiwibmV3R3JhaW4iLCJuZXdIb3AiLCJhZGRlZCIsImRlbGV0ZUl0ZW0iLCJpbmRleCIsInNwbGljZSIsInVzZXJUb2tlbiIsImRlY29kZVRva2VuIiwiJGxvY2F0aW9uIiwidXNlckxvZ2luIiwibWV0aG9kIiwiZGF0YSIsInVybCIsInRoZW4iLCJyZXMiLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwibG9naW4iLCJ1c2VybmFtZSIsImxvZ2luVXJsIiwibG9nT3V0IiwicmVtb3ZlSXRlbSIsImdldFNhdmVkUmVjaXBlcyIsInJlY2lwZXMiLCJmb3JFYWNoIiwiY2FsY3VsYXRlU3RhdHMiLCJzZXJ2aWNlIiwidGhpcyIsInRvdGFsV2VpZ2h0IiwiaW5ncmVkaWVudHMiLCJ0b3RhbCIsIndlaWdodCIsInBhcnNlSW50IiwidG90YWxQUEciLCJncmFpbnMiLCJ2b2x1bWUiLCJncmFpbiIsIk1hdGgiLCJyb3VuZCIsIlBQRyIsImVmZmljaWVuY3lQUEciLCJlZmZpY2llbmN5IiwiZWZmUFBHIiwidG9TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImlidSIsImhvcHMiLCJvZyIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJob3AiLCJBbHBoYV9BY2lkIiwiaG9wVHlwZSIsImJvaWxURmFjdCIsImhvcFRpbWUiLCJ1dGlsIiwiZmciLCJhdHRlbnVhdGlvbiIsInllYXN0Rm9vZCIsInNybSIsInRvdGFsQ29sb3IiLCJtY3UiLCJsb3ZpIiwiYWJ2IiwiZHAiLCJ0b3RhbGRwIiwiZ3JhaW5PYmoiLCJjaGFyYW5kQXBwcyIsImZsYXZvciIsImlkIiwibmFtZSIsImhvcE9iaiIsIkJldGFfQWNpZCIsIk5hbWUiLCJOb3RlcyIsIk9yaWdpbiIsIlR5cGUiLCJub3RlcyIsInJlY2lwZXllYXN0IiwieWVhc3QiLCJodHRwIiwiaXRlbSIsImNvbnNvbGUiLCJsb2ciLCJjYWxjUHBnIiwiZGJmZyJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxpQkFBQSxhQUFBLFVBQUEsZUFDQUYsS0FBQUcsUUFBQSxpQkFDQSxvQkFDQSxxQkFDQSxnQkFDQSx5QkFDQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxXQUFBLEdBRUFELEVBQUFFLFlBQUEsV0FDQSxNQUFBQyxnQkFBQUMsUUFBQSxjQUVBTCxFQUFBTSxhQUFBQyxLQUFBLGtCQUVBUixFQUFBUyxNQUFBLFdBQ0FDLGVBQUEsU0FDQUMsY0FBQSxVQUVBYixFQUFBYyxLQUFBLEtBQ0FDLFlBQUEsc0JBQ0FDLFdBQUEsZUFDQUYsS0FBQSxjQUNB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QUFHLE9BQUFqQixFQUFBYyxRQUtBdEMsSUFBQTZFLFFBQUEsVUFBQSxXQUNBQyxLQUFBMkQsUUFBQSxTQUFBQyxHQUNBLE1BQUEsTUFBQSxFQUFBQSxFQUFBLElBQUEsUUFBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ3JlY2lwZUNyZWF0b3InLCBbJ25nTWF0ZXJpYWwnLCAnbmdSb3V0ZScsICdhbmd1bGFyLWp3dCddKTtcbiAgYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRsb2NhdGlvblByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRtZFRoZW1pbmdQcm92aWRlcicsXG4gICAgICAgICAgICAgICckaHR0cFByb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJ2p3dEludGVyY2VwdG9yUHJvdmlkZXInLFxuICAgICAgICAgICAgICBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlciwgJGh0dHBQcm92aWRlciwgand0SW50ZXJjZXB0b3JQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgand0SW50ZXJjZXB0b3JQcm92aWRlci50b2tlbkdldHRlciA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfVxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2p3dEludGVyY2VwdG9yJyk7XG5cbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgLnByaW1hcnlQYWxldHRlKCdhbWJlcicpXG4gICAgICAuYWNjZW50UGFsZXR0ZSgneWVsbG93Jyk7XG5cbiAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pLndoZW4oJy9kYnNnX2NhbGMnLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kYnNnY2FsYy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdkYnNnQ2FsYydcbiAgICB9KS53aGVuKCcvbG9naW4nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkNvbnRyb2wnXG4gICAgfSkud2hlbignL3JlZ2lzdGVyJywge1xuICAgICAgdGVtcGxhdGVVcmw6Jy92aWV3cy9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckNvbnRyb2wnXG4gICAgfSkub3RoZXJ3aXNlKCcvJywge1xuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVjaXBlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVNYWtlJ1xuICAgIH0pO1xuICB9XSk7XG4gIGFwcC5kaXJlY3RpdmUoJ2lzTWF0Y2gnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICBzY29wZToge1xuICAgICAgICBvdGhlclZhbDogXCI9aXNNYXRjaFwiXG4gICAgICB9LFxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0sIGF0dHIsIG5nTW9kZWwpIHtcbiAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5pc01hdGNoID0gZnVuY3Rpb24obW9kZWxWYWwpIHtcbiAgICAgICAgICByZXR1cm4gbW9kZWxWYWwgPT09IHNjb3BlLm90aGVyVmFsO1xuICAgICAgICB9O1xuICAgICAgICBzY29wZS4kd2F0Y2goJ290aGVyVmFsJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgLy9jb250cm9sbGVyIGZvciB0aGUgcmVjaXBlIGJ1aWxkZXJcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlY2lwZU1ha2UnLCBbJyRzY29wZScsICckaHR0cCcsICdqd3RIZWxwZXInLCAncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIGp3dEhlbHBlciwgcmVjaXBlRnVuYyl7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvdmlld3Mvbm90bG9nZ2VkaW4uaHRtbCc7XG5cbiAgICAvL2dldCBhbGwgaXRlbXMgbGlzdGVkIGluIHRoZSBzZWxlY3QgbWVudVxuICAgIHJlY2lwZUZ1bmMuZ2V0SXRlbSgkaHR0cCwgJHNjb3BlLCAnZ3JhaW5zJyk7XG4gICAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICdob3BzJyk7XG4gICAgcmVjaXBlRnVuYy5nZXRJdGVtKCRodHRwLCAkc2NvcGUsICd5ZWFzdHMnKTtcblxuICAgIC8vVGhlIG9iamVjdCB1c2VkIGZvciByZWNpcGUgY3JlYXRpb24gYXMgd2VsbCBhcyBjYWxjdWxhdGlvbnNcbiAgICAkc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKCRzY29wZSwgcmVjaXBlRnVuYyk7XG5cbiAgICAvL1NhdmUgZnVuY3Rpb24gZm9yIGJ1dHRvbiBuZy1jbGlja1xuICAgICRzY29wZS5zYXZlUmVjaXBlID0gZnVuY3Rpb24oKXsgcmV0dXJuIHJlY2lwZUZ1bmMuc2F2ZVJlY2lwZSgkaHR0cCwgJHNjb3BlLCByZWNpcGVGdW5jKX07XG5cbiAgICAvL2dlbmVyaWMgZnVuY3Rpb24gdG8gYWRkIGFuIGl0ZW0gdG8gdGhlIGFycmF5IGZvciB0aG9zZSBpbmdyZWRpZW50c1xuICAgICRzY29wZS5hZGRJbmdyZWRpZW50ID0gZnVuY3Rpb24oaW5ncmVkaWVudCwgdHlwZSwgbW9kZWwpe1xuICAgICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnZ3JhaW5zJzpcbiAgICAgICAgICB2YXIgYWRkZWRJbmdyZWRpZW50ID0gbmV3IHJlY2lwZUZ1bmMubmV3R3JhaW4oaW5ncmVkaWVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2hvcHMnOlxuICAgICAgICAgIHZhciBhZGRlZEluZ3JlZGllbnQgPSBuZXcgcmVjaXBlRnVuYy5uZXdIb3AoaW5ncmVkaWVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdmFyIGFkZGVkSW5ncmVkaWVudCA9IHt9O1xuICAgICAgfTtcbiAgICAgICRzY29wZS5yZWNpcGVbdHlwZV0uYWRkZWQucHVzaChhZGRlZEluZ3JlZGllbnQpO1xuICAgICAgJHNjb3BlW21vZGVsXSA9IHt9O1xuICAgIH1cbiAgICAvL3JlbW92ZSBidXR0b24gZnVuY3Rpb24gLSByZW1vdmVzIG9uZSBpdGVtIGZyb20gdGhlIGFycmF5XG4gICAgJHNjb3BlLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbihpbmRleCwgdHlwZSkge1xuICAgICAgJHNjb3BlLnJlY2lwZVt0eXBlXS5hZGRlZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSkge1xuICAgICAgICAgIHZhciB1c2VyVG9rZW4gPSBqd3RIZWxwZXIuZGVjb2RlVG9rZW4oc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpO1xuICAgICAgICAgICRzY29wZS51c2VyID0gdXNlclRva2VuO1xuICAgICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy9wcml2YXRlL3ZpZXdzL3NhdmVkcmVjaXBlcy5odG1sJ1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJHNjb3BlLnVzZXIucmVjaXBldGVtcGxhdGUgPSAnL3ZpZXdzL25vdGxvZ2dlZGluLmh0bWwnXG4gICAgICB9XG4gICAgfSk7XG4gIH1dKTtcbiAgLy9jb250cm9sbGVyIGZvciBsb2dpbiBzY3JlZW4gLSBzZW5kcyB1c2VyL3Bhc3MgYW5kIHN0b3JlcyBqd3RcbiAgYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnVzZXJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9sb2dpbmF1dGgnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGlmKHJlcy5kYXRhLnRva2VuKXtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyVG9rZW4nLCByZXMuZGF0YS50b2tlbik7XG4gICAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XG4gICAgICAgIH07XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUuZXJyb3IgPSByZXMuZGF0YTtcbiAgICAgICAgJHNjb3BlLnVzZXIucGFzc3dvcmQgPSAnJztcbiAgICAgIH0pO1xuICAgIH1cbiAgfV0pO1xuXG5cbiAgLy9jb250cm9sbGVyIGZvciByZWdpc3RlciBwYWdlIC0gc2VuZHMgbmV3IHVzZXIgaW5mbyBhbmQgcmV0dXJucyB0aGF0IGRhdGFcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uKCl7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgICAkbG9jYXRpb24udXJsKCcvbG9naW4nKTtcbiAgICAgIH0sIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcbiAgYXBwLmNvbnRyb2xsZXIoJ2hlYWRlckNvbnRyb2wnLCBbJyRzY29wZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkc2NvcGUsIGp3dEhlbHBlcil7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcblxuICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpe1xuICAgICAgICAkc2NvcGUudXNlciA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSk7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luID0gJ0xvZ291dCAnICsgJHNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy8nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW4gPSAnTG9naW4vUmVnaXN0ZXInO1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpblVybCA9ICcvbG9naW4nXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9O1xuICB9XSk7XG5cbiAgYXBwLmNvbnRyb2xsZXIoJ3NhdmVkUmVjaXBlcycsIFsnJHNjb3BlJywgJyRodHRwJywncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHJlY2lwZUZ1bmMpe1xuICAgICRzY29wZS5nZXRTYXZlZFJlY2lwZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMvc2F2ZWQnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS5yZWNpcGVzID0gcmVzLmRhdGE7XG4gICAgICAgICRzY29wZS5yZWNpcGVzLmZvckVhY2goZnVuY3Rpb24ocmVjaXBlLCBpbmRleCl7XG4gICAgICAgICAgJHNjb3BlLnJlY2lwZXNbaW5kZXhdID0gcmVjaXBlRnVuYy5jYWxjdWxhdGVTdGF0cyhyZWNpcGUsIHJlY2lwZUZ1bmMpO1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9O1xuICB9XSk7XG4iLCJhcHAuc2VydmljZSgncmVjaXBlRnVuYycsIGZ1bmN0aW9uKCl7XG4gIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSB3ZWlnaHQgb2YgYWxsIGdyYWlucyBhZGRlZFxuICB0aGlzLnRvdGFsV2VpZ2h0ID0gZnVuY3Rpb24oaW5ncmVkaWVudHMpe1xuICAgIHZhciB0b3RhbCA9IDA7XG4gICAgaW5ncmVkaWVudHMuZm9yRWFjaChmdW5jdGlvbihpbmdyZWRpZW50KXtcbiAgICAgIGlmKGluZ3JlZGllbnQud2VpZ2h0ID4gMCl7XG4gICAgICAgIHRvdGFsICs9IHBhcnNlSW50KGluZ3JlZGllbnQud2VpZ2h0KTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9O1xuICAvL3RoaXMgY2FsY3VsYXRlcyB0aGUgbWF4IHN1Z2FyIGV4dHJhY3Rpb24gcG9zc2libGUgZnJvbSB0aGUgZ3JhaW5zXG4gIHRoaXMudG90YWxQUEcgPSBmdW5jdGlvbihncmFpbnMsIHZvbHVtZSl7XG4gICAgdmFyIHRvdGFsID0gMDtcbiAgICBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpe1xuICAgICAgdG90YWwgKz0gKE1hdGgucm91bmQoKGdyYWluLlBQRyAtIDEpICogMTAwMCAqIGdyYWluLndlaWdodCAvIHZvbHVtZSkpIC8gMTAwMDtcbiAgICB9KTtcbiAgICByZXR1cm4gdG90YWw7XG4gIH07XG4gIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSBlc3RpbWF0ZWQgc3VnYXIgZXh0cmFjdGlvbiBiYXNlZCBvbiB1c2VyJ3MgZWZmLiBpbnB1dFxuICB0aGlzLmVmZmljaWVuY3lQUEcgPSBmdW5jdGlvbih0b3RhbFBQRywgZWZmaWNpZW5jeSkge1xuICAgIGlmKHRvdGFsUFBHID09PSAwKXtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBlZmZQUEcgPSBNYXRoLnJvdW5kKHRvdGFsUFBHICogKGVmZmljaWVuY3kgLyAxMDApICogMTAwMCkgLyAxMDAwICsgMTtcbiAgICAgICAgaWYoZWZmUFBHID4gMS41KSB7XG4gICAgICAgICAgZWZmUFBHID0gMS41O1xuICAgICAgICB9XG4gICAgICAgIGlmKGVmZlBQRy50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICBlZmZQUEcgPSBlZmZQUEcudG9TdHJpbmcoKS5zbGljZSgwLCA1KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGVmZlBQRztcbiAgICAgIH1cbiAgfTtcbiAgLy9jYWxjdWxhdGVzIGlidSdzIGZvciB1c2VyJ3MgaW5wdXQgaG9wc1xuICB0aGlzLmlidSA9IGZ1bmN0aW9uKGhvcHMsIGdyYWlucywgdm9sdW1lLCBvZykge1xuICAgIGlmKGhvcHMubGVuZ3RoID4gMCAmJiBncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIGlidSA9IDA7XG4gICAgICB2YXIgYWF1ID0gMDtcbiAgICAgIHZhciBiaWdGYWN0ID0gMS42NSAqIE1hdGgucG93KDAuMDAwMTI1LCAob2cgLSAxKSk7XG4gICAgICBob3BzLmZvckVhY2goZnVuY3Rpb24oaG9wKSB7XG4gICAgICAgIGFhdSA9IGhvcC53ZWlnaHQgKiAoaG9wLkFscGhhX0FjaWQgLyAxMDApICogNzQ5MCAvIHZvbHVtZTtcbiAgICAgICAgaWYoaG9wLmhvcFR5cGUgPT0gJ2JvaWwnKSB7XG4gICAgICAgICAgdmFyIGJvaWxURmFjdCA9ICgoMSAtIE1hdGgucG93KDIuNzE4MjgxODI4NDU5MDQ1MjM1MzYsICgtLjA0ICogaG9wLmhvcFRpbWUpKSkgLyAzLjgpO1xuICAgICAgICAgIHZhciB1dGlsID0gYmlnRmFjdCAqIGJvaWxURmFjdDtcbiAgICAgICAgICBpYnUgKz0gdXRpbCAqIGFhdTtcbiAgICAgICAgfSBlbHNlIGlmKGhvcC5ob3BUeXBlID09ICd3aGlybHBvb2wnKSB7XG4gICAgICAgICAgdmFyIHV0aWwgPSAuMTA7XG4gICAgICAgICAgaWJ1ICs9IHV0aWwgKiBhYXVcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZChpYnUgKiAxMDApIC8gMTAwO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfTtcbiAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIGZpbmFsIGdyYXZpdHkgYmFzZWQgb24gYXR0ZW51YXRpb25cbiAgdGhpcy5mZyA9IGZ1bmN0aW9uKGdyYWlucywgb2csIGF0dGVudWF0aW9uKXtcbiAgICBpZihvZyA+IDApIHtcbiAgICAgIHZhciB5ZWFzdEZvb2QgPSBNYXRoLnJvdW5kKCgob2cgLSAxKSAqIDEwMDApICogKGF0dGVudWF0aW9uIC8gMTAwKSkgLyAxMDAwO1xuICAgICAgeWVhc3RGb29kID0gb2cgLSB5ZWFzdEZvb2Q7XG4gICAgICBpZih5ZWFzdEZvb2QudG9TdHJpbmcoKS5sZW5ndGggPiA1KSB7XG4gICAgICAgIHllYXN0Rm9vZCA9IHllYXN0Rm9vZC50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHllYXN0Rm9vZDtcbiAgICB9IGVsc2Uge1xuICAgIHJldHVybiAwXG4gICAgfVxuICB9O1xuICAgICAgLy9lc3RpbWF0ZSBjb2xvciBiYXNlZCBvbiBncmFpbnMgYWRkZWRcbiAgdGhpcy5zcm0gPSBmdW5jdGlvbihncmFpbnMsIHZvbHVtZSl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciB0b3RhbENvbG9yID0gMDtcbiAgICAgIHZhciBtY3UgPSBncmFpbnMuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgdG90YWxDb2xvciArPSAoZ3JhaW4ubG92aSAqIGdyYWluLndlaWdodCk7XG4gICAgICB9KTtcbiAgICAgIG1jdSA9IHRvdGFsQ29sb3IgLyB2b2x1bWU7XG4gICAgICBtY3UgPSBNYXRoLnJvdW5kKCgxLjQ5MjIgKiAoTWF0aC5wb3cobWN1LCAwLjY4NTkpKSkgKiAxMDApIC8gMTAwO1xuICAgICAgaWYobWN1ID4gNTApe1xuICAgICAgICBtY3UgPSA1MDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWN1O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgfTtcbiAgdGhpcy5hYnYgPSBmdW5jdGlvbihncmFpbnMsIG9nLCBmZyl7XG4gICAgaWYoZ3JhaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKCg3Ni4wOCAqIChvZy1mZykgLyAoMS43NzUgLSBvZykpICogKGZnIC8gMC43OTQpICogMTAwKSAvIDEwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDBcbiAgICB9XG4gIH07XG4gIHRoaXMuZHAgPSBmdW5jdGlvbihncmFpbnMsIHRvdGFsV2VpZ2h0KXtcbiAgICBpZihncmFpbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHRvdGFsZHAgPSAwO1xuICAgICAgZ3JhaW5zLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgIHRvdGFsZHAgKz0gZ3JhaW4uZHAgKiBncmFpbi53ZWlnaHQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRvdGFsZHAgLyB0b3RhbFdlaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuICB0aGlzLm5ld0dyYWluID0gZnVuY3Rpb24oZ3JhaW5PYmopIHtcbiAgICB0aGlzLlBQRyA9IGdyYWluT2JqLlBQRztcbiAgICB0aGlzLmNoYXJhbmRBcHBzID0gZ3JhaW5PYmouY2hhcmFuZEFwcHM7XG4gICAgdGhpcy5kcCA9IGdyYWluT2JqLmRwO1xuICAgIHRoaXMuZmxhdm9yID0gZ3JhaW5PYmouZmxhdm9yO1xuICAgIHRoaXMuaWQgPSBncmFpbk9iai5pZDtcbiAgICB0aGlzLmxvdmkgPSBncmFpbk9iai5sb3ZpO1xuICAgIHRoaXMubmFtZSA9IGdyYWluT2JqLm5hbWU7XG4gICAgdGhpcy53ZWlnaHQ9IGdyYWluT2JqLndlaWdodDtcbiAgfTtcbiAgdGhpcy5uZXdIb3AgPSBmdW5jdGlvbihob3BPYmopIHtcbiAgICB0aGlzLkFscGhhX0FjaWQgPSBob3BPYmouQWxwaGFfQWNpZDtcbiAgICB0aGlzLkJldGFfQWNpZCA9IGhvcE9iai5CZXRhX0FjaWQ7XG4gICAgdGhpcy5OYW1lID0gaG9wT2JqLk5hbWU7XG4gICAgdGhpcy5Ob3RlcyA9IGhvcE9iai5Ob3RlcztcbiAgICB0aGlzLk9yaWdpbiA9IGhvcE9iai5PcmlnaW47XG4gICAgdGhpcy5UeXBlID0gaG9wT2JqLlR5cGU7XG4gICAgdGhpcy5ob3BUaW1lID0gaG9wT2JqLmhvcFRpbWU7XG4gICAgdGhpcy5ob3BUeXBlID0gaG9wT2JqLmhvcFR5cGU7XG4gICAgdGhpcy53ZWlnaHQgPSBob3BPYmoud2VpZ2h0O1xuICB9O1xuICB0aGlzLnJlY2lwZSA9IGZ1bmN0aW9uKHNjb3BlLCByZWNpcGVGdW5jKSB7XG4gICAgdGhpcy5lZmZpY2llbmN5ID0gNjU7XG4gICAgdGhpcy5hdHRlbnVhdGlvbiA9IDcwO1xuICAgIHRoaXMudm9sdW1lID0gNTtcbiAgICB0aGlzLmdyYWlucyA9IHtcbiAgICAgIGFkZGVkOiBbXVxuICAgIH07XG4gICAgdGhpcy5ob3BzID0ge1xuICAgICAgYWRkZWQ6IFtdLFxuICAgICAgaWJ1OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5pYnUoc2NvcGUucmVjaXBlLmhvcHMuYWRkZWQsIHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUsIHNjb3BlLnJlY2lwZS5vZygpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMub2cgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZWZmaWNpZW5jeVBQRyhyZWNpcGVGdW5jLnRvdGFsUFBHKHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQsIHNjb3BlLnJlY2lwZS52b2x1bWUpLCBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSlcbiAgICB9O1xuICAgIHRoaXMuZmcgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZmcoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLm9nKCksIHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbilcbiAgICB9O1xuICAgIHRoaXMuYWJ2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiByZWNpcGVGdW5jLmFidihzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLCBzY29wZS5yZWNpcGUub2coKSwgc2NvcGUucmVjaXBlLmZnKCkpO1xuICAgICAgfTtcbiAgICB0aGlzLnNybSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVjaXBlRnVuYy5zcm0oc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgc2NvcGUucmVjaXBlLnZvbHVtZSk7XG4gICAgICB9O1xuICAgIHRoaXMuZHAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHJlY2lwZUZ1bmMuZHAoc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgICB9O1xuICAgIHRoaXMubm90ZXMgPSAnJztcbiAgICB0aGlzLnJlY2lwZXllYXN0ID0gIHNjb3BlLnllYXN0O1xuICB9O1xuXG4gIHRoaXMuY2FsY3VsYXRlU3RhdHMgPSBmdW5jdGlvbihyZWNpcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICByZWNpcGUub2cgPSByZWNpcGVGdW5jLmVmZmljaWVuY3lQUEcocmVjaXBlRnVuYy50b3RhbFBQRyhyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUudm9sdW1lKSwgcmVjaXBlLmVmZmljaWVuY3kpO1xuICAgIHJlY2lwZS5mZyA9IHJlY2lwZUZ1bmMuZmcocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlLm9nLCByZWNpcGUuYXR0ZW51YXRpb24pO1xuICAgIHJlY2lwZS5hYnYgPSByZWNpcGVGdW5jLmFidihyZWNpcGUuZ3JhaW5zLmFkZGVkLCByZWNpcGUub2csIHJlY2lwZS5mZyk7XG4gICAgcmVjaXBlLnNybSA9IHJlY2lwZUZ1bmMuc3JtKHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUpO1xuICAgIHJlY2lwZS5kcCA9IHJlY2lwZUZ1bmMuZHAocmVjaXBlLmdyYWlucy5hZGRlZCwgcmVjaXBlRnVuYy50b3RhbFdlaWdodChyZWNpcGUuZ3JhaW5zLmFkZGVkKSk7XG4gICAgcmVjaXBlLmhvcHMuaWJ1ID0gcmVjaXBlRnVuYy5pYnUocmVjaXBlLmhvcHMuYWRkZWQsIHJlY2lwZS5ncmFpbnMuYWRkZWQsIHJlY2lwZS52b2x1bWUsIHJlY2lwZS5vZyk7XG4gICAgcmV0dXJuIHJlY2lwZTtcbiAgfTtcbiAgdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24oaHR0cCwgc2NvcGUsIGl0ZW0pIHtcbiAgICBodHRwKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICB1cmw6ICcvJyArIGl0ZW1cbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgICAgc2NvcGVbaXRlbV0gPSByZXMuZGF0YTtcbiAgICB9KTtcbiAgfTtcbiAgdGhpcy5zYXZlUmVjaXBlID0gZnVuY3Rpb24oaHR0cCwgc2NvcGUsIHJlY2lwZUZ1bmMpIHtcbiAgICBjb25zb2xlLmxvZygnaW4gc2VydmljZScpXG4gICAgdmFyIHJlY2lwZSA9IHtcbiAgICAgIHVzZXJuYW1lOiBzY29wZS51c2VyLnVzZXJuYW1lLFxuICAgICAgbmFtZTogc2NvcGUucmVjaXBlLm5hbWUsXG4gICAgICBncmFpbnM6IHtcbiAgICAgICAgYWRkZWQ6IHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWRcbiAgICAgIH0sXG4gICAgICBlZmZpY2llbmN5OiBzY29wZS5yZWNpcGUuZWZmaWNpZW5jeSxcbiAgICAgIHZvbHVtZTogc2NvcGUucmVjaXBlLnZvbHVtZSxcbiAgICAgIGF0dGVudWF0aW9uOiBzY29wZS5yZWNpcGUuYXR0ZW51YXRpb24sXG4gICAgICBob3BzOiB7XG4gICAgICAgIGFkZGVkOiBzY29wZS5yZWNpcGUuaG9wcy5hZGRlZFxuICAgICAgfSxcbiAgICAgIG5vdGVzOiBzY29wZS5ub3RlcyxcbiAgICAgIHllYXN0OiBzY29wZS55ZWFzdFxuICAgIH07XG4gICAgaHR0cCh7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIHVybDogJy9wcml2YXRlL3JlY2lwZXMnLFxuICAgICAgZGF0YTogcmVjaXBlXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgc2NvcGUucmVjaXBlID0gbmV3IHJlY2lwZUZ1bmMucmVjaXBlKHNjb3BlLCByZWNpcGVGdW5jKTtcbiAgICB9KVxuICB9XG59KTtcblxuYXBwLnNlcnZpY2UoJ1BwZ0NhbGMnLCBmdW5jdGlvbiAoKXtcbiAgdGhpcy5jYWxjUHBnID0gZnVuY3Rpb24oZGJmZykge1xuICAgIHJldHVybiAoMTAwMCAqICgxICsgKGRiZmcgLyAxMDApICogMC4wNDYyMSkpIC8gMTAwMFxuICB9XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==