var app=angular.module("recipeCreator",["ngMaterial","ngRoute","angular-jwt"]);app.config(["$routeProvider","$locationProvider","$mdThemingProvider","$httpProvider","jwtInterceptorProvider",function(e,t,r,n,o){t.html5Mode(!0),o.tokenGetter=function(){return sessionStorage.getItem("userToken")},n.interceptors.push("jwtInterceptor"),r.theme("default").primaryPalette("amber").accentPalette("yellow"),e.when("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"}).when("/dbsg_calc",{templateUrl:"/views/dbsgcalc.html",controller:"dbsgCalc"}).when("/login",{templateUrl:"/views/login.html",controller:"loginControl"}).when("/register",{templateUrl:"/views/register.html",controller:"registerControl"}).otherwise("/",{templateUrl:"/views/recipes.html",controller:"recipeMake"})}]),app.directive("isMatch",function(){return{require:"ngModel",scope:{otherVal:"=isMatch"},link:function(e,t,r,n){n.$validators.isMatch=function(t){return t===e.otherVal},e.$watch("otherVal",function(){n.$validate()})}}}),app.service("PpgCalc",function(){this.calcPpg=function(e){return 1e3*(1+e/100*.04621)/1e3}}),app.controller("recipeMake",["$scope","$http","jwtHelper",function(e,t,r){function n(r){t({method:"GET",url:"/"+r}).then(function(t){e[r]=t.data})}e.user={},e.user.recipetemplate="/views/notloggedin.html",n("grains"),n("hops"),n("yeasts"),e.recipe={name:"",grains:{totalWeight:function(){var t=0;return e.recipe.grains.added.forEach(function(e,r){e.grainWt>0&&(t+=parseInt(e.grainWt))}),t},totalPPG:function(){var t=0;return e.recipe.grains.added.forEach(function(r,n){t+=Math.round(1e3*(r.PPG-1)*r.grainWt/e.recipe.volume)/1e3}),t},efficiencyPPG:function(){var t=Math.round(e.recipe.grains.totalPPG()*(e.recipe.efficiency/100)*1e3)/1e3+1;return t>1.5&&(t=1.5),t.toString().length>5&&(t=t.toString().slice(0,5)),t},added:[]},efficiency:65,attenuation:70,volume:5,hops:{added:[],ibu:function(){if(e.recipe.hops.added.length>0&&e.recipe.grains.added.length>0){var t=0,r=0,n=1.65*Math.pow(125e-6,e.recipe.og()-1);return e.recipe.hops.added.forEach(function(o){if(r=o.hopWt*(o.Alpha_Acid/100)*7490/e.recipe.volume,"boil"==o.hopType){var i=(1-Math.pow(2.718281828459045,-.04*o.hopTime))/3.8,a=n*i;t+=a*r}else if("whirlpool"==o.hopType){var a=.1;t+=a*r}}),Math.round(100*t)/100}return 0}},og:function(){return e.recipe.grains.added.length>0?e.recipe.grains.efficiencyPPG():0},fg:function(){if(e.recipe.grains.added.length>0){var t=Math.round(1e3*(e.recipe.grains.efficiencyPPG()-1)*(e.recipe.attenuation/100))/1e3;return t=e.recipe.og()-t,t.toString().length>5&&(t=t.toString().slice(0,5)),t}return 0},abv:function(){if(e.recipe.grains.added.length>0){var t=e.recipe.og(),r=e.recipe.fg();return Math.round(76.08*(t-r)/(1.775-t)*(r/.794)*100)/100}return 0},srm:function(){if(e.recipe.grains.added.length>0){var t=0,r=e.recipe.grains.added.forEach(function(e,r){t+=e.lovi*e.grainWt});return r=t/e.recipe.volume,r=Math.round(1.4922*Math.pow(r,.6859)*100)/100,r>50&&(r=50),r}return 0},dp:function(){if(e.recipe.grains.added.length>0){var t=0;return e.recipe.grains.added.forEach(function(e,r){t+=e.dp*e.grainWt}),Math.round(t/e.recipe.grains.totalWeight())}return 0},notes:"",yeast:e.yeast},e.saveRecipe=function(){var r={username:e.user.username,name:e.recipe.name,grains:{added:e.recipe.grains.added},efficiency:e.recipe.efficiency,volume:e.recipe.volume,attenuation:e.recipe.attenuation,hops:{added:e.recipe.hops.added},notes:e.notes};t({method:"post",url:"/private/recipes",data:r}).then(function(e){console.log(e.data)})},e.getSavedRecipes=function(){t({method:"post",url:"/private/recipes/saved"}).then(function(e){console.log(e.data)})},e.addIngredient=function(t,r){e.recipe[t].added.push(e[r]),e[r]={}},e.deleteItem=function(t,r){e.recipe[r].added.splice(t,1)},e.$watch(function(){return sessionStorage.getItem("userToken")},function(){if(sessionStorage.getItem("userToken")){var t=r.decodeToken(sessionStorage.getItem("userToken"));e.user=t,e.user.recipetemplate="/private/views/savedrecipes.html"}else e.user={},e.user.recipetemplate="/views/notloggedin.html"})}]),app.controller("dbsgCalc",["$scope",function(e){console.log("clicked"),console.log(e.dbfg+e.name)}]),app.controller("loginControl",["$rootScope","$scope","$http","$location",function(e,t,r,n){t.userLogin=function(){r({method:"post",data:t.user,url:"/loginauth"}).then(function(e){e.data.token&&(sessionStorage.setItem("userToken",e.data.token),t.user={},n.url("/"))},function(e){t.error=e.data,t.user.password=""})}}]),app.controller("registerControl",["$scope","$http","$location",function(e,t,r){e.registerUser=function(){t({method:"post",data:e.user,url:"/register"}).then(function(t){e.user=t.data,r.url("/login")},function(t){e.user=t.data})}}]),app.controller("headerControl",["$rootScope","$scope","jwtHelper",function(e,t,r){t.user={},t.$watch(function(){return sessionStorage.getItem("userToken")},function(){sessionStorage.getItem("userToken")?(t.user=r.decodeToken(sessionStorage.getItem("userToken")),t.user.login="Logout "+t.user.username,t.user.loginUrl="/"):(t.user={},t.user.login="Login/Register",t.user.loginUrl="/login")}),t.logOut=function(){sessionStorage.removeItem("userToken")}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJqd3RJbnRlcmNlcHRvclByb3ZpZGVyIiwiaHRtbDVNb2RlIiwidG9rZW5HZXR0ZXIiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwidGhlbWUiLCJwcmltYXJ5UGFsZXR0ZSIsImFjY2VudFBhbGV0dGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib3RoZXJ3aXNlIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJWYWwiLCJsaW5rIiwiZWxlbSIsImF0dHIiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJpc01hdGNoIiwibW9kZWxWYWwiLCIkd2F0Y2giLCIkdmFsaWRhdGUiLCJzZXJ2aWNlIiwidGhpcyIsImNhbGNQcGciLCJkYmZnIiwiJHNjb3BlIiwiJGh0dHAiLCJqd3RIZWxwZXIiLCJpdGVtIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlcyIsImRhdGEiLCJ1c2VyIiwicmVjaXBldGVtcGxhdGUiLCJyZWNpcGUiLCJuYW1lIiwiZ3JhaW5zIiwidG90YWxXZWlnaHQiLCJ0b3RhbCIsImFkZGVkIiwiZm9yRWFjaCIsImdyYWluIiwiaW5kZXgiLCJncmFpbld0IiwicGFyc2VJbnQiLCJ0b3RhbFBQRyIsIk1hdGgiLCJyb3VuZCIsIlBQRyIsInZvbHVtZSIsImVmZmljaWVuY3lQUEciLCJlZmZQUEciLCJlZmZpY2llbmN5IiwidG9TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImF0dGVudWF0aW9uIiwiaG9wcyIsImlidSIsImFhdSIsImJpZ0ZhY3QiLCJwb3ciLCJvZyIsImhvcCIsImhvcFd0IiwiQWxwaGFfQWNpZCIsImhvcFR5cGUiLCJib2lsVEZhY3QiLCJob3BUaW1lIiwidXRpbCIsImZnIiwieWVhc3RGb29kIiwiYWJ2Iiwic3JtIiwidG90YWxDb2xvciIsIm1jdSIsImxvdmkiLCJkcCIsInRvdGFsZHAiLCJub3RlcyIsInllYXN0Iiwic2F2ZVJlY2lwZSIsInVzZXJuYW1lIiwiY29uc29sZSIsImxvZyIsImdldFNhdmVkUmVjaXBlcyIsImFkZEluZ3JlZGllbnQiLCJpbmdyZWRpZW50IiwidHlwZSIsImRlbGV0ZUl0ZW0iLCJzcGxpY2UiLCJ1c2VyVG9rZW4iLCJkZWNvZGVUb2tlbiIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJ1c2VyTG9naW4iLCJ0b2tlbiIsInNldEl0ZW0iLCJlcnJvciIsInBhc3N3b3JkIiwicmVnaXN0ZXJVc2VyIiwibG9naW4iLCJsb2dpblVybCIsImxvZ091dCIsInJlbW92ZUl0ZW0iXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsaUJBQUEsYUFBQSxVQUFBLGVBQ0FGLEtBQUFHLFFBQUEsaUJBQ0Esb0JBQ0EscUJBQ0EsZ0JBQ0EseUJBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUgsRUFBQUksV0FBQSxHQUVBRCxFQUFBRSxZQUFBLFdBQ0EsTUFBQUMsZ0JBQUFDLFFBQUEsY0FFQUwsRUFBQU0sYUFBQUMsS0FBQSxrQkFFQVIsRUFBQVMsTUFBQSxXQUNBQyxlQUFBLFNBQ0FDLGNBQUEsVUFFQWIsRUFBQWMsS0FBQSxLQUNBQyxZQUFBLHNCQUNBQyxXQUFBLGVBQ0FGLEtBQUEsY0FDQUMsWUFBQSx1QkFDQUMsV0FBQSxhQUNBRixLQUFBLFVBQ0FDLFlBQUEsb0JBQ0FDLFdBQUEsaUJBQ0FGLEtBQUEsYUFDQUMsWUFBQSx1QkFDQUMsV0FBQSxvQkFDQUMsVUFBQSxLQUNBRixZQUFBLHNCQUNBQyxXQUFBLGtCQUdBcEIsSUFBQXNCLFVBQUEsVUFBQSxXQUNBLE9BQ0FDLFFBQUEsVUFDQUMsT0FDQUMsU0FBQSxZQUVBQyxLQUFBLFNBQUFGLEVBQUFHLEVBQUFD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QUFBQyxLQUFBaUUsUUFDQXJHLGVBQUFzRyxRQUFBLFlBQUFuRSxFQUFBQyxLQUFBaUUsT0FDQXpFLEVBQUFTLFFBQ0E4RCxFQUFBbEUsSUFBQSxPQUVBLFNBQUFFLEdBQ0FQLEVBQUEyRSxNQUFBcEUsRUFBQUMsS0FDQVIsRUFBQVMsS0FBQW1FLFNBQUEsU0FPQW5ILElBQUFvQixXQUFBLG1CQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFtQixFQUFBQyxFQUFBc0UsR0FDQXZFLEVBQUE2RSxhQUFBLFdBQ0E1RSxHQUNBRyxPQUFBLE9BQ0FJLEtBQUFSLEVBQUFTLEtBQ0FKLElBQUEsY0FDQUMsS0FBQSxTQUFBQyxHQUNBUCxFQUFBUyxLQUFBRixFQUFBQyxLQUNBK0QsRUFBQWxFLElBQUEsV0FDQSxTQUFBRSxHQUNBUCxFQUFBUyxLQUFBRixFQUFBQyxXQUlBL0MsSUFBQW9CLFdBQUEsaUJBQUEsYUFBQSxTQUFBLFlBQUEsU0FBQXlGLEVBQUF0RSxFQUFBRSxHQUNBRixFQUFBUyxRQUVBVCxFQUFBTixPQUFBLFdBQ0EsTUFBQXRCLGdCQUFBQyxRQUFBLGNBQ0EsV0FDQUQsZUFBQUMsUUFBQSxjQUNBMkIsRUFBQVMsS0FBQVAsRUFBQW1FLFlBQUFqRyxlQUFBQyxRQUFBLGNBQ0EyQixFQUFBUyxLQUFBcUUsTUFBQSxVQUFBOUUsRUFBQVMsS0FBQWtELFNBQ0EzRCxFQUFBUyxLQUFBc0UsU0FBQSxNQUVBL0UsRUFBQVMsUUFDQVQsRUFBQVMsS0FBQXFFLE1BQUEsaUJBQ0E5RSxFQUFBUyxLQUFBc0UsU0FBQSxZQUlBL0UsRUFBQWdGLE9BQUEsV0FDQTVHLGVBQUE2RyxXQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgncmVjaXBlQ3JlYXRvcicsIFsnbmdNYXRlcmlhbCcsICduZ1JvdXRlJywgJ2FuZ3VsYXItand0J10pO1xuICBhcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnJG1kVGhlbWluZ1Byb3ZpZGVyJyxcbiAgICAgICAgICAgICAgJyRodHRwUHJvdmlkZXInLFxuICAgICAgICAgICAgICAnand0SW50ZXJjZXB0b3JQcm92aWRlcicsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCBqd3RJbnRlcmNlcHRvclByb3ZpZGVyKXtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICBqd3RJbnRlcmNlcHRvclByb3ZpZGVyLnRva2VuR2V0dGVyID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKTtcbiAgICB9XG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnand0SW50ZXJjZXB0b3InKTtcblxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXG4gICAgICAucHJpbWFyeVBhbGV0dGUoJ2FtYmVyJylcbiAgICAgIC5hY2NlbnRQYWxldHRlKCd5ZWxsb3cnKTtcblxuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSkud2hlbignL2Ric2dfY2FsYycsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Ric2djYWxjLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2Ric2dDYWxjJ1xuICAgIH0pLndoZW4oJy9sb2dpbicsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ29udHJvbCdcbiAgICB9KS53aGVuKCcvcmVnaXN0ZXInLCB7XG4gICAgICB0ZW1wbGF0ZVVybDonL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlZ2lzdGVyQ29udHJvbCdcbiAgICB9KS5vdGhlcndpc2UoJy8nLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWNpcGVzLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ3JlY2lwZU1ha2UnXG4gICAgfSk7XG4gIH1dKTtcbiAgYXBwLmRpcmVjdGl2ZSgnaXNNYXRjaCcsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIG90aGVyVmFsOiBcIj1pc01hdGNoXCJcbiAgICAgIH0sXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0ciwgbmdNb2RlbCkge1xuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmlzTWF0Y2ggPSBmdW5jdGlvbihtb2RlbFZhbCkge1xuICAgICAgICAgIHJldHVybiBtb2RlbFZhbCA9PT0gc2NvcGUub3RoZXJWYWw7XG4gICAgICAgIH07XG4gICAgICAgIHNjb3BlLiR3YXRjaCgnb3RoZXJWYWwnLCBmdW5jdGlvbigpe1xuICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xuICBhcHAuc2VydmljZSgnUHBnQ2FsYycsIGZ1bmN0aW9uICgpe1xuICAgIHRoaXMuY2FsY1BwZyA9IGZ1bmN0aW9uKGRiZmcpIHtcbiAgICAgIHJldHVybiAoMTAwMCAqICgxICsgKGRiZmcgLyAxMDApICogMC4wNDYyMSkpIC8gMTAwMFxuICAgIH1cbiAgfSk7XG4gIC8vY29udHJvbGxlciBmb3IgdGhlIHJlY2lwZSBidWlsZGVyXG4gIGFwcC5jb250cm9sbGVyKCdyZWNpcGVNYWtlJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnand0SGVscGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgand0SGVscGVyKXtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJztcbiAgICAvL2dldCBhbGwgaXRlbXMgbGlzdGVkIGluIHRoZSBzZWxlY3QgbWVudVxuICAgIGdldEl0ZW0oJ2dyYWlucycpO1xuICAgIGdldEl0ZW0oJ2hvcHMnKTtcbiAgICBnZXRJdGVtKCd5ZWFzdHMnKTtcbiAgICAvL1RoZSBvYmplY3QgdXNlZCBmb3IgcmVjaXBlIGNyZWF0aW9uIGFzIHdlbGwgYXMgY2FsY3VsYXRpb25zXG4gICAgJHNjb3BlLnJlY2lwZSA9IHtcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgZ3JhaW5zOiB7XG4gICAgICAgIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSB3ZWlnaHQgb2YgYWxsIGdyYWlucyBhZGRlZFxuICAgICAgICB0b3RhbFdlaWdodDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHRvdGFsID0gMDtcbiAgICAgICAgICAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZC5mb3JFYWNoKGZ1bmN0aW9uKGdyYWluLCBpbmRleCkge1xuICAgICAgICAgICAgaWYoZ3JhaW4uZ3JhaW5XdCA+IDApe1xuICAgICAgICAgICAgICB0b3RhbCArPSBwYXJzZUludChncmFpbi5ncmFpbld0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIHJldHVybiB0b3RhbDtcbiAgICAgICAgfSxcbiAgICAgICAgLy90aGlzIGNhbGN1bGF0ZXMgdGhlIG1heCBzdWdhciBleHRyYWN0aW9uIHBvc3NpYmxlIGZyb20gdGhlIGdyYWluc1xuICAgICAgICB0b3RhbFBQRzogZnVuY3Rpb24oKXtcbiAgICAgICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgICAgICRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KXtcbiAgICAgICAgICAgIHRvdGFsICs9IChNYXRoLnJvdW5kKChncmFpbi5QUEcgLSAxKSAqIDEwMDAgKiBncmFpbi5ncmFpbld0IC8gJHNjb3BlLnJlY2lwZS52b2x1bWUpKSAvIDEwMDA7XG4gICAgICAgICAgfSlcbiAgICAgICAgICByZXR1cm4gdG90YWw7XG4gICAgICAgIH0sXG4gICAgICAgIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSBlc3RpbWF0ZWQgc3VnYXIgZXh0cmFjdGlvbiBiYXNlZCBvbiB1c2VyJ3MgZWZmLiBpbnB1dFxuICAgICAgICBlZmZpY2llbmN5UFBHOiBmdW5jdGlvbigpe1xuICAgICAgICAgIHZhciBlZmZQUEcgPSBNYXRoLnJvdW5kKCRzY29wZS5yZWNpcGUuZ3JhaW5zLnRvdGFsUFBHKCkgKiAoJHNjb3BlLnJlY2lwZS5lZmZpY2llbmN5IC8gMTAwKSAqIDEwMDApIC8gMTAwMCArIDE7XG4gICAgICAgICAgaWYoZWZmUFBHID4gMS41KSB7XG4gICAgICAgICAgICBlZmZQUEcgPSAxLjU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGVmZlBQRy50b1N0cmluZygpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICAgIGVmZlBQRyA9IGVmZlBQRy50b1N0cmluZygpLnNsaWNlKDAsIDUpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIGVmZlBQRztcbiAgICAgICAgfSxcbiAgICAgICAgLy9saXN0IG9mIGFsbCBncmFpbnMgYWRkZWRcbiAgICAgICAgYWRkZWQ6IFtdXG4gICAgICB9LFxuICAgICAgLy9kZWZhdWx0IGlucHV0cyBmb3IgZWZmaWNpZW5jeSwgYXR0ZW51YXRpb24sIGFuZCB2b2x1bWVcbiAgICAgIGVmZmljaWVuY3k6IDY1LFxuICAgICAgYXR0ZW51YXRpb246IDcwLFxuICAgICAgdm9sdW1lOiA1LFxuICAgICAgaG9wczoge1xuICAgICAgICAvL2xpc3Qgb2YgYWxsIGhvcHMgYWRkZWRcbiAgICAgICAgYWRkZWQ6IFtdLFxuICAgICAgICAvL2NhbGN1bGF0ZXMgaWJ1J3MgZm9yIHVzZXIncyBpbnB1dCBob3BzXG4gICAgICAgIGlidTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoJHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkLmxlbmd0aCA+IDAgJiYgJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIGlidSA9IDA7XG4gICAgICAgICAgICB2YXIgYWF1ID0gMDtcbiAgICAgICAgICAgIHZhciBiaWdGYWN0ID0gMS42NSAqIE1hdGgucG93KDAuMDAwMTI1LCAoJHNjb3BlLnJlY2lwZS5vZygpIC0gMSkpO1xuICAgICAgICAgICAgJHNjb3BlLnJlY2lwZS5ob3BzLmFkZGVkLmZvckVhY2goZnVuY3Rpb24oaG9wKSB7XG4gICAgICAgICAgICAgIGFhdSA9IGhvcC5ob3BXdCAqIChob3AuQWxwaGFfQWNpZCAvIDEwMCkgKiA3NDkwIC8gJHNjb3BlLnJlY2lwZS52b2x1bWU7XG4gICAgICAgICAgICAgIGlmKGhvcC5ob3BUeXBlID09ICdib2lsJykge1xuICAgICAgICAgICAgICAgIHZhciBib2lsVEZhY3QgPSAoKDEgLSBNYXRoLnBvdygyLjcxODI4MTgyODQ1OTA0NTIzNTM2LCAoLS4wNCAqIGhvcC5ob3BUaW1lKSkpIC8gMy44KTtcbiAgICAgICAgICAgICAgICB2YXIgdXRpbCA9IGJpZ0ZhY3QgKiBib2lsVEZhY3Q7XG4gICAgICAgICAgICAgICAgaWJ1ICs9IHV0aWwgKiBhYXU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZihob3AuaG9wVHlwZSA9PSAnd2hpcmxwb29sJykge1xuICAgICAgICAgICAgICAgIHZhciB1dGlsID0gLjEwO1xuICAgICAgICAgICAgICAgIGlidSArPSB1dGlsICogYWF1XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoaWJ1ICogMTAwKSAvIDEwMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL3RoaXMgaXMgdGhlIGZ1bmN0aW9uIHRvIHN0b3JlIHRoZSBPRyBvbiB0aGUgcGFnZVxuICAgICAgb2c6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZigkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuICRzY29wZS5yZWNpcGUuZ3JhaW5zLmVmZmljaWVuY3lQUEcoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vdGhpcyBjYWxjdWxhdGVzIHRoZSBmaW5hbCBncmF2aXR5IGJhc2VkIG9uIGF0dGVudWF0aW9uXG4gICAgICBmZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgeWVhc3RGb29kID0gTWF0aC5yb3VuZCgoKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmVmZmljaWVuY3lQUEcoKSAtIDEpICogMTAwMCkgKiAoJHNjb3BlLnJlY2lwZS5hdHRlbnVhdGlvbiAvIDEwMCkpIC8gMTAwMDtcbiAgICAgICAgICB5ZWFzdEZvb2QgPSAkc2NvcGUucmVjaXBlLm9nKCkgLSB5ZWFzdEZvb2Q7XG4gICAgICAgICAgaWYoeWVhc3RGb29kLnRvU3RyaW5nKCkubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgeWVhc3RGb29kID0geWVhc3RGb29kLnRvU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB5ZWFzdEZvb2Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAwXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL2FidiBjYWxjIGJhc2VkIG9uIGVzdGltYXRlZCBPRyBhbmQgRkdcbiAgICAgIGFidjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgb2cgPSAkc2NvcGUucmVjaXBlLm9nKCksXG4gICAgICAgICAgICAgIGZnID0gJHNjb3BlLnJlY2lwZS5mZygpO1xuICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKCg3Ni4wOCAqIChvZy1mZykgLyAoMS43NzUgLSBvZykpICogKGZnIC8gMC43OTQpICogMTAwKSAvIDEwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9lc3RpbWF0ZSBjb2xvciBiYXNlZCBvbiBncmFpbnMgYWRkZWRcbiAgICAgIHNybTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgdG90YWxDb2xvciA9IDA7XG4gICAgICAgICAgdmFyIG1jdSA9ICRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmZvckVhY2goZnVuY3Rpb24oZ3JhaW4sIGluZGV4KSB7XG4gICAgICAgICAgICB0b3RhbENvbG9yICs9IChncmFpbi5sb3ZpICogZ3JhaW4uZ3JhaW5XdCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbWN1ID0gdG90YWxDb2xvciAvICRzY29wZS5yZWNpcGUudm9sdW1lO1xuICAgICAgICAgIG1jdSA9IE1hdGgucm91bmQoKDEuNDkyMiAqIChNYXRoLnBvdyhtY3UsIDAuNjg1OSkpKSAqIDEwMCkgLyAxMDA7XG4gICAgICAgICAgaWYobWN1ID4gNTApe1xuICAgICAgICAgICAgbWN1ID0gNTA7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gbWN1O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9lc3RpbWF0ZSBlbnp5bWF0aWMgYWN0aXZpdHkgYmFzZWQgb24gZ3JhaW5zIGFkZGVkXG4gICAgICBkcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCRzY29wZS5yZWNpcGUuZ3JhaW5zLmFkZGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgdG90YWxkcCA9IDA7XG4gICAgICAgICAgJHNjb3BlLnJlY2lwZS5ncmFpbnMuYWRkZWQuZm9yRWFjaChmdW5jdGlvbihncmFpbiwgaW5kZXgpIHtcbiAgICAgICAgICAgIHRvdGFsZHAgKz0gZ3JhaW4uZHAgKiBncmFpbi5ncmFpbld0O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRvdGFsZHAgLyAkc2NvcGUucmVjaXBlLmdyYWlucy50b3RhbFdlaWdodCgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG5vdGVzOiAnJyxcbiAgICAgIHllYXN0OiAkc2NvcGUueWVhc3RcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNhdmVSZWNpcGUgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIHJlY2lwZSA9IHtcbiAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VyLnVzZXJuYW1lLFxuICAgICAgICBuYW1lOiAkc2NvcGUucmVjaXBlLm5hbWUsXG4gICAgICAgIGdyYWluczoge1xuICAgICAgICAgIGFkZGVkOiAkc2NvcGUucmVjaXBlLmdyYWlucy5hZGRlZFxuICAgICAgICB9LFxuICAgICAgICBlZmZpY2llbmN5OiAkc2NvcGUucmVjaXBlLmVmZmljaWVuY3ksXG4gICAgICAgIHZvbHVtZTogJHNjb3BlLnJlY2lwZS52b2x1bWUsXG4gICAgICAgIGF0dGVudWF0aW9uOiAkc2NvcGUucmVjaXBlLmF0dGVudWF0aW9uLFxuICAgICAgICBob3BzOiB7XG4gICAgICAgICAgYWRkZWQ6ICRzY29wZS5yZWNpcGUuaG9wcy5hZGRlZFxuICAgICAgICB9LFxuICAgICAgICBub3RlczogJHNjb3BlLm5vdGVzXG4gICAgICB9O1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgdXJsOiAnL3ByaXZhdGUvcmVjaXBlcycsXG4gICAgICAgIGRhdGE6IHJlY2lwZVxuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICB9KVxuICAgIH1cbiAgICAkc2NvcGUuZ2V0U2F2ZWRSZWNpcGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICB1cmw6ICcvcHJpdmF0ZS9yZWNpcGVzL3NhdmVkJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICB9KVxuICAgIH07XG4gICAgLy9nZW5lcmljIGZ1bmN0aW9uIHRvIGFkZCBhbiBpdGVtIHRvIHRoZSBhcnJheSBmb3IgdGhvc2UgaW5ncmVkaWVudHNcbiAgICAkc2NvcGUuYWRkSW5ncmVkaWVudCA9IGZ1bmN0aW9uKGluZ3JlZGllbnQsIHR5cGUpe1xuICAgICAgJHNjb3BlLnJlY2lwZVtpbmdyZWRpZW50XS5hZGRlZC5wdXNoKCRzY29wZVt0eXBlXSk7XG4gICAgICAkc2NvcGVbdHlwZV0gPSB7fTtcbiAgICB9XG4gICAgLy9yZW1vdmUgYnV0dG9uIGZ1bmN0aW9uIC0gcmVtb3ZlcyBvbmUgaXRlbSBmcm9tIHRoZSBhcnJheVxuICAgICRzY29wZS5kZWxldGVJdGVtID0gZnVuY3Rpb24oaW5kZXgsIHR5cGUpIHtcbiAgICAgICRzY29wZS5yZWNpcGVbdHlwZV0uYWRkZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgLy9nZW5lcmljIGZ1bmN0aW9uIHRvIGNhbGwgdGhlIHNlcnZlciBmb3IgYSBzcGVjaWZpYyBpbmdyZWRpZW50XG4gICAgZnVuY3Rpb24gZ2V0SXRlbShpdGVtKXtcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgdXJsOiAnLycgKyBpdGVtXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAkc2NvcGVbaXRlbV0gPSByZXMuZGF0YTtcbiAgICAgIH0pXG4gICAgfTtcbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJyk7XG4gICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclRva2VuJykpIHtcbiAgICAgICAgICB2YXIgdXNlclRva2VuID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXJUb2tlbjtcbiAgICAgICAgICAkc2NvcGUudXNlci5yZWNpcGV0ZW1wbGF0ZSA9ICcvcHJpdmF0ZS92aWV3cy9zYXZlZHJlY2lwZXMuaHRtbCdcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICAgICRzY29wZS51c2VyLnJlY2lwZXRlbXBsYXRlID0gJy92aWV3cy9ub3Rsb2dnZWRpbi5odG1sJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XSk7XG5cblxuICAvL2V4dHJhIGZvciBhIGNhbGN1bGF0b3IgY29udHJvbGxlclxuICBhcHAuY29udHJvbGxlcignZGJzZ0NhbGMnLCBbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgY29uc29sZS5sb2coJ2NsaWNrZWQnKTtcbiAgICBjb25zb2xlLmxvZygkc2NvcGUuZGJmZyArICRzY29wZS5uYW1lKTtcbiAgICAvLyAkc2NvcGUuYWRkZ3JhaW4gPSBmdW5jdGlvbigpe1xuICAgIC8vICAgaWYoISRzY29wZS5ncmFpbnMpIHtcbiAgICAvLyAgICAgJHNjb3BlLmdyYWlucyA9IFtdO1xuICAgIC8vICAgfVxuICAgIC8vICAgJHNjb3BlLmdyYWlucy5wdXNoKCRzY29wZS5ncmFpbik7XG4gICAgLy8gICAkc2NvcGUuZ3JhaW4gPSB7fTtcbiAgICAvLyB9XG4gIH1dKTtcblxuXG4gIC8vY29udHJvbGxlciBmb3IgbG9naW4gc2NyZWVuIC0gc2VuZHMgdXNlci9wYXNzIGFuZCBzdG9yZXMgand0XG4gIGFwcC5jb250cm9sbGVyKCdsb2dpbkNvbnRyb2wnLCBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnVzZXJMb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgIHVybDogJy9sb2dpbmF1dGgnXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGlmKHJlcy5kYXRhLnRva2VuKXtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyVG9rZW4nLCByZXMuZGF0YS50b2tlbik7XG4gICAgICAgICAgJHNjb3BlLnVzZXIgPSB7fTtcbiAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XG4gICAgICAgIH07XG4gICAgICB9LCBmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUuZXJyb3IgPSByZXMuZGF0YTtcbiAgICAgICAgJHNjb3BlLnVzZXIucGFzc3dvcmQgPSAnJztcbiAgICAgIH0pO1xuICAgIH1cbiAgfV0pO1xuXG5cbiAgLy9jb250cm9sbGVyIGZvciByZWdpc3RlciBwYWdlIC0gc2VuZHMgbmV3IHVzZXIgaW5mbyBhbmQgcmV0dXJucyB0aGF0IGRhdGFcbiAgYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ29udHJvbCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uKCl7XG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhO1xuICAgICAgICAkbG9jYXRpb24udXJsKCcvbG9naW4nKTtcbiAgICAgIH0sIGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGE7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcbiAgYXBwLmNvbnRyb2xsZXIoJ2hlYWRlckNvbnRyb2wnLCBbJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJ2p3dEhlbHBlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgand0SGVscGVyKXtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuXG4gICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH0sIGZ1bmN0aW9uKCl7XG4gICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyVG9rZW4nKSl7XG4gICAgICAgICRzY29wZS51c2VyID0gand0SGVscGVyLmRlY29kZVRva2VuKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJUb2tlbicpKTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW4gPSAnTG9nb3V0ICcgKyAkc2NvcGUudXNlci51c2VybmFtZTtcbiAgICAgICAgJHNjb3BlLnVzZXIubG9naW5VcmwgPSAnLyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUudXNlciA9IHt9O1xuICAgICAgICAkc2NvcGUudXNlci5sb2dpbiA9ICdMb2dpbi9SZWdpc3Rlcic7XG4gICAgICAgICRzY29wZS51c2VyLmxvZ2luVXJsID0gJy9sb2dpbidcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICRzY29wZS5sb2dPdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJUb2tlbicpO1xuICAgIH1cbiAgfV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9